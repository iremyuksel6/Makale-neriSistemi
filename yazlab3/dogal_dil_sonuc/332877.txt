design implement effici messag schedul control area network abstractth control area network wide use realtim control applic automobil aircraft autom factori paper present mix traffic schedul mt provid higher schedul fixedprior scheme like deadlinemonoton dm incur less overhead dynam earliestdeadlin ed schedul also describ mt implement exist network adapt motorola toucan previou work 1 2 shown mt far superior dm schedul perform paper present implement overhead measur show process need support mt consum 5 6 percent cpu time consid schedul advantag make mt ideal use control applic b introduct distribut realtim system use increasingli control applic automobil aircraft robot process control system consist multipl comput node sensor actuat interconnect lan 3 multipl lan protocol avail use includ map 4 ttp 5 etc control area network 6 gain widespread accept industri 7 control network must carri period sporad realtim messag well nonrealtim messag messag must properli schedul network realtim messag meet deadlin coexist nonrealtim messag limit scope paper schedul messag whose characterist like deadlin period known priori previou work regard schedul messag includ 8 9 focus fixedprior schedul shin 10 work report paper support part nsf grant mip9203895 ddm9313222 onr grant n000149410229 opinion find conclus recommend author necessarili reflect view fund agenc sof data crc ack eof sof start frame crc cyclic redund code eof end frame figur 1 variou field data frame consid earliestdeadlin ed schedul consid high overhead make ed impract paper present schedul scheme call mix traffic schedul mt increas schedul util perform better fixedprior scheme incur less overhead ed paper goe beyond work present 1 2 remov ideal assumpt made previou work also describ mt implement exist network adapt address problem control prioriti invers lowprior messag transmit ahead higherprior one within network adapt evalu differ solut problem measur variou execut overhead associ mt implement motorola 68040 processor emerald realtim oper system 11 emerald os design use distribut embed control applic mtss implement use emerald provid basic os function interrupt handl context switch use emul network devic anoth 68040 act network adapt connect main node vme bu present detail measur execut interrupt handl task schedul context switch overhead associ mt show feasibl use mt control applic next section give overview protocol section 3 describ variou type messag target applic workload includ realtim nonrealtim messag section 4 give mt algorithm section 5 discuss issu relat implement mt focus prioriti invers problem section 6 present implement overhead measur paper conclud section 7 control area network specif defin physic data link layer layer 1 2 isoosi refer model frame seven field shown figur 1 concern data length dl identifi id field dl field 4 bit wide specifi number data byte data field 0 8 id field two length standard format 11bit wherea extend format 29bit control bu arbitr messag address interest former describ next make use wiredor wiredand bu connect node rest paper assum wiredor bu processor send messag first calcul messag id may base prioriti messag id messag must uniqu processor pass messag associ id bu interfac chip chip wait till bu idl write id bu one bit time start signific bit write bit chip wait long enough signal propag along bu read bu chip written 0 read 1 mean anoth node messag higher prioriti node drop content end one winner use bu thought distribut comparison id messag differ node messag highest id select transmiss 3 workload characterist control applic devic exchang period messag motor drive use industri applic other eventdriven smart sensor moreov oper may need statu inform variou devic thu gener messag time con straint classifi messag three broad categori 1 harddeadlin period messag 2 harddeadlin sporad messag 3 nonrealtim besteffort aperiod messag period messag multipl invoc one period apart note whenev use term messag stream refer period refer invoc period sporad messag minimum interarriv time mit invoc nonrealtim messag complet aperiod deadlin constraint lowspe vs highspe realtim messag messag realtim control system wide rang deadlin exampl messag control highspe drive may deadlin hundr microsecond hand messag devic temperatur sensor deadlin second physic properti measur temperatur chang slowli thu classifi realtim messag two class highspe lowspe depend tight deadlin clear section 4 reason classif number bit requir repres deadlin messag note highspe rel term rel tightest deadlin 0 workload messag order magnitud deadlin 0 within one order magnitud differ 0 consid highspe messag other lowspe 4 mix traffic schedul fixedprior deadlin monoton dm schedul 12 use set messag id uniqu prioriti 8 9 howev gener fixedprior scheme give lower util scheme nonpreempt earliestdeadlin 1 ed sever reaserch use ed network schedul 1517 motiv us use ed schedul messag mean messag id must contain messag deadlin actual logic invers deadlin bu time progress absolut deadlin valu get larger larger eventu overflow id problem solv use type wraparound scheme present section 41 even pute deadlin id forc one use extend format 29bit id compar standard format 11bit id wast 2030 bandwidth negat benefit obtain go fixedprior dynamicprior schedul make ed impract section present mt schedul combin ed fixedprior schedul overcom problem ed 41 time epoch alreadi mention use deadlin id necessit type wraparound scheme use simpl scheme express messag deadlin rel period increas refer call start epoch soe time two consecut soe call length epoch deadlin field messag logic invers absolut deadlin messag current time assum node synchron clock 18 42 mt idea behind mt use ed highspe messag dm lowspe one first give highspe messag prioriti lowspe nonrealtim one set signific bit 1 id highspe messag figur 2a protect highspe messag type traffic uniqu field 5 bit 2 allow highspe messag prioriti field 1 bit remain 5 bit still enough encod deadlin rel latest soe solut quantiz time region encod deadlin accord region fall distinguish messag whose deadlin fall region use dmprioriti messag uniqu code make mt hierarch schedul top level ed deadlin two messag distinguish quantiz one earlier deadlin higher prioriti nonpreempt schedul releas time constraint nphard strong sens 13 howev zhao ramamritham 14 show ed perform better simpl heurist deadlin dm prioritydm prioriti fix prioriti b c figur 2 structur id mt part c show id highspe lowspe nonrealtim messag respect soel end epoch figur 3 quantiz deadlin rel start epoch lower level dm messag deadlin region schedul dm prioriti calcul length region l r l longest rel deadlin highspe messag width deadlin field 5 bit case clear figur 3 shown 3 worstcas situat occur messag deadlin max releas end epoch absolut deadlin lie max beyond current soe deadlin field must encod time span use bit lead express l r use dm schedul lowspe messag fixedprior schedul nonrealtim one latter assign prioriti arbitrarili id messag shown figur 2 b c respect secondmost signific bit give lowspe messag higher prioriti non realtim one scheme allow 32 differ highspe messag period sporad 512 lowspe messag period sporad 480 nonrealtim messag 2 suffici applic 43 id updat protocol id highspe messag updat everi soe note id updat differ node coincid almost exactli prioriti invers occur id lowprior messag updat highprior one small window time lowprior messag consecut zero six signific bit id mean 32 code nonrealtim messag illeg leav 512 gamma code higher prioriti id highprior messag avoid problem must use agreement protocol trigger id updat node clock synchron algorithm 18 synchron clock within 20 simpl agreement protocol one node design broadcast messag bu messag receiv node time natur bu upon receiv special messag node updat id local messag protocol two disadvantag first much bandwidth wast transmit extra messag everi second moreov separ protocol must run elect new leader case old leader fail instead use follow protocol robust also consum less bandwidth node period timer fire everi second time node take follow action 1 set flag inform devic driver id updat protocol begun 2 configur network adapt receiv messag ie enter promiscu mode adjust receiv filter 3 increment data length dl field highestprior readi messag node first incrementeddl messag sent bu serv signal node updat id messag origin dl messag less 8 increment dl result transmiss one extra data byte devic driver receiv node strip extra byte forward messag applic describ later dl alreadi 8 adapt allow 4bit dl field set 9 higher 8 data byte transmit node start receiv messag transmit bu devic driver node tabl list id messag stream system along data length messag arriv devic driver compar dl field valu tabl find messag increment dl field node receiv messag time take follow action 1 restor receiv filter reenabl messag filter na 2 local messag whose dl field increment period timer transmit yet decrement dl field back origin valu 3 updat messag id reflect new soe node receiv incrementeddl messag time id updat node start time first incrementeddl messag complet nexthighestprior messag begin transmiss long node complet id updat messag complet window least 55 sinc messag contain least one data byte messag updat id time next bu arbitr round begin prioriti invers occur case one node slow complet id updat within window time node configur updat n th messag first incrementeddl messag transmiss n small number larg enough allow slowest node calcul new id write na n th messag transmiss protocol incur network overhead 16 bit everi second compar 47 bit per epoch simpl leaderbas agreement protocol recept first incrementeddl messag caus devic driver set dl field local messag back origin valu complet next transmiss also increment dl field alreadi start two messag 8 extra data bit worstcas lead 16bit overhead cpu side period process incur overhead moreov network adapt filter disabl devic driver must process two messag may may meant node devic driver must perform filter softwar discard messag meant node measur variou cpu overhead section 6 5 implement section present scheme implement mt motorola toucan modul 19 featur messag buffer intern arbitr transmiss buffer base messag id toucan repres modern na follow present brief descript toucan problem face implement realtim schedul solut problem mt 51 motorola toucan toucan modul develop motorola onchip inclus variou microcontrol toucan lie chip cpu interconnect cpu onchip modul motorola intermodul bu motorola current market mc68376 19 microcontrol incorpor toucan cpu32 core toucan 16 messag buffer buffer configur either transmit receiv messag one buffer valid messag wait transmiss toucan pick buffer highestprior id contend bu id respect toucan differ older network adapt intel 82527 20 arbitr buffer use fixedprior daisychain scheme forc host cpu sort messag accord prioriti place network adapt buffer one main reason pick toucan implement mt time toucan avail mc68376 microcontrol implement mt within emerald toucan would first port emerald mc68376 microcontrol avoid instead use devic emul 21 generalpurpos microcontrol made emul network adapt emul interfac host cpu io bu emul present host cpu interfac actual network adapt would emul receiv command host cpu perform correspond action produc result actual network adapt would thu provid accur measur variou overhead interrupt handl messag queu host cpu use 68040 board emul toucan modul connect host cpu anoth 68040 vme bu 52 mt implement mt goal minim averag overhead suffer host node transmit messag overhead follow compon 1 queuingbuff messag softwar network adapt buffer unavail 2 transfer messag network adapt 3 handl interrupt relat messag transmiss prioriti invers unbound adapt buffer contain lowprior messag messag sent long higherprior messag anywher els network con sequent highprior messag stay block softwar indetermin period time caus miss deadlin prioriti invers problem network schedul implement regardless schedul polici dm mt implement ensur adapt buffer alway contain highestprior messag lowerprior messag queu softwar suppos b buffer alloc messag transmiss usual b twothird total number buffer see section 6 total number outgo messag stream b less mtss implement straightforward assign one buffer stream whenev devic driver receiv messag transmiss simpli copi messag buffer reserv stream case buffer need within devic driver also mean need adapt gener interrupt upon complet messag transmiss 3 lead lowestposs host cpu overhead number messag stream exce b messag buffer softwar reduc host cpu overhead want buffer fewest possibl messag avoid prioriti invers mt treat lowspe highspe messag differ schedul purpos treat messag differ implement purpos well goal keep overhead frequent messag belong highspe period stream low possibl get low averag permessag overhead implement number period highspe messag stream nhp 3 adapt must program gener interrupt messag queu softwar wait adapt buffer becom avail case less b reserv nhp buffer highspe period stream treat buffer softwar remain buffer use highspe sporad lowspe nonrealtim messag messag arriv devic driver transmiss insert prioriti sort queue avoid prioriti invers devic driver must ensur l buffer alway contain l messag head queue newlyarriv messag prioriti higher lowestprior messag buffer preempt messag overwrit preemption increas cpu overhead necessari avoid prioriti invers preempt messag stay devic driver queue eventu transmit accord prioriti among l buffer buffer contain 1 th lowest prioriti messag configur trigger interrupt upon messag transmiss defin later interrupt use refil buffer queu messag must larg enough ensur bu becom idl interrupt handl buffer refil usual 1 2 enough keep bu busi 4794 minimum note put restrict l must greater make l less equal lead bu becom idl isr execut make buffer avail highspe period messag use lowspe messag make small portion workload highspe sporad messag either nonexist nhp b must queue even highspe period messag softwar singl prioritysort queue outgo messag b buffer fill queue stream dedic buffer cpu overhead calcul messag id transfer messag data id network adapt note messag data copi directli user space network adapt keep overhead minimum messag queu softwar extra overhead insert messag queue includ copi 8 fewer byte messag data user space devic driver space insert queue plu overhead handl interrupt gener upon messag transmiss interrupt overhead incur everi messag transmiss q number buffer fill queue q b l depend whether highspe period messag buffer also messag potenti preempt one messag preempt messag alreadi copi network adapt copi preemption overhead equival overhead transfer messag network adapt tabl 1 summar overhead variou type messag measur overhead section 6 note dm schedul also incur similar overhead differ id messag stream dm fix new id calcul time implement dm toucan differ implement mt messag type overhead queu calcul id copi na queu calcul id insert prioriti queue copi na tabl 1 summari overhead mtss implement toucan 6 result schedul mt compar dm ed evalu publish 1 2 present measur variou mt implement overhead impact mt schedul overhead measur implement mt 25mhz motorola 68040 cach emerald rto tabl 2 data see highspe messag dedic network adapt buffer incur overhead transfer na oper overhead calcul id highspe messag 30 insert prioriti queue includ copi devic driver memori 63 transfer messag na 8 data byte 78 preempt messag 78 handl dequeu transmit messag 424 miscellan paramet pass etc 60 tabl 2 cpu overhead variou oper involv implement mt highspe period messag queu averag permessag overhead depend number buffer use transmiss q toucan buffer 56 usual use messag recept id configur receiv variou messag stream need node leav 10 buffer messag transmiss worstcas scenario messag transmiss incur averag overhead assum 2 calcul queu worstcas l q total number messag stream use queue lowspe non realtim messag fix id incur overhead 332 lowspe highspe messag share queue highspe messag use dedic buffer smaller lowspe messag assum 3 buffer avail 2 lowspe nonrealtim messag incur overhead 703155l q smsg highspe sporad messag overhead 733155l q smsg number see certain node 7 highspe period stream 1 highspe stream lowspe nonrealtim messag highspe period messag make 90 outgo traffic highspe sporadiclowspeednonrealtim messag averag permessag overhead come overhead significantli higher number highspe period stream larg enough highspe messag queu case permessag overhead twice much overhead highspe period stream dedic buffer fortun realtim control applic 1015 task per node wellknown avion task workload 22 23 accept typifi realtim control applic exampl task send internod messag typic send 12 messag per task indic applic dedic buffer avail highspe messag stream result low permessag overhead 2025 rang use simpl link list sort messag prioriti queue work well small number messag 510 typic need queue larger number messag sort heap give lower overhead note overhead applic dm well differ dm id calcul permessag overhead 3s less mt id readjust end epoch tabl 3 list cpu overhead incur id updat protocol overhead period task includ context switch cpu schedul overhead one context switch occur task wake anoth task block includ overhead measur oper overhead period task 680 devic driver interrupt messag arriv 404 read messag na 8 data byte 78 softwar filter dl lookup 30 id updat 28 per messag tabl 3 cpu overhead variou oper involv updat messag id id updat devic driver receiv two messag incur overhead 404 includ context switch overhead receiv first messag id highspe messag updat assum id 5 messag need updat total overhead per epoch becom 1844 2m id updat take 9 cpu time motiv us increas increas increas level quantiz deadlin result reduc schedul highspe messag hand network overhead associ id updat 16 bit per epoch decreas lead increas schedul bit per epoch consum 08 network bandwidth 1mb bu impact network schedul due block effect much higher measur show extra overhead 23 percentag point fewer workload feasibl mt workload util without overhead increas result sizeabl improv schedul due reduc id updat overhead offset loss schedul due coarser quantiz figur 4 show effect increas schedul data point gener 1000 workload measur percentag found feasibl mt use schedul condit 2 workload 815 highspe period stream 2 6 highspe sporad stream 25 lowspe period stream 4 lowspe sporad stream deadlin highspe messag set randomli 052m rang lowspe messag set randomli 2100m period period messag calcul ad small random valu deadlin mit sporad stream set 2s lowspe highspe sporad stream differ data point obtain vari number highspe period stream 8 15 lead variat workload util roughli 50100 rang result includ overhead result 16 extra bit per epoch id updat figur show doubl 2m 4m network schedul actual improv slightli two highspe sporad stream workload six sporad stream use loss schedul coarser quantiz gain reduc id updat overhead 12 percentag point fewer workload feasibl result show lighttomoder highspe sporad load increas 4m continu give good perform even heavi highspe sporad load 4m result slight degrad perform increas 3m id updat cpu overhead reduc 6 cpu time wherea becom 46 cpu time 7 conclus standard messag frame format 11bit id field fixedprior schedul dm use bit go unus idea behind mt use extra bit enhanc network schedul mt place quantiz form messag deadlin extra bit use dmprioriti messag remain bit enhanc schedul frequent messag system highspe messag mt abl feasibl schedul workload dm util 2006001000 percent feasibl workload l2m l4m l2m l4m figur 4 impact chang mt schedul sinc messag id base deadlin must period updat present protocol perform updat without prioriti invers protocol consum 56 cpu time consid larg improv network schedul mt display dm extra overhead justifi also present scheme implement mt toucan network adapt repres modern network adapt biggest challeng implement schedul mt dm control prioriti invers within network adapt show can characterist short messag size preemption messag adapt newlyarriv higherprior outgo messag effect method avoid prioriti invers futur avenu research studi messag recept issu tri reduc averag permessag recept overhead unlik messag transmiss messag recept depend network schedul polici dm mt use messag recept overhead reduc optim interrupt handl use poll instead interrupt detect messag arriv use combin interrupt poll r nonpreempt schedul messag control area network realtim control applic schedul messag control area network realtim cim applic smart network control ttp protocol faulttoler realtim system road vehicl interchang digit inform control area network highspe commun insid look fundament analyz realtim commun control area network calcul control area network messag respons time realtim commun computercontrol workcel emerald microkernel embed realtim system complex fixedprior schedul period realtim task nonpreempt schedul period sporad task simpl integr heurist algorithm schedul task time resourc constraint scheme realtim channel establish widearea network realtim commun multihop network abil establish realtim channel pointtopoint packetswitch network implement distribut highresolut realtim clock use canbu mc68336376 user manual commun control architectur overview end emul network devic evalu adapt design build predict avion plarform ada case studi gener avion softwar specif tr