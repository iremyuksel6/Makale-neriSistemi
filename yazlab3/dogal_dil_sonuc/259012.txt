partial evalu aircraft crew plan paper investig partial evalu program transform use real problem name speed airlin crew schedulingschedul crew subject mani rule restrict restrict express rule languag howev given plan situat much known fix rule set partial evalu respect known inputth approach somewhat novel use truli static input data well static input data valu known belong set valuesth result partial evalu quit satisfactori compil run time decreas use partial evalu part crew schedul system carmen system ab market use major european airlin daili product b introduct next fuel cost crew cost largest direct oper cost airlin 1991 american airlin report spend 13 billion crew agpt91 major airlin similar cost therefor much work devot plan schedul crew last thirti year plan aircraft crew larg airlin complex prob lem see ahkw97 good overview make problem tractabl normal divid four part construct timet first time tabl produc object match expect market depart avail fleet constraint output process number leg nonstop flight airlin decid oper fleet assign second aircraft alloc leg must match expect number passeng good avail aircraft fleet output problem timet augment aircraft inform crew pair third pair construct pair sequenc flight leg unspecifi crew member start end crew base sequenc often call crew rotat crr crew member normal work leg pair may also contain leg crew member transport leg call deadhead leg natur group duti period work day call rotat day rtd rotat day separ layov overnight stop legal pair must satisfi larg number government regul collect agreement vari airlin airlin output phase set pair cover leg timet crew assign fourth plan problem assign pair name individu crew assign roster prob lem object cover pair previou stage well train requir vacat etc satisfi work rule regul carmen system ab market system handl last two part plan problem system use major european airlin optimis run stage first gener larg number possibl pair use clever heurist te96 second select subset cover leg schedul minim cost second part huge set cover problem wed95 cover potenti solut need checkedso fulfil rule mention run optim comput heavi job run may take minut day comput time import make fast possibl sinc enabl tri find good solut made find good solut usual requir manual tweak rerun optim test rule valid usual take largest part comput time improv benefici rule carmen system express special languag de scribe complet rule set usual rather larg contain thousand line cover fleet long haul short haul crew categori differ union agreement schedul standard etc howev particular problem solv subset rule realli need problem may particular crew categori specif aircraft type etc larg program rule set input data known crew categori etc spell partial evalu 2 rule languag express rule affect legal cost differ solut plan problem carmen system develop proprietari languag carmen rule languag crl boh90 crl said pure zeroth order strongli type function languag zeroth order languag function except built one evalu rule also use form lazi evalu consequ us leg number attribut attribut eg aircraft type arriv time departur time given leg attribut eg length flight comput given one calcul rule languag describ input rule evalu set pair ie number crr crr contain number rtd rtd contain number leg task rule evalu find given set crr legal legal cost also comput less import leg rtd crr attribut given comput attribut exampl use differ syntax real languag use hope make thing clearer defin extern given attribut levelattribut type level leg rtd crr attribut defin languag written levelattribut express level type definit realli necessari sinc deduc given clariti program fdefinitiong definit constantdefinit leveldefinit ruledefinit constantdefinit name leveldefinit ruledefinit rule level type level leg j rtd j crr express liter name express binop express express express els express aggregatelevel builtinfunctionexpress case express fcaseblock otherwisegcaseblock endcas case express extern stringliteralendcas caseblock pattern liter liter liter express aggreg sum j j j count next j prev j first j last figur 1 simplifi grammar crl definit mean item given level leg rtd crr attribut comput accord formula rule set program defin number attribut rule rule boolean express preceed keyword rule check solut ie group leg rtd crr legal amount check rule evalu true type oper languag fairli limit mostli self explanatori give formal descript except simplifi grammar figur 1 two unfamiliar type probabl abstim reltim repres absolut time time differ respect aggreg function evalu express lower level aggreg claus act guard make possibl aggreg express lower level guard true eg sumleg legdepartur abstim time plane depart legarriv abstim time plane arriv legaircrafttyp string type plane eg 747 legdeadhead bool deadhead leg legblocktim rule hour per flight figur 2 simpl exampl rtd sum x attribut leg attribut true languag care design imposs write nontermin comput way program fail 1 properti make rule languag amen program transform sinc occur 21 rule exampl figur 2 show simpl rule set expect departur arriv aircraft type suppli extern leg wherea blocktim 2 comput leg also rule state blocktim less 4 hour leg need quantifi rule express automat test wherev appli extend exampl figur attribut defin total worktim defin rtd level defin sum worktim leg belong rtd sum one built function aggreg data lower level hierarchi rememb hierarchi wire problem thu languag therefor ambigu leg sum given rtd note second rule refer attribut leg level rtd level sinc leg belong exactli one rtd ambigu rtd use comput rule 1 program principl divid 0 told ignor divis rare real life 2 blocktim time wheel block remov departur replac arriv consid total time flight legbrief legdebrief legworktim rtdtotalworktim maxtotalworktim rule rule may longer half work day rtddeadheadsperrtd crrdeadheadspercrr rule deadhead pair figur 3 extens simpl exampl legbrief case timeofdaydepartur 0000 0600 015 0601 1800 030 2359 020 legminimumgroundstop case arrivalairportnam deadhead dayofweekarriv fra fals 1 5 100 otherwis otherwis 030 figur 4 tablecas express 22 tabl lot rule comput simpli express tabl lookup crl fairli power case construct express case construct sever valu key match simultan set pattern pattern liter rang pattern allow overlap mark explicitli figur 4 show simpl exampl tabl construct first one determin brief time depend time day arriv arriv abstim time day function drop date part second tabl state minimum ground stop one hour arriv frankfurt fra nondeadhead leg monday thru friday etc 221 extern tabl avoid repeat recompil rule set make flexibl concept extern tabl extern tabl like case construct describ case arm given rule file instead load dynam file run time case arm avail compil construct less effici 23 void although crl defin way everyth termin failur small complic handl function sometim given attribut fail concept except call void typic express could give rise void nextleg x suppos give valu x attribut next leg rel leg comput within rtd final leg rtd exist give valu void void occur express propaget result void propag caught special languag construct 3 program transform transform done program realli fall three categori first transform perform given program transform like constant propag constant fold second transform made given static data prob lem static call paramet paramet like global rule constant given compil time instead run time extern tabl also consid static data third categori transform perform leg known 31 constant propag fold typic rule set contain mani definit mere constant constant cours substitut code constant fold appli step much work one might imagin first constant fold handl built function also includ match case express one key turn constant mean column case express remov togeth row match key 311 extern tabl extern tabl turn intern tabl partial evalu intern tabl effici semant extern tabl unfortun somewhat differ intern tabl intern tabl overlap allow entri unless explicitli state howev extern tabl entri match top bottom mean extern tabl convert intern one use overlap annot could insert entri result tabl much effici would lost sinc rule compil handl nonoverlap entri much effici legdebrief deadhead clone legdebrief deadhead debriefingdh els debriefingndh legdebriefingdh legdebriefingndh deadhead clone figur 5 simpl exampl therefor extern tabl need transform remov overlap convert intern tabl process complic fact column tabl rang well liter fact tabl n column tabl entri thought defin ndimension box ie rectangular parallelopip defin match ndimension space defin column insight transform extern tabl new tabl entri process topdown box comput box preced entri subtract result subtract one box anoth alway express sum box subtract preced box left possibl empti set box correspond nonoverlap entri righthandsid box convert entri ad intern tabl 32 clone one featur partial evalu gener differ specialis function distinct argument crl function kind function specialis carri directli crl partial evalu also specialis ad hoc deadhead flight realli part normal flight want plan sinc use transport mean mani attribut comput differ way deadhead leg compar ordinari leg furthermor leg set contain much precis inform dead head consid reason even problem hand plan particular aircraft fleet deadhead may happen complet differ fleet even differ airlin handl deadhead good way treat special transform definit leg level split two part one assum deadhead true one assum deadhead fals see figur 5 exampl definit origin attribut debrief inlin everywher occur two new definit optim assumt deadhead true resp fals inlin express often reduc one branch valu deadhead known local context 33 set base evalu given plan situat set leg arrang rtd crr mean actual lot inform valu extern suppli leg attribut leg attribut take valu leg attribut appear flight plan realli valuabl inform consid mani attribut take one two differ valu reason flight plan normal cover week two time limit geograph area aircraft type practic consequ express like aircraft type els simplifi flight plan contain aircraft transform quit frequent rule set typic cover airlin oper inform sort haul long haul cockpit cabin personnel time year etc given flight plan use subset rule eg short haul cabin personnel one week august set base transform base set evalu set evalu like ordinari evalu express languag except environ contain set valu variabl instead singl valu result evalu set fragment set evalu shown figur 6 set comput set evalu alway larg larger real set valu express interest part set evalu handl naiv way would take union set two branch slightli sophist check condit singleton true fals pick correspond branch singleton otherwis take union howev case actual addit inform within branch condit known hold hold mean evalu x5 e1 els e2 within branch x known 5 within els branch known 5 use fact account chang environ evalu branch environ modif function look relat oper variabl modifi environ imagin much much sophist analysi keep track condit liter liter liter f f f liter f liter f l true figur set base evalu use premis theorem prover within branch current implement sinc look like would littl practic impact set evalu figur 6 handl void void could seen ordinari valu set cours take part arithmet oper void also need handl special sinc even need use worst possibl approxim like sum ie univers set still want know void part use set evalu tool possibl transform program subexpress set evalu invok yield singleton valu valu replac subexpress yield singl valu part subexpress examin transform way pass whole program constant propag constant fold rerun take advantag new constant might seem like lot work repeatedli run set evalu like form cach could use practic show essenti 331 implement valu set oper valu set must support usual set oper union membership test etc use set base evalu handl differ languag construct handl arithmet differ oper need eg possibl valu express xy set fx g oper set must includ crossproduct like arithmet oper cardin set valu obtain input data could worst case larg number leg flight plan number rang hunder 10000 cardin usual much lower normal less 15 unfortun arithmet oper set caus cardin result set explod arithmet oper size set could easili exceed memori comput abl handl larg set effici need approxim approxim use switch exact set represent interv represent interv retain smallest largest element origin set arithmet set becom ordinari interv arithmet implement fact switch four represent singleton set exact list element interv univers set first present improv space time effici represent also keep track set contain void 34 ad hoc transform rule studi output partial evalu easili find number express simplifi transform need done constant fold set base evalu sinc deal actual valu transform interest symbol natur need transform rang trivial eg 0 x replac 0 trivial eg countlevel wherep 0 replac anylevel p mani transform rule side condit relat void eg x 0 replac 0 x valu void sinc crl hs lefttoright evalu express void x transform side condit check use set evalu examin possibl valu subexpress figur 7 contain partial list transform utilis deriv adhoc studi output partial evalu verifi correct use semant languag set transform could extend cours handl mani case occur practic 35 transform transform also perform ffl simpl eg liter variabl definit definit use inlin definit coalesc unus definit remov ffl simpl theorem prove use remov rule cover rule eg rule remov also rule rule implement partial evalu read dump abstract syntax tree input program gener new rule set concret syntax dump abstract syntax tree gener ordinari crl compil output partial evalu quit readabl program one requir comment even preserv way system use without partial evalu follow step true els e fals els e e c true els fals c c fals els true c c els e c e els c els c 0 els e c els e c els ex c tx els ex x variabl xif c els e c xt els xe x variabl etru efals e e e e e e e e e e 1 e 2 e 1 e 2 e 1 e 2 e 1 e 2 alll e anyl e anyl e alll e figur 7 symbol transform rule ffl compil rule set use crl compil crl compil translat rule languag c compil standard c compil user step look like one oper ffl use compil rule set solv differ problem differ problem may differ paramet differ extern tabl differ leg set input compil rule set dynam link runtim system run import system look exactli partial evalu use step look user differ intern ffl compil rule set invok crl compil collect use modul togeth produc dump abstract tree ffl use compil rule set follow happen partial evalu run dump rule set current paramet extern tabl leg set input valu would use runtim system partial evalu use result rule set compil crl compil use c compil use runtim system partial evalu consist 7000 line haskel hud92 code earli develop hug system jon96a jon96b use initi period hbc compil aug93 use exclus heap profil rw93 time profil use improv perform program 5 practic evalu conclus partial evalu use rule set written crl tabl 1 present figur lufthansa problem lufthansa biggest rule set airlin seen tabl run time decreas half test larger varieti problem run time vari 30 65 origin time 50 typic figur consid run often take sever hour quit gain total time process rule compil c compil rule set also decreas rule compil gener pe pe rule 88 90 leg definit 209 68 rtd definit 391 106 crr definit 192 22 total rule size 461 kbyte 176 kbyte c code gener 217 mbyte 099 mbyte time pe 3 min time c compil run time tabl 1 summari partial evalu result lufthansa rule set partial evalu lufthansa express aircraft type fli within europ problem captain run time solv small subset week schedul huge c program take long compil 3 number definit reduc unus definit remov simpl definit inlin mani mani definit becom simpl transform reason number rule increas clone leg level definit handl deadhead without clone number rule would also reduc run time partial evalu problem remark long one consid exampl tabl input program almost five hundr kbyte extern tabl anoth hundr kbyte given attribut leg flight plan five hundr kbyte even run time transform program decreas fair amount surprisingli alway biggest gain speed made particularli difficult plan problem output partial evalu human readabl inspect expert plannerrul writer sinc rule set decreas much size abl grasp rule meant make manual adjust adjust made program run order magnitud faster chang could cours made origin program studi comprehend would daunt task partial evalu part carmen system deliv sever custom use daili work 3 actual broken smaller piec sinc c compil compil file sever megabyt 6 acknowledg would like thank peopl carmen system especi tommi bohlin answer naiv question airlin schedul problem would also like thank jessica twitchel proof read improv english paper r recent advanc crewpair optim american airlin crew pair optim hbc user manual carmen rule languag report program languag haskel nonstrict hug 13 user manual hug distribut heap profil lazi function program algorith larg scale 01 integ program applic airlin crew schedul tr report program languag haskel ctr luke hornof trevor jim certifi compil runtim code gener higherord symbol comput v12 n4 p337375 decemb 1999