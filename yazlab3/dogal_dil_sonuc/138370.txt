vector softwar bessel function evalu suit comput program evalu bessel function modifi bessel function order zero one vector real argument describ distinguish characterist program portabl across wide rang machin b vector case multipl function evalu perform perform new program compar softwar fnlib collect fullerton new softwar base b introduct bessel function real argument integ order among commonli occur special function appli mathemat softwar librari contain routin evalu one success collect routin evalu special function fnlib packag develop wayn fullerton lo paper appear acm transact mathemat softwar volum 4 pp 456469 contribut nation institut standard technolog nist subject copyright unit state identif commerci product paper impli recommend endors nist author address comput appli mathemat laboratori nation institut standard technolog gaithersburg md 20899 electron mail boisvertcamnistgov saun derscamnistgov respect alamo nation laboratori late 1970 10 one import featur fnlib portabl parameter port machin constant 9 fnlib code regularli use machin ibm pc cray ymp version code found way sever wellknown librari imsl sfunlibrari 11 slatec common math librari 2 also avail netlib 7 recent increas attent paid develop algorithm softwar take advantag vector processor machin exampl special version mani standard fortran math function avail compil vector loop follow abil vector loop crucial mani applic paper describ set fortrancal subprogram extend function bessel function done produc modifi version fnlib routin besi0 besi1 besj0 besj1 besk0 besk1 besy0 besy1 well doubl precis version new routin maintain portabl fnlib advantag vectoriz case multipl function evalu requir section 2 review basic design fnlib routin section 3 discuss variou issu involv vector algorithm follow short descript user interfac implement section 4 final section 5 describ test new softwar evalu perform variou scalar vector processor 2 design fnlib fnlib substanti collect softwar includ 200 fortran subprogram doubl precis version avail code primari design criteria develop packag portabl maintain case criteria speed accuraci relax slightli order maxim primari criteria 10 exampl fnlib routin rare accur last bit although almost alway accur within factor 10 time machin precis certainli suffici vast major applic fact routin remain popular 10 year trivial port mani machin exist initi develop attest success basic design fnlib base upon approxim truncat chebyshev seri expans 8 approxim mani wellknown properti wide applic nearli best minimax sens error easi estim provid variabl accuraci approxim stabl evalu convent polynomi properti approxim basi mani algorithm evalu special function basic formula construct routin fnlib paraphras 10 follow recip construct fnlib routin 1 store chebyshev coeffici statement coeffici requir chebyshev expans accur 16 digit store singl precis routin 31 digit doubl precis routin rang ensur suffici accuraci comput 2 initi done first call routin calcul legal argument bound illeg argument region function undefin result would overflow underflow rang reduct perform accur enough port machin constant use determin bound applic current machin b determin correct number expans coeffici error commit truncat chebyshev seri bound sum absolut valu discard coeffici one use estim error commit use fewer fewer term way length seri select match precis machin 3 check input argument valid function argument compar bound comput initi fatal error warn provid warn issu underflow result exampl fatal error issu case result return result overflow error issu use port error handler 9 4 comput approxim basic comput evalu truncat chebyshev seri reason singl seri accur whole argument rang thu argument rang broken sever subinterv usual three four seri appropri subinterv determin comput proce follow preprocess argument argument map interv 11 b evalu chebyshev seri done use threeterm linear recurr due clenshaw 3 c postprocess result seri valu final correct form interv necessari 3 vector multipl argument section describ routin design may extend case evalu multipl argument three opportun improv perform exist 1 reduct subprogram call overhead 2 vector pre postprocess phase 3 vector chebyshev seri evalu emphasi paper 2 3 vector function evalu routin multipl argument seem quit simpl first one simpli appli scalar algorithm vector argument un fortun fail rang possibl input argument divid sever subinterv handl differ sinc assum input argument sort way core algorithm proce follow argument rang gather argument rang temporari vector comput approxim argument vector mode scatter result back result vector clearli vector length depend upon distribut input argument gener less total number argument 31 exampl illustr transform consid follow statement fnlib routin gt xsml le 30 statement illustr one particular argument rang handl approxim case simpli 275 plu chebyshev seri sum return util csevl bioc array chebyshev seri coeffici nti0 number coeffici correspond vector code complex n gt statement modifi slightli origin code simplifi present argument array function evalu result return array f wgtle return array indx n indic element vector xsml 3 gather routin wgthr ycmp 20 loop preprocess argument array wc evalu chebyshev seri csevl except vector n argument store array tcmp b0 b1 b2 work array length loop postprocess result seri evalu wsctr put result appropri posit f preprocess postprocess phase trivial vectoriz remaind section investig vector indic subprogram 32 vector multipl chebyshev seri evalu next consid evalu truncat chebyshev seri vector first review seri evalu scalar code given argument x set chebyshev coeffici c due clenshaw evalu recurr scalar version 1 recurr seri 2 last term result f vector argument x j clear done x ff fi fl f becom vector assign loop run done howev recurr loop two unnecessari vector copi elimin loop unrol level three illustr follow vector version algorithm note three temporari vector length requir addit input vector x output vector f recurr vector version 1 recurr seri unrol 2 last term cleanup n divis three endif loop repeatedli util four vector remain vector regist entir comput unrol loop way yield 20 25 improv overal perform softwar cray ymp 33 vector util oper algorithm 2 form inner loop comput given argument rang perform vector store contigu memori quit desir sinc reduc possibl bank conflict memori refer howev argument correspond given rang need lie contigu input vector thu argument rang must gather togeth applic argument contigu vector comput requir function valu scatter back appropri locat output vector datahandl oper necessari thing signific term oper count lead signific perform degrad properli vector unfortun oper among like thwart vector compil none vector cyber 205 compil exampl wish implement code standard fortran permit easi custom case code ineffici facilit encapsul oper subprogram replac effici version avail next describ util detail case implement quit straightfor ward although vector compil convex c120 cray ymp effici implement util necessarili systemdepend see 5 exampl discuss gather scatter isol loop subprogram wgtmxanindx wlemxbnindx wgtlemxabnindx correspond oper 1 2 3 respect gatherscatt result index compress array indic j gather oper collect element vector x j indic contigu vector scatter invers x place simpl gather scatter loop subprogram wgthrnxindxi wsctrnyindxx respect outofrang test appli algorithm must determin whether element input vector rang ie greater less given scalar would like provid index first occur diagnost one attempt combin oper singl loop one get someth gener vectoriz eg ifxj gt go 25 instead first check error condit use simpler vectoriz loop eg ifxj gt tabl 1 usercal vfnlib subprogram singl doubl descript singl doubl vi0 dvi0 evalu 0 vector argument besi0 dbesi0 vi1 dvi1 evalu 1 vector argument besi1 dbesi1 vj0 dvj0 evalu j 0 vector argument besj0 dbesj0 vj1 dvj1 evalu j 1 vector argument besj1 dbesj1 vk0 dvk0 evalu k 0 vector argument besk0 dbesk0 vk1 dvk1 evalu k 1 vector argument besk1 dbesk1 vy0 dvy0 evalu 0 vector argument besy0 dbesy0 vy1 dvy1 evalu 1 vector argument besy1 dbesy1 key0 done otherwis comput first index loop like one number 20 way slow loop execut immedi error return follow oper repres subprogram wngtmxakey vector softwar use techniqu describ section produc portabl vector routin evalu follow bessel function real argument order zero one code employ basic algorithm fnlib retool vector environ call collect code vfnlib although produc new usercal version small portion origin fnlib techniqu use readili appli mani fnlib routin vfnlib includ usercal fortran subprogram list tabl 1 ident call sequenc call name x f work iwork info x array contain argument function evalu result return correspond posit array f work iwork workspac array iwork length work length 7m info return code singl precis doubl precis version subprogram provid routin actual driver partit work array call lowerlevel routin perform actual comput list subsidiari routin includ vfnlib given tabl 2 code standard fortran 77 elect provid error return code paramet rather issu error messag error handler done fnlib error condit indic nonzero return code info fatal error indic info 0 warn argument lead fatal error result return fatal error tabl 2 intern vfnlib subprogram singl doubl descript singl doubl wi0 dwi0 perform comput dvi0 wi1 dwi1 perform comput dvi1 wj0 dwj0 perform comput dvj0 wj1 dwj1 perform comput dvj1 wk0 dwk0 perform comput dvk0 wk1 dwk1 perform comput dvk1 wy0 dwy0 perform comput dvy0 wy1 dwy1 perform comput dvy1 wc dwc evalu chebyshev seri vector argument csevl dcsevl iwc idwc find number term need comput chebyshev seri given accuraci init initd wngt dwngt outofrang test x j wnle dwnle outofrang test x j b wgthr dwgthr vector gather wsctr dwsctr vector scatter wferr process fatal error messag seteru i1mach i1mach return integ machin constant 9 i1mach i1mach r1mach d1mach return real machin constant 9 r1mach d1mach condit 0 function undefin argument result overflow argument larg accur argument reduct possibl last three case index first offend argument return iwork1 warn issu result underflow correspond function valu set zero case use separ procedur handl error detect lowerlevel routin exampl nterm chebyshev seri evalu n 1 error caus improp user input never occur normal use routin except array work short code overwrit data reason thing case issu fatal error messag halt program done call simpl errorhandl routin wferr 5 evalu section evalu vfnlib respect three criteria accuraci effici portabl accuraci assess pure experiment mean ie comparison exist softwar problem set effici evalu seri experi cray ymp convex c120 sun sparcstat 1 final portabl verifi success port code system use appropri compil option flag nonansi construct 51 portabl accuraci sinc vfnlib repres vector subset fnlib first goal assur vfnlib routin return result compar correspond fnlib routin test program distribut packag compar function fnlib counterpart approxim 23000 argument verifi two differ five time machin epsilon rel differ use function valu greater one absolut differ less one code run three separ comput system sun sparcstat 1 sun 4 25 mhz weitek 3172base fpu use sun fortran 131 option fast o3 convex c120 convex unix 42 releas 90 use convex fc version v61 option o2 cray ymp2216 unico 60 use cf77 case avail option use check conform ansi x391978 fortran addit test done verifi set routin inde produc correct function valu ideal function routin return result rel error near machin precis rare case practic accuraci vfnlib routin assess evalu function four five thousand argument cray ymp fnlib vfnlib compar result comput extend precis use mathematica 12 case result return fnlib vfnlib rel error less 10 time machin epsilon singl precis 10 theta 10 gamma28 doubl precis two notabl except behavior occur function j describ behavior near function zero cancel error evalu chebyshev seri lead loss rel accuraci neighborhood zero function except j 1 case absolut error remain less 10 time machin epsilon problem avoid function routin eg cosin accur comput nearbi zero recast comput term present case infinit number zero appar period make strategi impract behavior larg argument larg argument function comput axgx given chebyshev seri g sine cosin sinc x size x sine cosin larg argument must comput x larg even one round error larg magnitud tabl 3 asymptot perform chebyshev seri evalu megaflop machin term scalar vector sun sparc 1 7 18 29 cray ymp2 20 127 1821 repres accur enough assur result return axgi small rel error occur even g comput full machin precis 52 effici chief motiv use vfnlib prospect improv comput rate vector processor assess advantag use vfnlib compar use vfn routin vector code repeat call correspond fnlib routin scalar code compar code three system describ section 51 sun sparcstat 1 convex c120 cray ymp2 first scalar workstat second vector minisupercomput third 2processor vector supercomput although use one processor test includ sun demonstr portabl softwar well show use vfnlib need degrad perform scalar processor test perform singl precis sun convex machin cray 64bit machin comput innermost loop vector code evalu chebyshev seri use algorithm section 32 tabl 3 list comput rate megaflop evalu singl chebyshev seri 2000 argument use scalar vector code subprogram csevl wc use purpos theoret peak rate convex cray 40 333 megaflop respect correspond linpack benchmark run 65 90 megaflop 6 light figur observ rate vector chebyshev seri evalu convex cray 15 182 respect seen quit reason unfortun seen comput bessel function evalu chebyshev seri overhead must paid gather scatter vector element well variou error check easi assess effect overhead cray ymp use hardwar perform monitor tabl 4 list measur asymptot comput rate megaflop usercal function obtain data evalu function 19 differ set 2000 argument differ argument distribut compar tabl 3 tabl 4 see comput rate full bessel function evalu declin 7 22 percent raw chebyshev seri evalu anoth measur perform speedup ratio scalar vector time multipl function evalu actual speedup depend upon distribut argument compar scalar vector code vector length 2000 distribut 19 differ tabl 4 asymptot perform bessel function cray ymp megaflop function 0 1 j scalar 90 87 106 104 78 80 91 90 vector 1487 1424 1645 1609 1628 1593 1720 1700 tabl 5 asymptot speedup scalar time vector time machin 0 1 j sun sparc 1 min 10 10 11 11 10 10 12 12 ave 11 11 12 12 12 12 13 13 max 12 12 14 12 13 14 16 15 convex c120 min 44 52 55 46 76 73 79 79 ave 58 59 64 56 80 80 84 85 max 65 62 68 60 83 91 93 96 convex c120 min 62 75 66 58 82 91 86 80 veclib ave 79 79 73 66 98 96 92 86 max 88 82 76 70 109 104 103 97 cray ymp2 min 162 153 145 139 208 209 148 149 ave 178 168 160 153 215 216 196 198 way among three differ argument rang test includ case argument singl rang well case one per cent argument given rang tabl 5 list minimum averag maximum speedup observ singl precis code comput speedup convex rang 44 96 speedup cray rang 139 230 entri label convex c120 veclib explain shortli also interest note vector code run faster scalar code sun case speedup one might predict tabl 3 16 125 143 sun convex cray respect averag speedup cray ymp given tabl 5 somewhat better contrast speedup convex larg predict investig gener execut profil subroutin evalu 0 vector length 2000 x first two column tabl 6 show percent time spent cray convex four differ activ innermost loop comput chebyshev seri evalu half comput occur cray howev convex half time spent index compress although compil vector index compress loop result code perform well one better straightforward fortran implement oper tabl percent time spent vi0 variou activ activ cray convex convex veclib chebyshev seri evalu 577 228 348 pre post process 121 102 158 index compress 200 502 202 gatherscatt 52 97 179 tabl 7 short vector speedup scalar time vector time machin length 0 1 j 20 12 10 10 12 12 12 11 12 20 18 18 18 16 22 23 20 22 cray convex howev convex veclib librari 4 contain fortrancal util optim perform index compress gatherscatt oper sinc care implement isol oper lowlevel util easili replac badli vector loop call veclib done entri third column tabl 6 obtain reason distribut although gatherscatt oper still occupi significantli larger percentag time cray use modifi version vfnlib util convex lead improv scalarvector speedup label convex c120 veclib tabl 5 test perform thu far assess perform code long vector also import assess penalti use vector code vector length short tabl 7 list sampl speedup function three machin vector length 2 20 argument test distribut two argument subrang intern vector length actual half list tabl one would expect vector code run slower case function valu request vector length 2 vector code run twice long sun cray five time long convex tabl 8 list vector length speedup 1 ie breakeven point vector code faster breakeven point rang 45 cray 711 convex 714 sun tabl 8 short vector breakeven point vector machin 0 1 j sun sparc 1 12 cray 6 conclus describ suit portabl fortran subprogram vfnlib comput bessel function real argument integ order code modif routin fullerton wellknown fnlib packag new routin allow user specifi array argument evalu function algorithm chang allow effect vector case speedup 13 22 use origin fnlib observ vfnlib code cray ymp modest speedup also observ sun sparcstat 1 scalar workstat vector techniqu employ vfnlib extend mani fnlib routin r handbook mathemat function formula slatec common mathemat librari note summat chebyshev seri convex comput corpor algorithm 692 model implement test packag spars basic linear algebra subprogram perform variou comput use standard linear equat softwar distribut mathemat softwar via electron mail chebyshev polynomi numer analysi algorithm 528 framework portabl librari portabl special function routin imsl inc system mathemat comput tr distribut mathemat softwar via electron mail mathematica system mathemat comput algorithm 692 model implement test packag spars basic linear algebra subprogram algorithm 528 framework portabl librari z portabl special function routin perform variou comput use standard linear equat softwar