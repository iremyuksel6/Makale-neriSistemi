optimist regist coalesc graphcolor regist alloc elimin copi coalesc sourc target node copi interfer interfer graph coalesc howev harm color graph tend yield graph node higher degre unlik aggress coalesc coalesc pair noninterf copyrel node conserv coalesc iter coalesc perform safe coalesc preserv color unfortun heurist give coalesc earli lose mani opportun coalesc would turn safe moreov ignor fact coalesc may even improv color graph reduc degre neighbor node interf sourc target node coalesc articl propos new heurist call optimist coalesc optimist perform aggress coalesc thu exploit posit impact coalesc aggress coalesc node spill split back separ node sinc better chanc color one split reduc overal spill amount b introduct mani optim compil take approach graph color global regist alloc 1 graph color abstract problem assign regist live rang program problem assign color node interfer graph regist alloc attempt color graph finit number machin regist one constraint two node connect interfer edg must color differ regist alloc fail color graph node must spill memori insert load store graph color minim number spill wellknown npcomplet problem mani heurist algorithm use 1 2 3 one import task regist alloc copi propag context graph color copi propag achiev simpli color sourc target node copi call copyrel node singl regist interfer interfer graph implement coalesc two node singl node interfer edg union sinc mani optim phase regist alloc includ instruct schedul 4 storetocopi promot 5 static singl assign ssa translat 6 leav behind mani copi slow program execut essenti minim copi coalesc may affect color interfer graph sinc coalesc node union interfer edg sourc target node coalesc might possibl color coalesc node make regist alloc problem challeng need minim spill cost maxim number coalesc copi coupl coalesc heurist propos handl optim problem origin chaitin regist alloc use aggress coalesc coalesc pair non interf copyrel node 1 obvious achiev best result copi elimin yet might suffer worst spill brigg et al develop heurist call conserv coalesc 2 perform coalesc color graph affect georg appel iter coalesc elimin copi interleav brigg heurist color simplif phase increas chanc conserv coalesc 7 conserv coalesc iter coalesc attempt avoid neg impact coalesc often ignor coalesc may even improv color node x interfer sourc target node coalesc number edg x reduc one coa lesc may yield addit opportun simplif graph improv overal col orabl order fulli exploit posit impact coalesc prefer use aggress coalesc except spill must control somehow paper propos new coalesc heurist call optimist coalesc optimist coalesc pair noninterf node chaitin heurist yet coalesc node need spill node split back two separ node give coalesc sinc split node less number interfer edg origin coalesc node might possibl color one without affect rest color color one lead reduct spill cost rest paper organ follow section briefli review graphcolor regist alloc section 3 describ previou coalesc heurist graphcolor framework section 4 describ optimist coalesc heurist experiment result present section 5 summari follow section 6 2 graphcolor regist alloc graph color problem assign color node given graph two node connect edg differ color graphcolor regist alloc node graph correspond live rang program number color repres machin regist two overlap live rang said interf correspond node connect edg sinc color gener graph g k color npcomplet need heurist algorithm chaitin et al implement graphcolor regist alloc base follow theorem 1 node x less k neighbor alway color matter gfxg color node x call lowdegre node node equal k neighbor call significantdegre node chaitin alloc repeatedli remov lowdegre node associ edg graph push node top stack simplifi phase either graph empti everi node graph signific graph empti alloc repeatedli take node back top stack assign machin regist accord interfer constraint select phase howev everi node signific alloc heurist select node store valu memori mark spill alloc insert spill instruct defus instruct mark live rang spill phase alloc step repeat scratch phase order chaitin color algorithm depict figur 1 renumb phase build phase also shown alloc construct live rang build interfer graph respect phase aggress coalesc describ next section build simplifi chaitinstyl renumb potenti renumb build coalesc select actual spill select aggress conserv coalesc b simplifi spill spill spill graph empti signific everi node coalesc coalesc figur 1 phase order chaitin alloc b brigg optimist alloc order reduc number spill node brigg et al introduc optimist color 2 everi node signific instead mark node spill alloc remov push stack call potentialspil select phase inde color node actuallyspil idea might chanc color avail signific degre node depend color neigh bor yet opportun pessimist given earli chaitin algorithm figur 1 b show phase order optimist color 1 1 origin flow graph brigg optimist alloc 3 approach copi coalesc coalesc includ neg posit impact color interfer graph two node coalesc coalesc node union edg coalesc might make kcolor graph kcolor hand node interfer node coalesc degre node reduc one may expos opportun simplifi graph exampl consid interfer graph figur 2 solid line repres interfer edg dot line indic copyrel edg b coalesc figur 2 twocolor graph becom graph twocolor figur b howev graph simplifi two color simplifi coalesc make graph twocolor chaitin color heurist b c b c c c ad ab b figur 2 exampl neg impact b posit impact coalesc two major heurist approach coalesc one elimin coalesc copi caus side effect fulli exploit posit impact chaitin aggress coalesc correspond focus reduc neg im pact basic idea employ conserv coalesc iter coalesc 31 approach aggress coalesc chaitin regist alloc perform aggress coalesc coalesc two noninterf copi relat node perspect copi elimi nation aggress coalesc achiev best result perspect color graph fulli exploit posit impact total ignor neg impact unfortun advantag posit impact aggress coalesc never note literatur never clude remateri phase 2 gener copi remov conserv coalesc see section 32 omit version optimist alloc evalu conserv coalesc gener coalesc heurist bound specif optim question posit impact interact neg impact affect overal color graph aggress coalesc employ brigg optimist alloc experiment result indic posit impact well outweigh neg impact color graph better conserv coalesc iter coalesc see section 5 32 approach conserv coalesc brigg optimist alloc includ optim phase call remateri reduc spill cost live rang valu cheapli reproduc constant 2 find rematerializ valu involv ssa transform yield mani copi oenod copi unlik copi coalesc aggress must coalesc conser vativ reckless coalesc would complet restor transform perform remateri izat undesir coalesc two node differ remateri tag chanc coalesc node spill motiv heurist conserv coalesc base follow theorem 2 given two node x coalesc node xy less k significantdegre neigh bor xy chang color interfer graph everi lowdegre node remov graph coalesc node xy certainli remov also sinc origin less k significantdegre neighbor consequ conservativelycoalesc node never spill note care taken count number significantdegre neighbor xy sinc simpl union significantdegre neighbor individu x might includ node becom lowdegre coalesc xy posit impact coalesc let x set significantdegre neighbor x respect number element set significantdegre neighbor xy ns xy comput follow k coalescingg 2 order complement conserv co alesc bias color use select phase 2 bias color elimin copi tri assign regist copyrel node appear iter coalesc algorithm 7 ignor term comput number significantdegre neighbor fail perform conserv coalesc fulli implement includ term fair comparison coalesc due conserv heurist iter coalesc propos coalesc copi conserv 7 perform conserv coalesc iter interleav simplif phase expos chanc conserv coalesc figur 3 depict phase order iter coalesc top optimist alloc build freez potenti renumb actual spill conserv coalesc select simplifi chaitinstyl coalesc freez freez copi coalesc spill empti graph coalesc figur 3 phase order iter coalesc top optimist alloc iter coalesc alloc maintain two group node one group set copyrel node complementari set non copyrel node simplifi lowdegre noncopi relat node decreas degre mani copi relat node yield opportun conserv coalesc coalesc node put group noncopyrel node copi relat neighbor edg noncopyrel node significantdegre node two copi relat node coalesc alloc freez one lowdegre copyrel node freez copyrel node mean give coalesc remov copyrel edg mark noncopyrel node frozen node may simplifi next iter node group significantdegre node potenti spill made iter simplif coalesc continu 321 problem conserv coalesc problem heurist conserv coalesc twofold first heurist give coalesc earli consid coalesc node violat heurist necessarili spill somewhat similar motiv idea brigg optimist alloc potentiallyspil node necessarili actuallyspil thu better delay spill decis later may also want delay spill concern later mani coalesc node violat heurist actuallyspil spill cost held modest level case actuallyspil section 53 includ experiment data justifi delay spill concern later secondli heurist less exploit posit impact coalesc consid exampl interfer graph figur 4 let us assum three color avail b lowest spill cost graph sinc conserv coalesc iter coalesc fail coalesc b c b smallest spill cost potenti spill push stack b remov graph node simplifi push stack shown right select phase node assign color shown right column stack except b must actuallyspil e color 2 1 everi node would assign color yet alway guarante c e e d212spill c f e color stack223h f e bc b color stack bc figur 4 alloc conserv coalesc b aggress coalesc howev coalesc b c yield lowdegre node figur 4 b allow everi node graph simplifi legal color without spill shown right column stack question often opportun aris real program 4 optimist regist coalesc order fulli exploit posit impact coa lesc optimist perform aggress coalesc simplif phase chaitin regist alloc implement aggress coalesc top brigg optimist alloc reduc spill cost actual spill need made coalesc node attempt reduc spill cost techniqu call live rang split live rang split spill cost reduct techniqu use mani optim compil 2 3 8 9 10 11 long live rang split shorter one copi loadstor insert care select place regist alloc avoid spill live rang split sinc shorter live rang like alloc regist longer one cost involv addit split instruct yet gener lower spill instruct even alloc avoid spill complet spill cost lower live rang split split spill other alloc regist unfortun live rang split global regist alloc easi implement due sever reason 11 12 primari difficulti decid insert split instruct context reduc spill cost coalesc node live rang split straightforward insert split copi origin locat coalesc copi locat context live rang split undo coalesc coalesc node xy need spill select phase split back x recov origin interfer edg might possibl color two split node degre node lower xy three possibl case color two split node first node color differ color howev assign differ color point select phase might ruin rest color node xy stack simplifi base fact x distinct eg common neighbor node x whose degre reduc coalesc thu simplifi node might color color neighbor cons quentli better color one node prefer node higher spill cost without affect rest color give color node though instead mark uncolor node actual spill moment tri find color process node left stack color avail node point safe color second case x color vice versa case mark actual spill final none x color case mark actual spill equal spill origin node xy exampl consid loop figur 5 whose interfer graph figur 5 b let us assum two color avail optimist coalesc coalesc b aggress shown figur 5 c sinc node simplifi potenti spill made coalesc node ab chosen potenti spill simplif result stack figur 5 assign two color success c select phase color avail ab ab split back yield interfer graph figur 5 b sinc b color stack empti node color safe ab c c ab c b coalesc split ab c c0 goto l1 b c e figur 5 exampl live rang split due live rang split prefer choos coalesc node potentialspil figur 5 c chosen potenti spill instead coalesc node ab stack would form figur 5 e case ab c would assign color first make actuallyspil one candid coalesc node potentialspil one ingredi node prefer better chanc color split eg coalesc node xyz compos three node prefer uv compos two node prefer includ estim spill cost follow given node x let g n denot degre x number ingredi node x number usedef instruct x respect addit usedef instruct spill cost loop nest denot c l respect spill cost comput 10dg split coalesc node xyz first split three individu node x z check color individu node color spill right away point remain color node make everi possibl combin split test color order test base spill cost split exampl z color individu spill cost 10 5 3 respect test split 3 exampl ab c one def two use instruct copi coalesc away assum spill cost load store c loop nest level l one spill cost ab 300 smaller either c 300 consequ ab chosen potentialspil follow z 3 neither xy xz color x color point z set asid later decis color node stack process one follow occur z 1 color singl color 2 color differ 3 one color spill 4 spill x z color differ color mean coalesc complet undon copi recov split coalesc node three node procedur appli phase order optimist coalesc top optimist regist alloc shown figur 6 regard spatial overhead optimist coa lesc alloc keep inform origin interfer edg node coalesc due possibl live rang split freed right coalesc heurist tempor overhead test color everi possibl combin split involv comput complex o2 n n number node consid previou exampl split xyz n three experi indic n 187 averag yet reach 9 n larg avoid unnecessari test exclud redund test eg check xyz color alreadi known xy color time overhead live rang split compens elimin actual spill obviat addit iter alloc phase renumb build select actual spill coalesc aggress split live rang undo coalesc simplifi chaitinstyl potenti spill graph empti signific everi node coalesc figur 6 phase order optimist coalesc top optimist alloc 5 experiment result order evalu optimist coalesc compar previou coalesc heurist perform empir studi context instruct schedul nonnumer code regist alloc problem context highli challeng aggress code schedul presenc complex control flow gener mani copi increas regist pressur experi four coalesc heurist environ 51 experiment environ experi perform sparcbas testb 13 input c code compil optim sparc assembl code regist window gcc compil sparcbas assembl code schedul highperform vliw code aggress schedul techniqu softwar pipelin allpath code mo tion renam 4 final vliw code simu late produc execut result benchmark compos seven nontrivi integ program eqntott espresso li compress yacc sed gzip resourc constraint vliw machin 16alu 8way branch machin generalpurpos regist 16 condit regist target schedul regist alloc aggress schedul compil renam regist use copi asneed basi parallel opportun aris exampl xx4 move due target regist x eg x live target branch want move instruct specul branch target renam x copi instruct copi xx left origin place instruct copi later elimin equival live rang renam repres gener way get rid nontru data depend instruct schedul context softwar pipelin copi gener circumv crossiter regist overwrit 14 coalesc due interfer code order remov inter ferenc unrol loop make mani copi coalesc 15 unrol perform regist alloc coalesc yield schedul code less copi experi context elimin copi gener instruct schedul 52 coalesc spill result oeooo f tmff sooo averag fooo ooo ooo ooooooooof figur 7 ratio elimin copi compar basecas alloc implement four coalesc heurist conserv iter aggress optimist top optimist alloc base case also implement chaitin origin regist alloc base aggress coalesc figur 7 depict ratio number copi elimin heurist copi elimin base case alloc ie 100 mean copi elimin chaitin alloc graph show conserv iter aggr sive optimist coalesc remov averag 629 760 960 956 copi remov chaitin respect graph indic optimist coalesc remov almost number copi aggress coalesc obvious differ 04 due undo coalesc live rang split one thing note graph aggress coalesc top brigg alloc remov averag 4 less copi top chaitin al locat due fact chaitin alloc gener spill make otherwis un coalesc copi coalesc exampl consid copi xy coalesc first round chaitin brigg alloc live rang x interfer eg definit right copi chaitin alloc spill x brigg chaitin might abl coalesc copi second round x split smaller piec make x xy interfer chaitin alloc elimin copi brigg expens spill oeooo f tmff sooo averag fooo ooo ooo ooooooooof figur 8 ratio spill instruct compar basecas alloc figur 8 show ratio number spill instruct gener heurist spill instruct gener chaitin 100 mean spill instruct gener chaitin graph show optimist coalesc gener smallest number spill instruct benchmark aggress coalesc also better conserv coalesc iter coalesc 4 except eqntott averag differ aggress coalesc optimist coalesc 5 due advantag color caus live rang split 53 evalu spill result spill result indic aggress coalesc make posit impact coalesc outweigh neg impact improv overal color graph order confirm analyz experiment result detail estim posit impact neg impact first estim neg impact coalesc measur mani node coalesc violat conserv heurist inde actuallyspil memori evalu aggress coalesc delay spill concern later justifi avoid confus follow discuss use term node singl primit node creat first build phase term chunk coalesc node compos sever node compress conserv coalesc iter coalesc gener spill instruct even chaitin alloc found posit impact coalesc well outweigh even benefit optimist regist alloc benchmark num node num node aggress optimist coalesc chunk violat chunk num spill ratio num spill ratio num chunk num chunk node chunk node chunk espresso 12731 4134 9659 2987 911 352 94 629 397 65 li 1478 492 compress sed averag 56 32 tabl 1 number node coalesc chunk violat chunk actuallyspil node benchmark num node spill node color node success success candid chunk fulli partial fulli color split num chunk spill spilledcolor color ratio chunk chunk chunk li compress sed averag 520 868 tabl 2 detail data live rang split tabl 1 first column show number coalesc chunk push stack firstround optimist regist alloc aggress optimist coalesc see figur 6 number node chunk mani chunk form violat conserv heurist number violat chunk number node violat chunk shown next column among node violat chunk number node actuallyspil memori aggress coalesc optimist coalesc describ number chunk third fourth column respect aggress coalesc averag 56 node among coalesc non conserv actuallyspil memori mean remain 944 node conserv coalesc miss coalesc opportun even though color success spill rate drop 32 optimist coalesc help live rang split analyz detail tabl 2 among violat chunk tabl 1 first column tabl 2 show number chunk candid live rang split number node chunk 5 candid chunk belong one follow three categori live rang split 5 note set candid chunk set potentiallyspil chunk set violat chunk denot p v respect follow relationship alway hold ae p ae v ffl fullyspil mean split spill memori ffl fullycolor mean split color success ffl partiallyspilledcolor mean split spill rest color tabl 2 show number fullyspil fullycolor partiallyspilledcolor chunk number node chunk 6 ratio success color node split candid node averag 520 ratio success split chunk ie least one whose split color candid chunk averag 868 reason optimist color spill less compar aggress coalesc one thing note number actual spill chunk aggress coalesc tabl 1 equal number split candid chunk fact actualspil candid chunk optimist coalesc tabl 2 reason compar spill aggress coalesc split optimist coalesc impos constraint subsequ color select phase make chunk stack actualspil candid result indic neg impact coalesc allevi optimist alloc 6 note number spill node chunk optimist coalesc tabl 1 sum partiallyspil fullyspil chunk tabl 2 live rang split posit impact coalesc ing order analyz posit impact coa lesc need measur number success color node due posit impact would otherwis spill memori unfortun number straightforward measur instead measur reduct interfer edg due posit impact depict tabl 3 benchmark first column show number interfer edg right first build phase rest tabl show number edg remov due posit impact heurist first select phase tabl show aggress coalesc remov four time mani interfer edg iter coalesc averag bench num num delet edg mark origin conser iter aggress edg vativ optimist espresso 744637 7530 16818 103032 li 103457 1554 2311 6524 compress 9228 106 217 866 sed 71366 1399 3156 6614 tabl 3 number reduc interfer edg due posit impact coalesc 6 summari paper propos new coalesc heurist fulli exploit posit impact coalesc via aggress coalesc top optimist alloc never evalu separ aggress coalesc compar conserv coalesc context optimist alloc wherea iter coalesc recent research work coalesc focus improv conserv coalesc experiment result indic aggress coalesc actual competit optimist alloc also shown neg impact aggress coalesc mitig live rang split phase revers problemat coalesc prematur conclud approach optimist coalesc alway better approach conserv coalesc two approach fundament differ evalu one context regist alloc hand analysi schedul code reveal special characterist would make optimist coalesc particularli use regist alloc left futur work evalu heurist context lead gener solut coalesc regist alloc r regist alloc spill via graph color improv graph color regist alloc prioritybas color approach regist alloc parallel nonnumer code select schedul softwar pipelin ing regist promot c program ferrant b iter regist coalesc ing loadstor rang analysi global regist alloc live rang split graph color regist alloc spill code minim via interfer region spill regist alloc via graph color softwar pipelin effect schedul techniqu vliw machin tr softwar pipelin effect schedul techniqu vliw machin prioritybas color approach regist alloc effici comput static singl assign form control depend graph loadstor rang analysi global regist alloc regist alloc via graph color improv graph color regist alloc iter regist coalesc spill code minim via interfer region spill callcost direct regist alloc regist promot c program parallel nonnumer code select schedul softwar pipelin fusionbas regist alloc use node merg enhanc graph color optim spill cisc machin regist unrollbas copi elimin enhanc pipelin schedul live rang split graph color regist alloc regist alloc myampersandamp spill via graph color ctr takuya nakaik tatsushi inagaki hideaki komatsu toshio nakatani profilebas global liverang split acm sigplan notic v41 n6 june 2006 christian wimmer hanspet mssenbck optim interv split linear scan regist alloc proceed 1st acmusenix intern confer virtual execut environ june 1112 2005 chicago il usa florent bouchez alain dart fabric rastello complex regist coalesc proceed intern symposium code gener optim p102114 march 1114 2007