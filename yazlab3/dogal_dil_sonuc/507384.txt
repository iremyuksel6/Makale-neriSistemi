firstord topolog queri one import class spatial databas queri class topolog queri queri invari homeomorph studi topolog queri express standard queri languag spatial databas firstord logic variou amount arithmet main technic result combinatori character express power topolog firstord logic regular spatial databas b introduct express power firstord logic finit relat databas well understood ahv95 ef95 much less known spatial databas also call constraint databas relat longer finit finit repres klp99 notion gener invari queri isomorph fundament relat databas model gener spatial databas variou way pvv94 given group g transform tran lation affin isometri similar homeomorph etc queri q ggener databas instanc transform fog denot set ggener firstord queri gener firstord queri undecid pvv94 express power fo g understood via sound complet decid languag languag said sound g contain fo g queri complet g express fo g queri choic group g depend inform one interest gvv97 give sound complet languag sever natur group transform translat affin isometri similar case group homeomorph left open appear proceed 15th ieee symposium logic comput scienc c ieee 2000 queri invari homeomorph also call topolog queri fundament import variou applic spatial databas ex ampl geograph databas queri like region adjac region b road b island come natur therefor topolog queri receiv lot attent literatur eg kpv97 psv99 sv98 kv99 basic result known topolog queri connect region express firstord logic gs99 gs97 bdlw96 think geograph databas planar 2 dimension databas instanc relat embed plane r 2 particular import psv99 proven topolog properti planar spatial databas repres finit structur call topolog invari instanc sv98 shown topolog invari use answer topolog queri particular sv98 proven firstord topolog queri spatial databas automat translat fixpoint queri topolog invari translat firstord topolog queri spatial databas firstord queri topolog invari proven possibl special case singl relat repres close region left open sv98 whether translat could extend case sever gion answer question neg idea repres topolog inform spatial databas instanc topolog invari two import drawback sens topolog invari contain much inform ideal would want store inform actual access queri languag usual fo furthermor topolog invari straightforward gener higher dimens issu find invari suitabl fo comput dimens rais kpv97 special case one singl relat repres close planar region cone structur given kpv97 captur precis firstord topolog inform intuit cone structur finit set contain possibl small neighborhood point result kpv97 show context firstord topolog queri could express local properti situat known true finit case kpv97 ask whether result gener databas instanc region necessarili close give neg answer question instanc one close region satisfi addit technic condit fulli two dimension kv99 introduc cone logic cl prove sound complet topolog fo ask result gener instanc necessarili close region sever region give neg answer kpv97 introduc two local oper spatial databas instanc preserv equival firstord topolog queri call topolog elementari e quival call two instanc equival transform instanc homeomorph appli oper kpv97 finit often main technic result rest easili follow especi simpl instanc call regular equival topolog firstord equival coincid paper organ follow recal basic definit spatial databas section 2 section 3 discuss topolog planar spatial databas topolog invari detail section 4 introduc topolog firstord queri review result kpv97 section 5 prove equival decid pspace main result regular instanc prove section 6 section 7 deriv firstord topolog queri translat firstord queri topolog invari section 8 briefli discuss problem find languag sound complet topolog fo 2 preliminari spatial databas fix underli structur r real either let r 0 1 r r poli vocabulari r ie either point jja bjj rg open ball radiu r around 1 matter fact could let r ominim structur real main result would remain true poli may also let 2 n assum done figur look better sinc interest topolog queri make differ subset r n n 1 rdefin firstord formula x vocabulari r schema finit collect region name let n 1 ndimension spatial databas instanc associ rdefin set r r n everi r 2 set r call region formal may interpret region name nari relat symbol view instanc firstord structur vocabulari r obtain expand underli structur r relat r 2 paper consid 2dimension pla spatial databas instanc conveni also assum region bound ie everi instanc schema everi r 2 exist r jjajj b 2 r bounded assumpt inessenti easili remov occasion simplifi matter queri nari queri n 0 schema map q associ rdefin subset qi r n everi instanc consid r 0 one point space let r queri usual call boolean queri basic queri languag take firstord logic fo vocabulari r defin nari queri 7 fa g schema 3 topolog planar instanc r 2 equip usual topolog interior set r 2 denot int closur cl boundari bd say set r 2 touch point 2 r 2 2 cl two set touch 2 touch point 2 1 vice versa stratif stratif fundament fact make topolog instanc easi handl stratif instanc finit partit r 2 1 2 either one point set homeomorph open interv 0 1 homeomorph open disk 2 cl cl 0 union element 3 r 2 2 either r follow lemma follow fact region instanc rdefin proof found vdd98 lemma 31 everi instanc exist stratif color cone let instanc pre color point 2 r 2 map fint bdi bde extg defin int 2 intr bde 2 bdr n r ext 2 r 2 n clr precel maxim connect set point precolor cone point 2 r 2 denot conea circular list precolor precel touch lemma 31 impli cone welldefin finit point 2 r 2 regular everi neighborhood u point 0 2 u otherwis singular follow lemma 31 instanc finit mani singular point call instanc regular singular point cone figur 1 two singular two regular cone regular singular point also call regular singular resp cf figur 1 conetyp denot cti list cone appear furthermor everi singular cone list also record often occur color point 2 r 2 pair cell cell color maxim connect set point color color cell c denot c lemma 31 impli finit mani cell assumpt region bound impli precis one unbound cell call exterior lemma 31 impli everi cell well defin dimens either 0 1 2 0 dimension cell precis set fag singular point let c set cell instanc defin binari adjac relat e c let two cell adjac touch call graph cell graph partit c three subset c 1 c 2 consist 0 1 2 dimension cell respect observ graph g tripartit partit c planar lemma 32 let instanc c 2 c 1 c 2 c either c homeomorph open disk 0 exist 1 c homeomorph open disk dm hole definit let dm n cl c homeomorph sphere open interv 0 1 proof follow easili lemma 31 2 skeleton instanc set 0 dimension cell 1dimension cell homeomorph 0 1 note skeleton regular instanc empti lemma 33 let instanc everi connect compon graph g n tree particular regular g tree proof follow jordan curv theorem lemma 32 2 figur 2 illustr typic connect compon instanc remov skeleton note everi con figur 2 nect compon graph g n uniqu ex terior cell may consid root tree tree direct fix root may speak parent children node follow observ use later lemma 34 let 0 instanc c 2 c 0such 2 adjac c exist 2 adjac c 0 topolog invari two instanc j schema homeomorph homeomorph 2 r 2 r 2 2 r ha 2 r j topolog invari instanc expans cell graph carri enough inform character instanc homeomorph vocabulari r 8ari r r 2 unari restrict feg cell graph g dim consist idimension cell 2 x contain exterior uniqu unbound cell everi r 2 unari relat r consist cell subset r give orient equival relat quadrupl c adjac c two quadrupl equival either clockwis order cell adjac c 2 f1 2g b 0 appear anticlockwis order cell adjac c 2 f1 2g 3 note empti regular instanc proven psv99 j homeomorph iff j isomorph comput time polynomi size sinc g planar graph canon planar graph p time actual assum canon sens homeomorph instanc j sv98 proven foqueri translat linear time fixpointcount queri furthermor foqueri translat foqueri instanc one close region precis mean recurs map associ everi 2 fo vocabulari f rg 0 2 fo vocabulari frg instanc frg r close set question left open whether result extend instanc one arbitrari region sever region section 6 give neg answer question 3 variou way defin orient equival sv98 4 precis ptime algorithm given instanc comput onetoon map c canon number homoemorph instanc j map isomorph j 4 topolog queri topolog elementari equival topolog queri queri topolog everi homeomorph h r 2 instanc denot set firstod formula defin topolog queri wellknown easi see set fo top decid follow lemma collect basic foqueri proof easi exercis lemma 41 1 everi color firstord x everi instanc everi 2 r 2 2 everi 2 fo formula bd fo everi instanc bd 3 formula 1 x 2 fo everi instanc note everi color formula fo top moreov 2 fo top formula bd fo top particular case r 2 hand formula 1 fo top topolog elementari equival two instanc j topolog elementari equival denot j satisfi topolog firstord sentenc proven kpv97 frg instanc j r r j close set j see next section equival extend instanc one arbitrari region sever region prove result kpv97 introduc two simpl local oper transform instanc elementari equival one straightforward extens sever region depict figur 3 read fol low suppos instanc contain open subset r 2 homeomorph one left hand side figur 3 differ shade grey display differ color replac correspond subset right hand side cf kpv97 detail note oper symmetr go right left appli oper first 2 second two oper figur 3 instanc j write j transform instanc homeomorph j applic 2 f1 2g figur 3 oper preserv j j transform finit sequenc oper 1 2 proof kpv97 easili yield lemma 42 instanc j j open question whether convers lemma 42 hold particular interest known whether decid wherea decid pspace proposit 55 next sec tion kpv97 shown coincid instanc one close region extend result sever region instanc regular cone 5 minim instanc definit 51 instanc minim satisfi follow two condit 1 homeomorph 1 iar adjac c homeomorph dm adjac b homeomorph 1 lemma 52 ptime algorithm associ everi instanc minim instanc mi mi done way homeomorph instanc j proof suppos first satisfi m1 show transform instanc j fewer cell violat m1 two applic 1 let c 1dimension cell homeomorph 1 neighbor c color neither homeomorph instanc local look like figur 41 appli 1 twice dash box obtain instanc local look like figur 43 obvious reduc number cell violat m1 1 2 3 figur 4 suppos satisfi m2 transform instanc j fewer cell violat m2 applic 1 without violat m1 see let b 2dimension cell adjac cell c homeomorph 1 color cell homeomorph 1 adjac two 2 dimension cell let neighbor color distinguish two case case 1 c 1 c 2 children b reduc number cell violat m2 applic figur 5 1 2 figur 5 case 2 c 1 parent b c 2 child figur 6 show proceed 1 2 figur 6 ptime algorithm transform given instanc minim instanc mi may proceed follow given algorithm first comput invari possibl ptime psv99 oper 1 2 translat simpl local oper algorithm first appli pair 1 m1 hold figur 4 hold done simpl greedi strategi result structur toplog invari minim instanc mi shown psv99 given invari instanc j comput polynomi time canon cf page 4 algorithm also guarante homeomorph instanc j languag instanc fundament curv instanc rdefin continu map lim a1 jjf ajj 1 f fundament curv everi 2dimension cell set f 1 c finit union open interv one form one form b 1 everi 0 1dimension cell c set f 1 c finit union close interv may singl point follow fact f rdefin interest finit sequenc color appear fundament curv ie finit word w f alphabet consist color appear say word w 2 realiz fundament curv f w f languag li set word realiz exampl 53 let instanc r fa 2 r 2 j 12 jjajj 1g five cell c 1 fa color c respect note c 5 color c 1 figur 7 b figur 8 exampl word realiz cf figur 7 hard see li describ finit automaton display figur 8 exampl easi see everi languag li regular accept automaton essenti cell graph formal let instanc defin finit automaton 1 new symbol denot cell fc denot exterior note graph underli cell graph g extend one addit vertex 1 adjac exterior proof follow lemma straightforward lemma 54 everi instanc automaton accept li thu li regular languag walk graph e sequenc 1 n map almost immedi everi instanc wn walk g usual ext denot exterior proposit 55 decid pspace proof given two instanc j want check pspace whether possibl go j use homeomorph oper given instanc possibl comput invari ptime psv99 thu problem reduc check pspace whether j deriv use oper polynomi mani differ way appli oper one consid tupl 5 cell check appli tupl let set invari obtain appli one oper previou remark show contain polynomi mani element comput ptime therefor possibl enumer topolog invari deriv appli oper check step whether correspond j latter done ptime decid whether two planar graph isomorph give strategi ensur process stop mi mj comput ptime lemma 52 assum j minim easi see oper chang cone instanc involv therefor j impli j conetyp cf page 3 orient relat check ptime cone determin number 1dimension cell homeomorph 0 1 impli instanc j j respect skeleton verifi js may view skeleton j embed planar graph 0dimension cell vertic 1dimension cell homeomorph 0 1 edg let f f j resepect denot face embed graph note face correspond precis connect compon g n g j n j spectiv number connect compon j bound c ji j number cone therefor number face j given euler formula jf j number connect compon j e v number edg vertic bound ji j jf j j give linear ji j bound number connect compon g j n j would also like bound size connect compon g j n j equival number 1dimension cell homeomorph 1 un fortun repeat applic oper 1 may produc arbitrari larg compon nevertheless possibl decid pspace whether k instanc k isomorph k j preserv color orient furthermor k comput pspace complex pspace need produc extra 1dimension cell homeomorph 1 process would restrict number possibl connect connect compon skeleton without loss gener assum j minim isomorph skeleton recal everi face f 2 f f 2 f j correspond connect compon f g n g j n j respect lemma 33 f tree canon root exterior cell find whether j isomorph preserv color orient check whether instanc 0 j 0 0 everi face f 2 f 0 f denot face correspond f isomorph suffic prove follow everi f 2 f claim 1 either 6 j j transform instanc 0 j 0 respect 0 0 compon f isomorph ffg compon g 0 remain h 2 f j n fifg compon h j 0 remain j decid pspace two altern hold latter 0 j 0 also comput pspace go isomorph pspace fix one also fix face f 2 f go need follow definit branch tree minim walk go root one leav walk g said regular never goe singular cell let set color j word w 2 defin mw word comput use rule spirit lemma 52 precis mean rewrit word w use rule color fact 1 let x regular walk g start possibl transform way f contain branch x x prove singl loop length start end without loss gener assum xn 2dimension cell start construct xn 2 new ball vn 1 vn colo easili done appli 1 2 assum next construct subinst whose cell graph path attach x appli 1 2 order get v surround v i1 vn kind induct start begin word time show convers also hold fact 2 possibl construct use oper new branch f exist walk x g start e f say walk x realiz word w check pspace whether given word realiz walk g start e f one way see reduc problem question whether two regular languag nonempti intersect prove claim 1 first transform 0 branch x start e let w x check whether walk x 0 realiz w x case fact 2 show 6 j case use fact 1 construct correspond branch construct j 0 revers role j clear algorithm find j way minim result instanc satisfi claimin next section conveni work slight simplif cell graph call 2 dimension cell b 6 ext instanc inessenti b homeomorph disk thu precis one neighbor g neighbor c b g anoth neighbor b let h graph obtain g delet vertic inessenti cell call h reduc cell graph 51 actual hold h instead g wn walk h 6 regular instanc recal instanc regular point 2 r 2 regular main result section coincid regular instanc corollari see equival 41 extend beyond instanc one close region illustr problem let us start simpl exampl exampl 61 let consid two instanc j r fa 3 jjajj 1g r j j r cf figur 9 obvious j conetyp figur 9 let us tri find sentenc 2 fo top j 6j first glanc look easi take sentenc say everi horizont line intersect region r intersect region everi instanc homeomorph satisfi everi instanc homeomorph j satisfi unfortun 62 fo top figur 10 show three instanc display homeomorph last one satisfi see later sentenc 2 fo top distinguish j quit complic let us note 6 j figur 10 recal lemma 33 cell graph thu reduc cell graph regular instanc tree think tree direct exterior root leav 2dimension cell homeomorph disk instanc j write h h j embed h h h j preserv defin accordingli lemma 62 regular instanc j h h j j homeomorph proof backward direct trivial forward direct let j regular instanc h h j follow lemma 34 g g j sinc regular instanc orient empti impli thu j homeomorph psv992 recal definit minim instanc mi associ instanc inspect proof lemma 52 show regular instanc minim regular instanc reduc cell graph h follow nice properti c vertex h neighbor c h differ color 62 lemma 63 let mn minim regular instanc proof easi consequ 52 62 2 recal regular languag l aperiod exist n 2 n u v w 2 uv n w 2 l also uv n1 w 2 l wellknown theorem mcnaughton papert mp71 schutzenberg sch65 aperiod languag precis languag defin firstord logic 5 follow lemma use later base 62 fact reduc cell graph regular instanc tree 5 furthermor precis starfre regular languag lemma 64 let minim regular instanc lm aperiod proof let minim regular instanc crucial step prove follow claim let walk h suppos contradict 63 wrong choos l minim v 2 l n 2 walk sinc adjac vertic cell graph thu reduc cell graph differ color l1 l 2 notat conveni let 0 nl choos nlg j subtre parent let 0 k n 62 impli klj1 l 2 impli tion l 3 defin walk 0 delet klj klj1 0 k n 1 63 hold contradict minim l prove 63 let n jh j u v w 2 shall prove uv n1 w 2 lm let k l length u v w respect x walk h exist x appli 63 walk walk minim regular instanc instanc j proof recal definit oper 1 2 figur 3 suffic prove statement instanc lm note word obtain w replac letter subword j 1 j 0 suppos contradict w 0 2 lm walk x 0 h 62 whenev henc n walk h similarli x contradict show w 0 lemma 66 let minim regular instanc j regular instanc lj 6 lm r curv f b x 7 x b proof assum j instanc schema denot ext ext 0 exterior j respect everi walk defin sequenc n follow let x 0 62 uniqu neighbor x 0 1 color x x 0 neighbor exist x 0 h j tree h satisfi 62 x j x 0 follow walk 0 note actual sequenc x 0 depend word x x 0 suppos x 0 xm1 must child xm tree h j choos b 2 r curv f b intersect cell xm1 let l walk h j correspond curv f b let j l minim xm1 xm1 child xm either 0 case theorem 67 let regular instanc schema sentenc 2 fo top vocabulari fg instanc j schema satisfi j proof let set color appear everi aperiod languag l formula l 2 fo vocabulari fg regular instanc satisfi l b b 2 r w f b 2 l easi consequ theorem mcnaughton papert schutzenberg aperiod languag precis firstord defin languag let mi l lm lemma 64 l aperiod let clearli satisfi claim instanc j prove claim note first everi instanc satisfi realiz cone thu regular let j regular instanc assum first j lemma 66 lj lm j mj lemma 65 lmj lm thu convers mj thu j prove 64 follow easili 2 fo top inde assum everi j 0 homeomorph j let n minim regular instanc h n shall prove instanc j schema suppos j mj 64 lemma 66 impli lmj lm minim regular n h n h lemma 63 impli mj lemma 62 follow mj homeomorph thu j convers suppos j lemma 42 thu j 2 fo top later follow easili previou paragraph corollari 68 regular instanc j final readi prove equival 41 extend beyond instanc one close region corollari 69 two instanc exampl 61 elementari equival neither instanc j frg defin r fa 7 translat sentenc topolog variant recal proven sv98 recurs map associ everi 2 fo vocabulari f rg 0 2 fo vocabulari frg instanc frg r close set purpos section prove extend arbitrari instanc proposit 71 sentenc 2 fo top vocabulari f rg everi sentenc 0 2 fo vocabulari frg instanc g 6j 0 proof let 0 j 0 instanc defin n 1 let n jn defin r r i0 r r i0 cf figur 11 figur 11 instanc 3 j 3 note n 1 n jn jm n 6 jn corollari 68 impli sentenc 2 fo top n 1 n jn 6j let n 1 graph g path 5 tice say c denot color color path form follow sequenc z time z time g jn except relat topolog invari ident jn dim 0 empti dim 1 consist c even dim 2 consist c odd orient empti final g standard ehrenfeuchtfrass techniqu show everi sentenc 0 2 fo n 1 jn statement proposit follow 2 8 complet languag open problem consid far find recurs languag express precis firstord topolog queri although certainli interest question doubt even theoret languag exist would natur languag may serv practic queri languag result show firstord topolog queri local hand known firstord logic fail express natur nonloc topolog queri connect region kv99 introduc topolog queri languag conelog cl express local properti languag two tier languag allow build firstord express whose atom firstord express talk cone color point kv99 proven cl captur precis firstord topolog properti instanc one close region fulli 2dimension underli structur r follow sv98 condit full 2dimension need corollari 69 show result extend instanc sever close region one arbitrari region propos extend cl path oper introduc bgls99 let us call result topolog queri languag pcl result bgls99 show languag basic properti expect reason spatial databas queri languag addi tion admit effici queri evalu cost evalu pclqueri substanti higher cost evalu firstord queri exampl pclqueri express fo connect region conjectur convers everi fo top queri express pcl idea behind conjectur local properti express cl togeth languag instanc describ pathoper seem captur firstord topolog properti instanc first step toward prove conjectur let us remark corollari 68 impli regular instanc everi fo top sentenc equival set pclsentenc 9 conclus result paper give good understand firstord topolog queri regular instanc cours one may argu regular instanc complet irrelev look map find singular point howev could use result answer sever open question concern topolog queri arbitrari instanc matter fact shown previou understand firstord topolog queri view local sens speak color point insuffici may main contribut problem character topolog elementari equival arbitrari planar instanc remain open conjectur corollari 68 gener ie arbitrari instanc true proposit 55 topolog elementari equival would decid pspace let us remark believ pspacebound proposit 55 optim see reason decid np even ptime r foundat databas relat express power constraint queri lan guag reachabl connect queri constraint databas languag relat databas interpret structur safe constraint queri finit model theori queri arithmet constraint finit represent databas constraint databas bart kuijper jan van den bussch topolog queri spatial databas finit monoid trivial subgroup queri spatial databas via topolog invari tr toward theori spatial databas queri extend abstract queri arithmet constraint finit represent databas relat express power constraint queri languag topolog queri spatial databas complet geometr queri languag reachabl connect queri constraint databas queri spatial databas via topolog invari foundat databas constraint databas captur firstord topolog properti planar spatial databas fixedpoint logic planar graph ctr michael benedikt jan van den bussch christof lding thoma wilk character firstord topolog properti planar spatial data proceed twentythird acm sigmodsigactsigart symposium principl databas system june 1416 2004 pari franc michael benedikt bart kuijper christof lding jan van den bussch thoma wilk character firstord topolog properti planar spatial data journal acm jacm v53 n2 p273305 march 2006