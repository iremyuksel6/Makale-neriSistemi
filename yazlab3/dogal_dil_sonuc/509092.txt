make spars gaussian elimin scalabl static pivot propos sever techniqu altern partial pivot stabil spars gaussian elimin numer experi demonstr wide rang problem new method stabl partial pivot main advantag new method partial pivot permit priori determin data structur commun pattern gaussian elimin make scalabl distribut memori machin base priori knowledg design highli parallel algorithm spars gaussian elimin triangular solv show suitabl largescal distribut memori machin b introduct earlier work 8 9 22 develop new algorithm solv unsymmetr spars linear system use gaussian elimin partial pivot gepp new algorithm highli effici workstat deep memori hierarchi share memori parallel machin modest number processor portabl implement algorithm appear softwar packag superlu serial superlu mt multithread public avail netlib 10 among fastest avail code problem share memori gepp algorithm reli finegrain memori access synchron share memori provid manag data structur need fillin creat dynam discov column depend column symbol use central task queue schedul load balanc reason perform dynam comput graph unfold runtim contrast choleski pivot order numer stabl howev techniqu expens research use resourc nation energi research scientif comput center support offic energi research us depart energi contract deac0376sf00098 research support part nsf grant asc9313958 doe grant defg0394er25219 ut subcontract ora4466 arpa contract daal0391c0047 doe grant defg0394er25206 nsf infrastructur grant cda8722788 cda9401156 doe grant defc0398er25351 1 rowcolumn equilibr row permut p r delta r delta delta c r c diagon matric p r row permut chosen make diagon larg compar offdiagon 2 find column permut p c preserv sparsiti c control diagon magnitud set ii p endif use l u factor follow iter refin iter multipli solv delta goto iter endif figur 1 outlin new gesp algorithm distribut memori machin instead distribut memori machin propos pivot dynam enabl static data structur optim graph manipul load balanc choleski 20 25 yet remain numer stabl retain numer stabil varieti techniqu prepivot larg element diagon iter refin ment use extra precis need allow low rank modif correct end section 2 show promis propos method numer experi call algorithm gesp gaussian elimin static pivot section 3 present mpi implement distribut algorithm lu factor triangular solv algorithm use elabor 2d nonuniform blockcycl data distribut initi result demonstr good scalabl factor rate exceed 8 gflop 512 node cray t3e stabil tradit partial pivot use control element growth gaussian elimin make algorithm numer stabl practic 1 howev partial pivot way control element growth varieti altern techniqu section present altern show experi appropri combin effect stabil gaussian elimin furthermor techniqu usual inexpens compar overal solut cost especi larg problem 21 gesp algorithm figur 1 sketch gesp algorithm incorpor techniqu consid motiv step 1 recal diagon domin matrix one diagon entri ii larger magnitud sum magnitud offdiagon entri row p exist even gepp unstabl rare 7 19 column p j known choos diagon pivot ensur stabil matric 7 19 expect diagon entri somehow made larger rel offdiagon row column diagon pivot stabl purpos step 1 choos diagon matric r c permut p r make ii larger sens experi number altern heurist algorithm step 1 13 depend follow graph represent n theta n spars matrix repres undirect weight bipartit graph one vertex row one vertex column edg appropri weight connect row vertex column vertex j nonzero entri ij find permut p r put larg entri diagon thu transform weight bipartit match problem graph diagon scale matric r r chosen independ make row column r ad c largest entri equal 1 magnitud use algorithm lapack subroutin dgeequ 3 algorithm 13 choos p r maxim differ properti diagon p r r ad c smallest magnitud diagon entri sum product magnitud best algorithm practic seem one 13 pick p r r c simultan diagon entri p r r ad c sigma1 offdiagon entri bound 1 magnitud product diagon entri maxim report result algorithm worst case serial complex algorithm delta nnza delta log n nnza number nonzero practic much faster actual time appear later step 2 new need superlu superlu mt 10 column permut p c obtain fillreduc heurist use minimum degre order algorithm 23 structur futur use approxim minimum degre column order algorithm davi et al 6 faster requir less memori sinc explicitli form also use nest dissect 17 note also appli p c row ensur larg diagon entri obtain step 1 remain diagon step 3 simpli set tini pivot encount elimin p machin precis equival small half precis perturb origin problem trade numer stabil abil keep pivot get small step 4 perform step iter refin solut accur enough also correct perturb step 3 termin criterion base componentwis backward error berr 7 condit berr mean comput solut exact solut slightli differ spars linear system nonzero entri ij chang one unit last place zero entri left unchang thu one say answer accur data deserv termin iter backward error berr smaller machin epsilon decreas least factor two compar previou iter second test avoid possibl stagnat figur 5 show berr alway small 22 numer result subsect illustr numer stabil runtim gesp algorithm 53 unsymmetr matric wide varieti applic applic domain matric given tabl 1 except two ecl32 wu obtain harwellbo collect 14 collect davi 5 matrix ecl32 provid jagesh sanghavi eec depart uc berkeley matrix wu provid yushu disciplin matric fluid flow cfd af23560 bbmat bramley1 bramley2 ex11 fidapm11 garon2 graham1 lnsp3937 ln 3937 raefsky3 rma10 venkat01 wu fluid mechan goodwin rim circuit simul add32 gre 1107 jpwh 991 memplu onetone1 onetone2 twoton devic simul wang3 wang4 ecl32 chemic engin extr1 hydr1 lhr01 radfr1 rdist1 rdist2 rdist3a west2021 petroleum engin orsirr 1 orsreg 1 sherman3 sherman4 sherman5 finit element pde av4408 av11924 stiff ode fs 541 2 olmstead flow model olm5000 aeroelast tols4000 reservoir model pore 2 crystal growth simul cry10000 power flow model gemat11 dielectr waveguid dw8192 eigenproblem astrophys mcfe plasma physic utm5940 econom mahinda orani678 tabl 1 test matric disciplin wu earth scienc divis lawrenc berkeley nation laboratori figur 2 plot dimens nnza nnzl ie number nonzero l u factor fillin matric sort increas order factor time matric interest parallel one take time ie one right graph figur clear matric larg dimens number nonzero also requir time factor time result report subsect obtain sgi onyx2 machin run irix 64 system 8 195 mhz mip r10000 processor 5120 mbyte main memori use singl processor sinc mainli interest numer accuraci parallel runtim report section 3 detail perform result section tabular format avail httpwwwnerscgovxiaoyesc98 among 53 matric would get wrong answer fail complet via divis zero pivot without pivot precaut 22 matric contain zero diagon begin remain zero elimin 5 creat zero diagon elimin therefor pivot would fail complet 27 matric 26 matric would get unaccept larg error due pivot growth experi righthand side vector gener true solut x true vector one ieee doubl precis use work precis machin epsilon 10 gamma16 figur 3 show number iter taken iter refin step matric termin iter 3 step 5 matric requir 1 step 31 matric requir 2 step 9 matric requir 3 step 8 matric requir 3 step matrix present two error metric figur 4 figur 5 assess accuraci stabil gesp figur 4 plot error gesp versu error gepp implement superlu matrix red dot green diagon mean two error red dot diagon mean lu factor time second dimens nonzero nonzero lu figur 2 characterist matric condit number number iter refin step gesp red geppblu figur 3 iter refin step gesp gesp accur red dot mean gepp accur figur 4 show error gesp littl larger smaller 21 53 error gepp figur 5 show componentwis backward error 7 also small usual near machin epsilon never larger 10 gamma12 although combin techniqu step 1 3 figur 1 work well matric found matric combin better exampl fidapm11 jpwh 991 orsirr 1 error larg unless omit p r step 1 ex11 radrf1 replac tini pivot p therefor softwar provid flexibl interfac user abl turn option evalu cost step gesp figur 1 done respect serial implement sinc parallel numer phase algorithm step 3 4 timeconsum particular larg enough matric lu factor step 3 domin step measur time step respect step 3 simpl equilibr step 1 comput r c use algorithm dgeequ lapack usual neglig easi parallel row column permut algorithm step 1 2 comput p r p c easi parallel parallel futur work fortun memori requir onnza 6 13 wherea memori requir l u factor grow superlinearli nnza meantim run singl processor figur 6 show fraction time spent find p r step 1 use algorithm 13 fraction factor time time signific small problem drop 1 10 larg matric requir long time factor problem interest parallel machin time find sparsitypreserv order p c step 2 much matrix depend usual cheaper factor although exist matric order expens nevertheless applic repeatedli solv system equat nonzero pattern differ valu order algorithm need run cost amort factor plan replac part algorithm error partial pivot refin gesp figur 4 error jjx true gammaxjj 1 condit number backward error gesp figur 5 backward error lu factor genp time second fraction genp time permut larg diagon triangular solv figur time factor solv permut larg diagon comput residu estim error bound 195 mhz mip r10000 order bbmat 38744 1771722 0224 5398 491 43 tabl 2 characterist test matric numsym fraction nonzero match equal valu symmetr locat strsym fraction nonzero match nonzero symmetr locat someth faster outlin section 21 seen figur 6 comput residu spars matrixvector multipl cheaper triangular solv take small fraction factor time larg matric solv time often less 5 factor time algorithm parallel see section 3 parallel perform data final code abil estim forward error bound true error jjx true gammaxjj 1 far expens step factor small matric expens factor sinc requir multipl triangular solv therefor user ask 3 implement mpi section describ design implement perform distribut algorithm two main step gesp method spars lu factor step 3 spars triangular solv use step 4 implement use mpi 26 commun data highli portabl test code number platform cray t3e ibm sp2 berkeley report result 512 node cray t3e900 nersc illustr scalabl algorithm restrict attent eight rel larg matric select testb tabl 1 repres differ applic domain characterist matric given tabl 2 31 matrix distribut distribut data structur distribut matrix twodimension blockcycl fashion distribut p process restrict power 2 arrang 2d process grid shape p r theta p c matrix decompos block submatric block cyclic map onto process grid row column dimens although 1d decomposit natur spars matric much easier implement 2d layout strike good balanc among local block load balanc cyclic map lower commun volum 2d map 2d layout use scalabl implement spars choleski factor 20 25 describ partit global matrix block partit base notion unsymmetr supernod first introduc 8 let l lower triangular matrix lu factor supernod rang column l triangular block diagon full row structur block ident row structur supernod store dens format memori supernod partit use block partit row column dimens n supernod nbyn matrix matrix partit n 2 block nonuniform size size block matrix depend clear diagon block squar full store zero u upper triangl diagon block wherea offdiagon block may rectangular may full matrix figur 7 illustr partit blockcycl map mean block map onto process coordin mod p r j mod p c process grid use map block li j factor need row process block row similarli block ui j need column process block column j 2d map block column l resid one process name column process exampl figur 7 kth block column l resid column process f0 3g process 3 own two nonzero block contigu global matrix schema right figur 7 depict data structur store nonzero block process besid numer valu store fortranstyl array nzval column major order need inform interpret locat row subscript nonzero store integ array index includ inform whole block column individu block note mani offdiagon block zero henc store neither store zero nonzero block lower upper triangl diagon block store l data structur process own dnp c e block column l need dnp c e pair indexnzv array matrix u use row orient storag block row own process although numer valu within block still use column major order similarli l also use pair indexnzv array store block row u due asymmetri nonzero block u skylin structur shown figur 7 see 8 detail skylin structur therefor organ index array differ l omit show figur sinc dynam pivot nonzero pattern l u determin symbol factor numer factor begin therefor block partit setup data structur perform symbol algorithm much cheaper execut oppos partial pivot size data structur forecast must determin fli factor proce 32 spars lu factor figur 8 outlin parallel spars lu factor algorithm use matlab notat integ rang submatric three step kth iter loop step 1 column process particip factor block column lk n k step 2 row process particip triangular solv obtain block row ukk rankb updat lk step 3 repres work also exhibit parallel two step b block size kth block columnrow eas understand algorithm present simplifi actual implement use pipelin organ process procc k step 1 iter k soon rankb updat step 3 iter k block column index storag block column l block nzval block row subscript full row lda nzval block row subscript full rows0000000001111111110000000001111111110000000000000000111111111111111111110000000000000001111111111111111111100001111000000000000000000001111111111111111111100000000011111111111100000011111100011111100011111100000011111100110011100110000111111001101100111000111000111 global matrix process mesh u figur 7 2d blockcycl layout data structur store local block column l let mycol myrow process column row number process grid let procc k procr k column row process block column row k block n obtain block column factor process row need els receiv need endif perform parallel triangular solv process column need els receiv need endif 3 n n endif end figur 8 distribut spars lu factor algorithm complet updat trail matrix ak own procc k 1 pipelin allevi lack parallel step 1 2 64 processor cray t3e instanc observ speedup 10 40 nonpipelin implement iter major commun step sendrec lk n k across process row sendrec ukk process column data structur see figur 7 ensur block lk n k ukk process contigu memori therebi elimin need pack unpack sendrec oper send mani smaller messag sendrec pair two messag exchang one index anoth nzval reduc amount commun employ notion elimin dag edag 18 send kth column l rowwis process own jth column l exist path supernod k j elimin dag done similarli columnwis commun row u therefor block l may sent fewer p c process block u may sent fewer p r process word commun take account sparsiti factor oppos sendtoal approach dens factor exampl af23560 4 theta 8 process total number messag reduc 351052 302570 16 fewer messag reduct even process sparser problem 33 spars triangular solv spars lower upper triangular solv also design around distribut data structur forward substitut proce bottom elimin tree root wherea back substitut proce root bottom figur 9 outlin algorithm spars lower triangular solv algorithm base sequenti variant call inner product formul formul kth subvector xk solv updat inner product must accumul subtract bk diagon process coordin k mod p r k mod process grid respons solv xk two counter frecv fmod use facilit asynchron execut differ oper frecvk count number process updat xk receiv diagon process own xk need distribut among row process procr k due sparsiti process procr k contribut updat frecvk becom zero necessari updat xk complet xk solv fmodk count number block modif sum local inner product updat store lsumk xk fmodk becom zero partial sum lsumk sent diagon process own xk execut program messagedriven process may receiv two type messag one partial sum lsumk anoth solut subvector xk appropri action taken accord messag type asynchron commun enabl larg overlap commun comput import commun comput ratio much higher triangular solv factor algorithm upper triangular solv similar illustr figur 9 howev row orient storag scheme use matrix u slight complic actual implement name build two vertic link list enabl rapid access matrix entri block column u let mycol myrow process column row number process grid let procc k column process block column k block k send xk column process procc k endif end work receiv messag messag lsumk send xk column process procc k endif els messag xk k li k 6 0 send lsumi diagon process own li endif end endif figur 9 distribut lower triangular solv l symbol numer tabl 3 lu factor time second megaflop rate 512 node t3e900 34 parallel perform recal partit block base supernod largest block size equal number column largest supernod larg matric thousand especi toward end matrix l larg granular would lead poor parallel load balanc therefor occur break larg supernod smaller chunk chunk exceed preset threshold maximum block size experi found maximum block size 20 30 good cray t3e use 24 perform result report section tabl 3 show perform factor cray t3e900 symbol analysi step 1 2 figur 1 yet parallel start copi entir matrix processor run step 1 2 independ processor thu time independ number processor first column tabl 3 report time spent symbol analysi memori requir symbol analysi small store manipul supernod graph l skeleton graph u much smaller graph l u subsequ column tabl show factor time vari number processor four larg matric bbmat ecl32 fidapm11 wang4 factor time continu decreas 512 processor demonstr good scalabl last column report numer factor rate mflop 8 gflop achiev matrix ecl32 fastest publish result seen implement parallel spars gaussian elimin tabl 3 start processor exampl could run fewer processor refer compar distribut memori code share memori superlu mt code use small number processor exampl use 4 processor dec alphaserv factor time superlu mt matric af23560 ex11 19 23 second respect compar 4 processor t3e time indic distribut data structur messag pass algorithm incur much overhead tabl 4 show perform lower upper triangular solv altogeth number processor continu increas beyond 64 solv time remain roughli although triangular solv achiev high megaflop rate time usual much less factor effici parallel algorithm depend mainli workload distribut much time spent commun one way measur load balanc follow let processor one t3e processor except 4 mb tertiari cach bbmat 369 342 227 223 183 56 ecl32 295 260 166 157 117 128 tabl 4 triangular solv time second megaflop rate t3e900 comm fact sol tabl 5 load balanc commun 64 processor cray t3e f denot number floatingpoint oper perform process comput load balanc word b averag workload divid maximum workload clear better load balanc parallel runtim least runtim slowest process whose workload highest tabl 5 present load balanc factor b factor solv phase seen tabl distribut workload good matric except twoton tabl also show fraction runtim spent commun number collect perform analysi tool call apprentic t3e amount commun quit excess even matric scale well bbmat ecl32 fidapm11 wang4 50 factor time spent commun solv much smaller amount comput commun take 95 total time expect percentag commun even higher processor total amount comput less constant although twoton rel larg matrix factor scale well larg matric one reason present submatrix process map result poor load distribut anoth reason due long time commun look commun time use apprentic found process idl 60 time wait receiv column block l sent process column left step 1 figur 8 idl 23 time wait receiv row block u sent process row step 2 figur 8 clearli critic path algorithm step 1 must preserv certain preced relat iter pipelin method shorten critic path extent expect length critic path reduc sophist dag task graph schedul solv found process idl 73 time wait messag arriv line figur 9 process much work larg amount commun commun bottleneck also occur matric problem pronounc twoton anoth problem twoton supernod size block size small 24 column averag result poor uniprocessor perform low megaflop rate conclud remark futur work propos number techniqu place partial pivot stabil spars gaussian elim inat effect demonstr numer experi techniqu enabl static analysi nonzero structur factor commun pattern result scalabl implement becom feasibl largescal distribut memori machin hundr processor preliminari softwar use quantum chemistri applic lawrenc berkeley nation laboratori complex unsymmetr system order 200000 solv within 2 minut 41 techniqu numer stabil although current gesp algorithm success larg number matric fail solv one finit element matrix av41092 pivot growth still larg combin current techniqu plan investig complementari techniqu stabil algorithm exampl use judici amount extra precis store matrix entri accur perform intern comput accur facil avail free intel architectur perform arithmet effici 80bit regist modest cost machin extra precis use factor residu comput also mix static partial pivot pivot within diagon block own singl processor smp within cluster smp enhanc stabil use aggress pivot size control strategi step 4 algorithm instead set tini pivot delta jjajj may set largest magnitud current column incur nontrivi amount rank1 perturb origin matrix end use shermanmorrisonwoodburi formula 7 recov invers origin matrix cost step invers iter remain seen circumst idea employ practic also theoret question answer 42 high perform issu order make solver entir scalabl need parallel symbol algorithm case start matrix initi distribut manner symbol algorithm determin best layout numer algorithm redistribut matrix necessari also requir us provid good interfac user know input matrix distribut manner lu factor investig gener function matrixtoprocess map schedul comput commun exploit knowledg edag expect relax much synchroni current factor algorithm reduc commun also consid switch dens factor one implement scalapack 4 submatrix lower right corner becom suffici dens uniprocessor perform also improv amalgam small supernod larg one speed spars triangular solv may appli graph color heurist reduc number parallel step 21 also altern algorithm substitut base partit invers 1 select invers 24 howev algorithm usual requir preprocess differ matrix distribut one use factor unclear whether preprocess redistribut offset benefit offer algorithm probabl depend number righthand side 5 relat work duff koster 13 appli techniqu permut larg entri diagon direct iter method direct method use multifront approach numer factor first proce diagon pivot previous chosen analysi structur aa diagon entri numer stabl elimin delay larger frontal matrix pass later stage show use initi permuta tion number delay pivot greatli reduc factor experi iter method gmre bicgstab qmr use ilu precondition converg rate substanti improv mani case initi permut employ amestoy duff lexcel 2 implement multifront approach distribut memori machin host perform fillreduc order estim frontal matrix structur static map assembl tree base symmetr pattern send inform processor numer factor frontal matrix factor master processor one slave processor due possibl delay pivot frontal matrix size may differ predict analysi phase master processor dynam determin mani slave processor actual use frontal matrix show good perform processor ibm sp2 mcspars 16 parallel unsymmetr linear system solver key compon solver reorder step transform matrix border block upper triangular form reorder first use unsymmetr order put rel larg entri diagon algorithm modifi version duff 11 12 unsymmetr order use sever symmetr permut preserv diagon order matrix desir form larg diagon entri better chanc obtain stabl factor pivot within diagon block number pivot border thu reduc larg medium grain parallel exploit factor diagon block elimin border block implement parallel factor algorithm cedar experiment share memori machin fu jiao yang 15 design parallel lu factor algorithm base follow static inform sparsiti pattern household qr factor contain union sparsiti pattern lu factor possibl pivot select use memori alloc comput conserv possibl zero entri arbitrarili conserv particularli matric aris circuit devic simul sever matric incur much overestim show good factor speed 128 processor cray t3e interest compar perform differ approach 6 acknowledg grate iain duff give us access earli version harwel subroutin mc64 permut larg entri diagon r highli parallel spars triangular solut multifront parallel distribut symmetr unsymmetr solver scalapack user guid univers florida spars matrix collect approxim minimum degre order unsymmetr matric appli numer linear algebra supernod approach spars partial pivot asynchron parallel supernod algorithm spars gaussian elimin algorithm 575 algorithm obtain maximum transvers design use algorithm permut larg entri diagon spars matric user guid harwellbo spars matrix collect releas 1 effici spars lu factor partial pivot distribut memori architectur solv larg nonsymmetr spars linear system use mcspars nest dissect regular finit element mesh elimin structur unsymmetr spars lu factor matrix comput optim scalabl parallel spars choleski factor scalabl iter solut spars linear system spars gaussian elimin high perform comput modif minimum degre algorithm multipl elimin effici parallel spars triangular solut select invers effici blockori approach parallel spars choleski factor tr elimin structur unsymmetr spars italicluital factor effici blockori approach parallel spars choleski factor scalabl iter solut spars linear system modif minimumdegre algorithm multipl elimin solv larg nonsymmetr spars linear system use mcspars appli numer linear algebra user guid effici spars lu factor partial pivot distribut memori architectur algorithm obtain maximum transvers algorithm 575 permut zerofre diagon f1 spars gaussian elimin high perform comput asynchron parallel supernod algorithm spars gaussian supernod approach spars partial pivot ctr bergen f hulsemann u rude 17 x 1010 unknown largest finit element system solv today proceed 2005 acmiee confer supercomput p5 novemb 1218 2005 laura grigori xiaoy li new schedul algorithm parallel spars lu factor static pivot proceed 2002 acmiee confer supercomput p118 novemb 16 2002 baltimor maryland mark baertschi xiaoy li solut threebodi problem quantum mechan use spars linear algebra parallel comput proceed 2001 acmiee confer supercomput cdrom p4747 novemb 1016 2001 denver colorado olaf schenk klau grtner twolevel dynam schedul pardiso improv scalabl share memori multiprocess system parallel comput v28 n2 p187197 februari 2002 patrick r amestoy iain duff jeanyv lexcel xiaoy li analysi comparison two gener spars solver distribut memori comput acm transact mathemat softwar tom v27 n4 p388421 decemb 2001 xiaoy li overview superlu algorithm implement user interfac acm transact mathemat softwar tom v31 n3 p302325 septemb 2005 xiaoy li jame w demmel david h bailey greg henri yozo hida jimmi iskandar william kahan suh kang anil kapur michael c martin brandon j thompson teresa tung daniel j yoo design implement test extend mix precis bla acm transact mathemat softwar tom v28 n2 p152205 june 2002 anshul gupta recent advanc direct method solv unsymmetr spars system linear equat acm transact mathemat softwar tom v28 n3 p301324 septemb 2002 xiaoy li jame w demmel superludist scalabl distributedmemori spars direct solver unsymmetr linear system acm transact mathemat softwar tom v29 n2 p110140 june