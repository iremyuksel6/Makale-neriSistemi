formal analysi class load java sinc java secur reli typesafeti jvm mani formal approach taken order prove sound jvm paper present new formal jvm prove sound first model employ dynam link bytecod verif analyz load constraint scheme java2 key concept requir prove sound new model augment valu type defin ordinari valu type combin load constraint scheme prove sound model shown problem insid current refer implement jvm respect model also analyz findclass scheme newli introduc java2 analysi also show applet exploit typespoof vulner report saraswat led introduct load constraint scheme b introduct unlik predecessor c java support platformindepend bytecod compil sourc program written java sent network mobil code execut java virtual machin run within local applic web browser jvm link bytecod sent network typesaf manner whose mean follow guarante link bytecod type inform consist destroy consist jvm state type inform follow requir also satis current jvm state consist type inform next execut step still consist java way typesaf languag two requir satis note consist broken jvm incorrectli interpret content point inner pointer refer type safeti jvm guarante memori safeti jvm thu play primari role java secur order show type safeti properti jvm akihiko tozawa masami hagiya graduat school scienc univers tokyo japan suggest comment articl appreci pleas send email fmile hagiyagissutokyoacjp number studi made far brie summari next subsect paper give anoth formal jvm prove sound bytecod run insid jvm structur class separatedli load link jvm object call class loader respons load link class support varieti class loader jvm achiev exibl class load howev exibl caus problem respect mention typesafeti java rst contribut work develop new model jvm describ section 2 paper detail model sever improv dene previou studi first includ class loader java class loader instanc userden class whose primari function map class name class object howev close relat jvm intern build class environ word class environ jvm static given lazili built dynam evalu class loader model give dynam environ repres intern heap jvm seem best approach model lazi link semant jvm class loader sinc consid static languag environ construct model practic one faith ect jvm implement 1998 sun microsystem releas version 12 java develop kit jdk12 base newli propos design principl call java2 come rewritten specic jvm java virtual machin specic 2nd edit 9 import featur introduc new specic load constraint scheme origin introduc liang bracha 8 scheme x saraswat problem 13 relat uniqu design java class loader formal also includ scheme second contribut work found three problem insid current ocial implement jvm respect scheme problem trivial one requir care analysi scheme done work formal describ section 3 third contribut work prove sound model given section 2 key notion requir sound proof augment valu type dene ordinari valu type combin load constraint scheme new type shown consist subtyp relat exist load constraint scheme note consist crucial sound model problem found insid current ocial implement jvm due violat consist anoth new featur java2 findclass implement class load technic speak load constraint scheme findclass scheme give constraint dynam class load java constraint restrict happen futur complic lazi link semant java exampl problem found load constraint scheme sensit time introduc con straint fact ect subtleti semant constraint analysi findclass scheme section 4 fourth contribut analysi also answer old question applet caus saraswat problem 13 11 relat work sinc java secur deepli reli jvm typesafeti give formal model jvm recent one major research issu network secur stata abadi 15 gave jvm model includ bytecod veric tri grasp jvm type system bytecod veric type rule wherebi correct jvm prove form sound theorem work lay concept model bytecod verier stata abadi work word extend model cope class loader freund mitchel work specic problem relat object initi 4 work also base stata abadi qian rst succeed model larg part jvm 12 formal cover wider rang jvm without proof given goldberg 5 jensen et al 6 particular jensen et al dealt saraswat bug model class load oper semant saraswat 13 gave formal explan problem dean also gave formal model class load 2 howev explain type spoong problem lazi semant class loader yet fulli model far know think someth studi modular work cardelli 1 machin veric also appli prove type sound java 1011 12 organ rest paper structur follow section 2 give basic formal model jvm also sound proof model section 3 mainli explain problem implement jvm section 4 give discuss relat findclass scheme formal answer old question applet caus saraswat problem 13 section 4 also discov new method implement load constraint scheme ecient model sound formal model jvm present paper follow new featur compar previou studi model lazi class load jvm dene load constraint modifi valu type statement give rigor denit environ enough model featur particular lazi class load jvm rst model studi note also last featur necessari dene wellformed type type option none type env f stringstr listt class cl ifac string list class instruct list lvar tvalu list list type verifyrecord f lvar string list stack string list invokevirtu string string string areturn figur 1 type denit environ turn dene term wellformed variou compon section rst explain sever basic denit section 24 give denit load constraint scheme main sound theorem describ section 25 21 environ 211 denit environ environ repres intern heap jvm basic data structur formal cours everi compon heap model instead give wellden set compon mathemat examin possibl repres type env see denit type figur 1 environ ie element env record consist four subset class loader tvalu method set loc locat map c w r mean subset clear index note end section type env consid depend type sinc map r arrow type construct use subset class loader tvalu method type member c v map locat appropri denit ie return denit store e refer member w repres class load r repres method resolut two map explain later use notat em extract member environ e figur 2 abbrevi insid judgment type option denot type compos constructor none valu wrap constructor exampl valu ewln either none form c type list denot type nite list list ith element x denot xi length lenx note classdeft denot tupl consist class loader tvalu method dene class classdeft separ two kind ident class situat happen valu method usual identifi object refer state ie element statet either exept denot error state record consist four element pc method lvar stack element verifyrecord give type local variabl stack state use bytecod veric type instruct instruct dene complet sake studi assum invokevirtu instruct areturn instruct type theori use type repres type env tupl consid element index set index dene follow use refer ie element loc access compon en viron cours dierent way dene identifi compon studi class identi tupl class name class loader two class name loader insid singl jvm model give low level abstract ect practic jvm im plement implement class ident properti one variou properti implicitli satis intern structur heap practic two class name loader class loader synchron two thread start load class loader time properti would easili violat go implement jvm alway satis properti instead extract set properti essenti sound model call wellformed en viron given assumpt modic updat environ must preserv wellformed wellformed environ denot wf e compos follow properti properti relat class insid environ properti relat method insid environ properti state method static veriabl ie gone bytecod veric bridg safeti properti relat load constraint scheme properti denot wf class wf method e veried bridg safe describ section 224 235 251 243 respect 22 object class loader section give basic denit object class class loader class java actual object instanc javalangclass class loader javalangclassload unlik object play essenti role jvm architectur refer automat implicitli therefor appropri dene object class class loader separ 221 class let us rst explain denit class figur 1 class denit ie element classdeft tupl consist class name direct super class name class loader note assum c class refer compon cs denit simpli written insid judgement cname csuper ccl respect two compon c method dispatch tabl cmt implement interfac class cifac discuss later 222 class loader java object instanti javalangclassload privat member declar hashtabl map name class class object model map ew follow denit 21 subtyp denit 22 widen cl denit 23 normal valu type denit 24 wellformed figur 3 predic relat class class name resolut n l ewln result c name n associ certain class c class loader l none also say n resolv c l sens class loader name space therefor class loader also call context class c dene class loader ccl wherebi everi class name resolut relat c done sens ccl context c throughout paper use word context class loader synonym figur show valu uniqu refer class thu class loader say valu v creat context vclasscl method execut context mcccl 223 subtyp subtyp class dene figur 3 model predic sub repres relat class c parent class name csuper resolv c 0 context ccl c direct subtyp c 0 indirect subtyp dene exiv transit closur direct subtyp 224 wellformed class actual class loader jvm resolv class one follow two way class loader l dene class c whose name n set ccl l resolv n c class loader l deleg class load anoth class loader resolv n c whose ccl equal l actual class loader therefor satisfi follow statement wellformed class dene figur 1 sinc class dene rst process set n l class c et class cname resolv c context ccl note statement immedi impli class ident properti describ section 213 225 object valu state jvm state stateet error state except follow compon method denot method jvm process pc program counter point certain instruct methodi lvar stack repres list valu store content local variabl local stack respect state environ repres intern data structur jvm transit respect distinct independ model valu found insid lvar stack object object valu v record one member vclass repres type class valu 1 practic java object valu may also refer array valu ie eld valu diculti extend model repres eld sinc alreadi valu heap add veld repres list valu refer model omit eld java getputeld instruct larg part similar invokevirtu also easier handl 226 predic respect subtyp valu type introduc two predic respect subtyp one repres widen convers repres type judgment valu formal given figur 3 widen convers dene quasiord 2 class name order two name dene resolv cl except case two name equal order follow subclass relat class name resolv normal valu type type judgment denot type valu v subtyp n context cl also dene n alreadi resolv cl note predic depend context cl 23 method section simpli describ specic invokevirtu 9 practic method invoc jvm involv diculti problem remain problem explain section 3 231 instruct dene figur 1 jvm model includ two instruct invokevirtu areturn instruct invokevirtu fundament non 1 java null valu repres uniniti object valu model simplic 2 accord denit sub cl satisfi transit antisymmetri cours practic trivial instruct jvm use three argument follow judgement mean current jvm state process invokevirtu call certain instanc method string name name method string list desc descriptor repres type signatur method argument type ie class name method desc0 return valu type string classnam name symbol referenc class 9 instruct areturn one return instruct jvm return caller hold one object valu return valu 232 method invoc execut invokevirtu consist follow three process method resolut look method accord three argument invokevirtu method found process call symbol referenc method denot srmethod method select look method access class object top local stack method invoc call method found method select process assum invokevirtu insid method whose class c whose context l ccl method resolut process model follow look method srmethod alreadi regist en viron er cf section 21 given name descriptor name desc srclass symbol referenc class result resolv classnam l rememb name desc srclass l abbrevi erlnam desc srclass denit given end section also section 3 practic jvm rememb whether symbol refer alreadi resolv never resolv refer twice 3 model ect behavior method select process dene section 3 section assum process result uniqu valu denot method write judgement e left hand side assum srmethod method insid right hand side denot symbol referenc method select method respect srmethod method although dention valu method left blank discuss implement later examin sound jvm ie 3 implement intern class represent attach ag resolv constant pool entri rememb whether entri resolv also rememb result resolut correct new load constraint scheme cf section 24 provid assum lemma 1 1 1 describ section 234 235 valu srmethod ident valu variabl appear predic invv ok e dene denit 25 invokevirtu ok predic mean jvm execut invokevirtu method resolut normal succeed ie rais except unlik speci method resolut invv ok e hold ie method resolut succe jvm model ensur method select method invoc also succeed method alway dene case formal name desc classnam srclass srmethod objectref denit invv ok e existenti quanti howev situat assum invv ok e refer judgement leak denit invv ok e ie variabl assum satisfi invv ok e 233 oper semant denit 26 describ state transit semant invokevirtu dene accord specic three process invokevir tual note denot list concaten rst tri resolv method resolv method resolv gener new state whose method select one local variabl store proper valu valu argument origin store stack must transit form point instruct areturn return instruct jvm mean invok method safe execut last stack return valu top push onto denot transit closur onestep transit transit instruct given paper see 15 7 except denit 26 oper semant invokevirtu execept lvar objectref arg methodi retval retvalrest state refer method cc figur 4 subtyp relat relat invokevirtu 234 invoc correct respect srmethod method follow lemma con sider lemma examin section 3 follow sever section lemma assum hold correct invokevirtu let e environ jvm state method overrid srmethod word lemma 1 correct invokevirtu guarante jvm execut invokevirtu jvm safe state method whose dene class superclass class objectref invok furthermor jvm safe state method overrid symbol referenc method invok second premis lemma subtyp relat objectref class srclass properti invariantli satis safe execut jvm cf section 241 rst consequ lemma subtyp relat objectref class method cc deriv method select algorithm describ section 311 see figur 4 method overrid relat overrid yet dene certain reason one reason although term overrid often use specic jvm accur mean dene interpret depend implement paper dene predic overrid section 311 conjunct predic select predic overrid satisfi follow condit lemma 1 implement sun jdk12 inconsist lemma 1 expos new aw explain section 3 relat environ dene section 253 235 wellformed method follow wellformed properti method requir mainli discuss section 4 select srmethod predic select model method select process denit found denit 31 section 311 class rt rr new rr figur 5 saraswat bug code predic select equival descriptor also hold lemma 1 24 bridg safeti bridg safeti jvm notion origin introduc saraswat report typespoong jdk11 13 insist applet loader never suer bug never break properti sheng bracha devis x saraswat bug implement jdk12 89 forc jvm check bridg safeti runtim 241 typespoong jdk11 see sourc code figur 5 reveal bug typespoong jdk11 code noth suspici exist two context l 1 l 2 code run l 1 deleg class load rr dene invoc rspeakup would result seriou violat type system jvm express rspeakup compli follow instruct jvm v dierent notat method descriptor repres method take argument return noth respect invokevirtu objectref valu top local stack equal valu r come context l 2 via invoc rrgetr l 2 symbol referenc class srclass class current context l 1 resolv r third string invokevirtu l 1 code caus problem r l 1 dierent r l 2 invokevirtu correctli execut subtyp relat denit 27 load constraint method overrid method resolut cl mdesci mcccl exiv cl n cl cl n cl cl 00 cl n cl 00 cl n cl 0 cl 0 n cl absolut necessari cours objectref class srclass suce recal subtyp relat second premis lemma 1 word method section 23 complet unrel srmethod accur bug result incompat dispatch tabl two class appli method index obtain srclass onto complet unrel method tabl objectref class jdk11 would thu either invok method argument valu incompat type core dump method dispatch tabl exclud sun specic therefor model implement techniqu method select algorithm cf section 313 242 load constraint go back exampl section 241 suppos jvm alreadi notic invoc rrgetr method brought valu type r context l 2 l 1 case check beforehand ow valu accept may simpli tri check follow l 2 attempt fail sinc method resolut speakup r l 1 evalu ie environ e r must consid altern ie load constraint scheme case new scheme introduc follow load constraint r jvm rememb constraint r l 1 allow resolv dierent class r l 2 method resolut process jvm notic possibl valu ow easi un derstand relat lemma 3 exist constraint describ later section give rule introduc load constraint method overrid 0 follow constraint introduc respect class name n appear descriptor method resolut nd srmethod follow constraint introduc class name n appear descriptor srmethod srmethod cl relat n dene transit exiv symmetr equival relat also minim relat among satisfi condit denit 27 formal describ predic induct denit shown later section 25 relat invari ie relat environ subsum n enabl jvm increment construct relat n resolv method refer invokevirtu link class whose method overrid anoth method reason load constraint scheme lightweight actual adopt among mani solut histori saraswat problem solut describ 813 243 bridg safeti predic denit 28 dene predic bridg safe follow environ e class loader e made resolut class contradict load constraint exist insid e predic forbid environ modic ie class load method link violat constraint jdk12 244 augment valu type augment valu type cl n dene follow anoth context cl 0 v type n normal sens cl 0 n also exist follow constraint cl n cl 0 intent denit may obviou roughli mean valu v creat ie instanti n context cl 0 transfer current context cl predic call dynam conform previou paper 16 note introduct crucial prove type sound load constraint scheme denit one contribut studi respect predic follow lemma import cl invari augment type denit 28 bridg safeti bridg safe def cl cl n cl cl cl 0 cl 0 denit 29 augment valu type cl cl n cl cl 0 n list cl ns string list cl nsi let e environ n n 0 class name cl class loader bridg cl n 0 cl cl proof follow fact prove examin def23 def29 def28 bridg cl n n cl 6 none cl n assum rst line lemma def22 def23 def21 cl n v cl appli e cl n cl def29 lemma prove lemma state augment type invariantli satis widen convers describ section 226 import statement relat runtim type static type ie bytecod veric proof lemma requir denit widen convers cl n 0 forc addit load n cl n 0cl case n 6 n 0 found two inconsist denit cl bytecod veric jdk12 exploit still entir escap addit check newli impos see section 3 16 detail note rel easi show augment type also invari use later sound proof 245 constraint exist lemma 3 exist constraint state jvm safe state execut invokevirtu alreadi exist load constraint class name appear descriptor invokevirtu current context context invok method assum lemma 1 correct invokevirtu note e cl desc cl 0 abbrevi cl desci cl 0 denit 210 veric rule rule rule invokevirtual6 6 6 6 6 6 4 istack0 mcl cname rule areturn4 lemma 3 exist constraint let e environ jvm state methoddesc method cl assum rst line lemma def27method overrid symmetri lemma 1 srmethod cl methoddesc method cl def27method rosolut def25 appli lemma 1 def27transit yield lemma 25 sound section follow framework sound proof stata abadi 15 one dierenc introduct environ anoth treatment invokevirtu instruct exist model 251 bytecod veric one uniqu underli languag design java found bytecod veric idea guarante runtim welltyped static veric allow minimum type check runtim see denit 210 type verifyrecord repres imaginari store static class name inform local variabl local stack map store element verifyrecord instruct method bytecod veric problem nding consist veri method denit 211 ktransit execept kn denit 212 welltyped veri method cl pclvar cl pcstack veri content satisfi mcl relat impos veric rule model consist repres predic veri predic veried state method e alreadi veri welltyped predic e wt mean state safe insid environ e lvar stack valu type class name record veri method state except repres error state alway welltyp note lvar cl pclvar abbrevi 8i cl pclvarsi interest work yelland 17 implement bytecod verier base type infer haskel 252 sound theorem main theorem theorem sound environ 0 state theorem state execut step jvm preserv welltyped intuit mean invari trivial sucient guarante correct invokevirtu second premis lemma 1 instruct model paper also preserv invari wherebi correct behavior instruct guarante theorem divid two lemma follow section denit 213 subenviron relat string list et class 253 sound environ updat denit 213 describ environ updat jvm dynam link object class etc dene subenviron relat two environ follow rst lemma need prove main sound theorem lemma state modic environ preserv well typed proof follow rememb assum lemma 1 1 1 rst assum guarante compon e compat e 0 therefor def213 def21 also def213 def23 cl cl n say relat sub cl invari furthermor lemma 1 def213 guarante follow fact respect impli relat n also invari minim among satisfi denit 27 therefor augment cl also invari dene def29 follow cl cl n cl 0 def212 lemma prove 254 sound state transit follow second lemma sound theorem lemma state everi state transit xed environ e preserv welltyped examin lemma reden state transit describ add depth k transit obvious note 0 denot state transit except transit instruct invokevirtu dene paper proof lemma follow rst note follow fact hold cl cl n cl 0 cl 0 express n invari augment type easili prove examin def29 def27transit transit follow fact sucient condit lemma prove induct k base case induct follow proof omit see 15 7 detail remain subgoal show case k1 induct hypothesi assum rst line iii state transit rule dene dene def26 induct hypothesi hold exist satis follow condit cl pcstack appli def210rul invokevirtu lemma 2 obtain x0 n 1 denot sublist x0 xn 1 n length desc assum invv ok e lemma 1 use impli methodcl method ccname togeth wf class hand lemma 1 1 1 impli togeth wf method use lemma 3 obtain methodcl method desc1 n 1 therefor lemma 2 def210rul impli methodcl 0 0lvar 0 satis 0 veri method method final def26 impli lvar stack0 n therefor induct hypothesi iv areturn lemma 2 lead methodcl method desc0 similarli use lemma 3 obtain final def210rul invokevirtu lemma 2 def26 def212 impli denit 31 predic select 3 analysi implement anoth main topic paper analysi sun jvm implement latter half section describ sever aw found jdk12 respect saraswat bug load constraint scheme describ aw let us examin lemma 1 correct invokevirtu 31 correct invokevirtu 311 method select section 23 dene method invoc process partial section denit 31 formal recurs procedur employ method resolut select dene predic select pair key class key c select method whose key equal key found lookup subtyp tree c superclass denit key denot pair name desc key mkey denot pair mname mdesc desc c select follow latter condit lemma 1 requir predic also invari denit denit select select process termin method found insid c matter whether anoth method 0 found insid superclass c howev case ie make 0 invis c say class c method mkey c select direct superclass c select dierent method 0 key mkey dene predic overrid dene exiv transit closur predic overrid faith follow sun specic srmethod method simpli dene follow method resolut process nd srmethod satis follow select srmethod method select process nd method satis follow select method see two denit deriv lemma 1 correct invokevirtu simpli appli premis lemma objectref class sub srclass dention overrid denit lemma 1 method desc hold matter whether method overrid exist specic explicitli use desc select method howev implement dier specici employ method dispatch tabl class select method long descriptor equival hold jvm never fall error state coredump even though state may badlytyp reason dicult specic explain typespoong problem figur 6 describ problem graphic 312 proof lemma 1 paper show lemma 1 respect specic though must prove exist implement rst show exist method sinc model method select process alway succeed assum invv ok e impli e srmethod key srclass select srmethod also assum denit 31 impli exist method sat ise alreadi note relat select hold objectref class method cc obtain rst consequ lemma second consequ follow method overrid srmethod prove induct sub overrid reexiv transit closur overrid objectref class sub srclass hold either method srmethod method overrid srmethod 313 method dispatch tabl method dispatch tabl list method satis follow condit method select class c method insid method dispatch tabl class cmt overrid method index overridden one ie class c superclass c 0 c index less length c 0 mt jvm increment build tabl structur class satis condit refer tabl direct superclass alreadi built suppos alreadi method dispatch tabl class sinc srclassmt collect method select srclass method resolut process jdk12 search insid srclass mt method resolut threfor dierenc specic implement method dispatch tabl seen outsid hand method select process implement remark dier specic o1tim procedur rather recurs procedur repres predic select method select process follow index satis srclass select srmethod select method method select process also sound also satis lemma 1 correct ness invokevirtu proof lemma sub relat necessarili use implement equival descriptor desc method desc even exist method depend sub relat without relat index srclass mt mean insid method mt exploit inconsist desc method desc one falsifi integ valu object valu vice vasa method exist jvm coredump 13 32 bytecod verier load constraint 321 problem respect widen convers go back saraswat bug code figur 5 section 24 suppos modic describ appli origin bug code origin code modi code6 4 new r r load l 1 r l1 insid method resolut load jdk12 r l1 r r l 2 load violat violat jdk11 spec execut rspeakup case method even method unexpect execut continu posibl method desc 6 desc wors case method may exist type confus coredump figur type spoong chart class rr public r getr return new r origin new r assum l 2 load class rr l 1 load class rt invok rrgetr also rspeakup also assum l 1 resolv r dierent l 2 method invoc r rrgetr call method insid class rr return valu type r type r insid context l 2 r subtyp r recal check widen convers r l2 alreadi resolv therefor constraint r check invoc rspeakup r l1 resolv assum convers r l2 resolv yet even though class r l1 resolv though constraint inde exist constraint never check figur 6 describ happen case fact jdk12 sometim resolv r l2 although resolut role bytecod verier 322 two inconsist found two inconsist bytecod verier jdk12 model still enabl type spoong inconsist follow widen convers n cl n 0 correctli check n 0 resolv system class veri runtim bug brie explain 16 exampl code let us emphas signic work problem concern augment type altern natur dene type sinc bytecod veric seem unrel saraswat bug design jdk12 modifi bytecod veric jdk11 howev jvm requir lemma 2 cl invari well relat welltyped invari bytecod veric base widen convers model make point clear visibl 33 interfac load constraint addit problem bytecod verier one aw insid jdk12 implement found analysi invokeinterfac instruct exclud model far 331 invokeinterfac instruct order discuss problem invokeinterfac extend model abl deal interfac java thing allow class multipl parent class throughout section class c list name implement interfac cifac reden subtyp relat c sub c 0 ie c direct subtyp introduc new predic classc true c pure class ie c interfac though class singl direct supertyp previou section fact use throughout sound proof thu requir chang invokeinterfac instruct similarli resolv select method exactli semant invokevirtu modic must consid predic select pure class c declar method requir key predic select method insid implement interfac c insid pure superclass c therefor reden second rule denit 31 follow classc classc 332 problem respect constraint exist question may rais code figur 7 dgetr overrid igetr accept denit overrid answer ye even though subtyp relat declar class two method sinc class select dgetr key repres r getr one direct supertyp also select igetr conclud dgetr overrid igetr denit overrid fact follow code invok method insid class safe interfac r getr class r getr class c extend implement figur 7 problem invokeinterfac sinc jdk12 fail recogn complex method overrid relat code figur 7 bring anoth problem load constraint scheme overrid relat dgetr igetr recogn may constraint loader dene respect name return type r 4 findclass scheme 41 formal findclass scheme also one new featur java2 ie implement class load findclass java2 recommend implement class loader findclass rather old loadclass method though loadclass also accept backward compat findclass scheme dene tree structur among class loader deleg class load follow tree structur old version java applet loader implement similar manner findclass scheme also known applet never caus saraswat problem though never prove complet lead follow question findclass scheme replac load constraint scheme last theorem theorem trust environ prove section 42 give neg answer even follow findclass scheme class load may violat constraint unless deleg allow system loader theorem state also saraswat correctli mention applet loader safe sinc deleg system loader howev 8 describ rst half class loader recent increas varieti applic consid applet loader deleg anoth applet loader although loader seem safe glanc theorem correctli state possibl violat constraint 411 parent loader follow denit incorpor findclass scheme model denit 41 parent loader true l vp parentdef l l vp l 0 direct parent loader loader l parent loader assum p l induct dene predic l vp l 0 denot l one indirect parent l 0 denit 42 correct deleg parent loader denit formal follow deleg strategi java2 loader l direct parent loader l 0 class load l rst deleg l 0 class load l l 0 resolv class name otherwis l return class l 0 return denit express load deleg follow parent loader relat express two loader parent loader relat correctli deleg class load accord strategi second condit impli ccl vp l l alreadi resolv cname therefor wf parent p hold loader e consid resolv class word e repres environ possibl class load complet ordinari environ thu consid subenviron environ therefor use dient font e environ note wf parent p impli wf class 412 parent environ dene relat envirno repres extens environ deleg parent loader denit 43 parent environ second line denit e method load loader e alreadi exist e third line state deleg allow direct parent loader e 42 trust environ theorem trust environ state even follow ndclass scheme jvm never violat constraint parent loader system loader st dene system environ denit 44 system environ predic dene condit system environ satisfi system class load class name appear method descriptor resolv theorem trust environ follow proposit satis 1 call trust environ satis consequ theorem theorem state e 1 trust environ e 2 exampl applet loader insid certain e 1 applet never violat constraint prior proof theorem introduc addit relat l 0 mean onestep constraint l l 0 allow method resolut method overrid symmetri deni tion 27 ignor symmetri two case e l n l 0 hold assum wf method section 235 method resolut l rememb l context resolv classnam impli wf parent p srclasscl vp l note also hold wf method e def31 gener onestep subtyp relat hold p wf parent p def21 def42 consequ subtyp relat sub also impli vp therefor wf parent p hold otherwis overrid relat case accord section 3 class c select superclass c select 0 fact impli follow one therefor def41 loader two dierent indirect direct parent load er one direct parent case follow result respect n l 0 l vp l 0 l 0 vp l furthermor easili show follow case note l p l 0 abbrevi l vp l result theorem trust environ prove follow proof assum given e assum l l 0 l 0 also l p l 0 def43 impli l system loader therefor ii impli note method dene system loader system method cf def43 def44 next goal prove follow fact prove induct deriv load con straint l n l 0 suppos follow onestep constraint append l n l 0 gener l n l 00 transit l 00 assum induct hypothesi show l 0 vp l 00 l 00 left case disjunct l 0 vp l 00 easi sinc vp transi tive therefor assum l 00 p l 0 case iii say exist c 0 e 1 class satis togeth def42 lead induct hypothesi impli impli c l 00 deriv e 1 c 0 cl vp l 00 lemma iv natur lead bridg easi show bridg safe hold make counter exampl violat con straint exampl e 1 follow loader 0 loader 0 dene class c class c method signatur x satisfi system 1 assum class x never resolv loader 0 ie method resolv loader 0 mcl addit loader 1 loader 1 dene class class call method class c signatur x loader 1 dene class x loader 1 deleg loader 0 class loader 2 loader 2 dene class class extend c class method signatur x loader 2 dene class x loader 2 deleg loader 0 class assum c class c dene loader obvious loader 2 overrid therefor denit 2 howev x loader 1 x 1 dierent therefor bridg hold 5 conclus present new model jvm explain variou uniqu featur jvm also speci sever condit implement particular model includ load constraint scheme ndclass scheme new featur jdk12 formal could analyz extrem subtl relationship load constraint scheme bytecod veric believ analysi possibl rigor formal sound proof howev model exclud mani featur jvm primit type eld member array type member modier thread instruct etc sever idea incorpor model exampl model easili express object class naliz jvm sound theorem section 25 state environ updat larger environ welltyped invari preserv fore introduc reduc environ also preserv invari sound naliz guarante ndclass scheme show work load constraint scheme howev also obtain method allow load constraint omit cooper ndclass scheme result includ paper think best solut expect scheme improv futur r link modur formal aspect mobil code secur web brower beyond type system object initi java bytecod languag speci secur dynam class load java formalis new method data ow analysi java virtual machin subroutin dynam class load java virtual chine java virtual machin speci java light typesaf de nite prove sound java bytecod veri formal speci java typesaf nicht veri type system java bytecod subroutin care analysi type spoo composit account java virtual machin tr ctr model multipl class loader calculu dynam link proceed 2004 acm symposium appli comput march 1417 2004 nicosia cypru