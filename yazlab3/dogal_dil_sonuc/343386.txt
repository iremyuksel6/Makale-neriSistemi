local orderinvari firstord formula queri local decis whether tupl structur satisfi queri depend small neighborhood tupl prove queri express orderinvari firstord formula local b introduct one fundament properti firstord formula local mean decis whether fix structur formula hold point tupl point depend small neighborhood point tupl result prove gaifman 5 give good intuit express power firstord logic particular provid conveni proof certain queri express firstord formula exampl decid whether path two vertic graph clearli suffic look small neighborhood vertic henc local stconnect express firstord logic centli libkin other 3 810 systemat start explor local tool prove inexpress result ultim goal line research would separ complex class particular separ tc 0 class languag recogn uniform famili boundeddepth circuit major gate logspac howev recent result hella 7 show even uniform ac 0 contain nonloc queri destroy hope nevertheless local remain import tool prove inexpress result queri languag databas theori one often face situat physic represent databas consid relat structur induc order structur order hidden user user may use order queri result queri depend given order word user may use fact order sinc know one make queri depend particular order may seem help actual firstord formula use order express orderinvari queri express without order unpublish result due gurevich 6 exampl queri refer reader 1 2 exampl 6 due 4 formal say firstord formula x whose vocabulari contain order symbol orderinvari class c structur structur 2 c tupl element linear order 1 2 hold hold easi consequ interpol theorem formula orderinvari class structur equival firstord formula use order longer true restrict class finit structur class consist singl infinit structur unfortun case show natur applic comput scienc prove class c structur firstord formula order invari c defin queri local structur c pure firstord logic properti local give us good intuit express power orderinvari firstord formula simpl method prove inexpress result paper organ follow preliminari prove local orderinvari firstord formula one free variabl section 3 crucial step toward main result follow section reduc case formula arbitrarili mani variabl onevari case would like thank juha nurmonen point us problem clemen lautemann fruit discuss solut preliminari vocabulari set contain finit mani relat constant symbol structur consist set call univers interpret r r rari relat symbol r 2 interpret c 2 constant exampl graph consid fegstructur e binari relat symbol order structur structur whose vocabulari contain distinguish binari relat symbol interpret linear order univers denot set integ occasion need consid string finit structur l 1 let l denot vocabulari f constant symbol min max repres string lletter alphabet order l structur univers 1 n p j interpret g everi j notat distinguish string represent finit structur given l 0 refer string lstring structur b subset contain constant induc substructur univers b denot hbi let oe ae vocabulari oereduct structur denot aj oe oestructur univers symbol oe interpret hand structur aj call expans b oestructur b relat r expans b suitabl vocabulari oe oe contain addit symbol oe new k ari relat symbol new constant symbol class structur kari queri c map ae assign kari relat structur 2 c isomorph structur isomorph f b also isomorph expand structur aea b aeb boolean 0ari queri c subclass c close isomorph 21 type game equival firstord logic character term follow ehren definit 1 let r 0 0 structur vocabulari rround ef game 0 play two player call spoiler duplic r round game spoiler either choos element v element v 0 0 duplic answer choos element v 0 0 element v respect duplic win game map map v v 0 constant c correspond constant c 0 partial isomorph isomorph substructur gener domain substructur 0 gener imag clear defin notion win strategi duplic game quantifierdepth firstord formula maxim number nest quantifi formula rtype structur set firstord sentenc quantifierdepth r satisfi wellknown fact vocabulari finit number distinct rtype structur simpli finit mani inequival firstord formula vocabulari quantifi depth r write r 0 denot 0 rtype theorem 2 let r 0 0 structur vocabulari r 0 duplic win strategi rround efgam 0 follow two simpl exampl need later may serv exercis reader prove nonexpress result use efgam exampl 3 let r 1 use rround efgam hard see string 1 rtype impli exampl class f1 n defin firstord sentenc exampl 4 may consid boolean algebra structur vocabulari ft u 0 1g particular let pn denot powerset algebra 1 n hard prove r 1 exist n pn r pn 1 thu class eveng defin firstord sentenc applic conveni modifi efgam follow instead choos element round game spoiler may also decid skip round case v v 0 remain undefin may also write v cours undefin v consid decis whether duplic win obviou duplic win strategi rround modifi efgam 0 win strategi origin rround efgam 22 order invari firstord logic definit 5 let vocabulari contain c class struc ture formula x vocabulari fg orderinvari c linear order order invari class fag also say orderinvari simplifi notat fgformula x orderinvari class c structur 2 c 2 write j inv denot henc order furthermor say x defin queri 7 fa j j inv ag c 1 easili extend definit boolean queri let us emphas although orderinvari firstord logic sound like restrict pure firstord logic actual extens queri class finit structur defin orderinvari firstord formula pure firstord formula 6 follow exampl found 4 exampl 6 orderinvari firstord sentenc vocabulari defin queri fpn j n eveng class finit boolean algebra exampl 4 queri defin firstord logic similarli let disjoint union structur pn n 1 unari queri x belong compon even number atom fag defin orderinvari firstord formula plain firstord formula 23 local formula let structur gaifman graph graph univers adjac relat symbol r 2 tupl c r c b occur c distanc b two element defin length shortest path b gaifman graph path exist let 1 ffibal around 2 defin set b b ffig ffispher set ffig clear context usual omit superscript set b c let db b tupl let 1 ambigu x also defin queri class fgstructur speak queri defin orderinvari formula alway refer queri defin text definit 7 1 kari queri ae class c local exist 0 2 c least call local rank ae orderinvari class c local queri defin local local rank x local rank queri emphas definit local orderinvari formula neither isomorph distanc function refer linear order gaifman 5 prove firstord formula defin local queri 3 local invari formula one free variabl section go show firstord formula one free variabl orderinvari class c structur also local c formal state prove result need prepar lemma 8 l r 2 n mn 2 n lstring size least n unari relat p p 0 proof let l r 2 n fix number rtype vocabulari l let choos n larg enough whenev edg complet graph n vertic color color induc subgraph size whose edg color lstring length n 0 n denot lsubstr color pair fi jg edg fi jg complet graph 1 n rtype represent hi ji choic n find structur hp rtype let g claim p intuit prove claim carri win strategi duplic string structur recal exampl 3 strategi exist formal proceed follow defin map f 1 consid rround efgam p usual let v v 0 element chosen round difficult prove induct duplic play way everi r one follow condit hold follow two subcondit hold duplic win strategi r gamma iround modifi efgam u fv 1 b duplic win strategi r gamma iround modifi ef game hp fv ident hp fv els g 0 ident hp fv 0 clearli impli claim thu statement lemma 2 lemma 9 firstord formula x orderinvari class c structur local c proof let x firstord formula quantifierdepth r orderinvari class c structur let l 0 number differ rtype vocabulari q new unari relat symbol let l l 0 2 let n given lemma 8 wrt r l let n2 r b via isomorph goal show linear order 1 2 b conclud order prove exist linear order first show wlog assum follow set w fa bg automorph ae hb w show distinguish follow two case 2 case simpli set w fa bg defin ae case 2 assum first da 4 0 also db 2 furthermor choic b b conclud proof given hand da everi set henc assum follow make use b oppos b easi see everi sphere w disjoint union orbit ae ie disjoint union set form fix everi linear order orbit sphere w next fix preorder oe follow properti oe linear order sphere w orbit c come orbit c order orbit chosen c c 0 relat respect oe whenev c c orbit linear order 1 2 refin oe differ insid orbit assum sphere w empti otherwis b w would union connect compon henc could fix linear order orbit b w defin 1 combin oe 2 combin imag ae oe orbit fix vertex vo defin linear order 0 finit delta ae infinit everi k denot k imag 0 ae k easi see w catch intuit idea proof reader pictur sphere w sequenc concentr cycl w innermost outsid cycl rest structur fix order oe automorph ae turn cycl say clockwis particular turn cycl w far enough map b cycl order clockwis 0 order k result turn cycl kstep unfortun exactli true usual orbit form whole sphere may form small cycl infinit cycl essenti right pictur defin order 1 2 proceed follow w let 1 0 look 2 look b hand outermost cycl w order outsid structur fix let 1 2 w fix begin proof determin two sequenc alreadi know j w reach j 1 turn one step let 1 1 j1 w stick reach j2 w turn let 1 2 go like last turn jm w 1 want similarli defin 2 start 1 take turn sphere end 2 sphere k w cours turn detect hide took one turn defin 1 idea consid sequenc sphere long string whose letter type sphere posit turn taken consid unari predic string lemma 8 find unari predic size respect expans string predic indistinguish exactli need essenti cours nasti detail 1 everi substructur induc sphere ihgammaj w let everi structur let linear order j defin combin order j sphere oe final let e j linear order obtain combin oe sphere q w q ih j1 sphere q w q ih everi everi defin unari relat q icj w ie vertex v q j distanc central sphere j defin lstring l enumer pair rtype gstructur set pair rtype lemma 8 choic paramet l exist unari relat duplic win strategi rround game p p 0 readi defin linear order 1 2 everi let 1 defin ui 62 p e ui defin ui observ although i1 disjoint definit consist remain show duplic win strategi rround game b win strategi duplic obtain transfer win strategi p p 0 make use gap preserv techniqu invent 11 everi fi fl defin function f fifl x go show duplic play way everi follow condit hold 1 exist fi vertic q fifl one success superspher gap 2 rgammai sphere contain chosen vertic 2 duplic r gamma iround win strategi modifi game 3 everi fifl duplic rgammairound win strategi modifi game structur f fifl v j 4 everi 5 everi refer element element element b gammafi w middl element other outer element first show conclud condit duplic win strategi let v r element chosen game let j k r show v 0 b map 7 b v 7 v 0 r partial isomorph c k follow immedi 5 rememb definit sphere impli element sphere succeed sphere relat relat henc v j v k group element ie inner middl outer b follow immedi 1 ensur properti fi fl 3 5 ensur v 0 k group v j v k respect c follow similar reason middl outer inner element b c follow immedi 2 3 respect 4 5 remain show induct 14 hold everi r immedi 2 hold lemma 8 true wlog spoiler select vertex v 1 case choos v 0 complet analog condit 1 5 symmetr let fi denot valu fi fl obtain 1 distinguish follow case case choos immedi hold induct case also choos 2 subcas induct element z duplic win strategi r gamma round game rtype f fifl v z 2 p 0 either two substructur linear order type j j 0 j j 0 linear order type j j 0 either case exist element v 0 z 3 hold choic z 2 also follow 1 hold v v 0 q p 4 hold outer structur noth chang final 5 still hold b fl w affect either 3 induct hypothesi duplic r win strategi modifi game structur f fifl v j henc v 0 still r gamma iround win strategi modifi game structur f fifl v j f fifl v 0 impli 3 1 2 4 immedi lie former gap 2 subcas case choos case choos exist appropri v 0 follow case analog ii condit 3 ensur exist win strategi also buffer zone case handl second subcas iii case fi fl chosen way first subcas iii v 0 chosen aev henc 1 hold simpli choos v 0 immedi case fi remark 10 later refer let us observ lemma impli statement local rank x c bound function vocabulari quantifierdepth x precis vocabulari r 0 r follow hold firstord formula x vocabulari quantifierdepth r orderinvari class c structur local c local rank see follow lemma let c class structur x orderinvari rememb finit mani firstord formula vocabulari quantifierdepth r 4 local invari formula arbitrarili mani free variabl lemma 11 let vocabulari r 0 k 1 exist follow hold x firstord formula vocabulari quantifierdepth r orderinvari structur proof first give sketch proof proof induct k lemma restat local orderinvari firstord formula one free variabl prove lemma 9 k 1 assum ktupl b j far apart hypothesi lemma requir isomorph suffici larg prove b distinguish orderinvari formula vocabulari quantifierdepth r distinguish three case first b say b k far away treat constant appli lemma 9 show k b k distinguish expand structur use hypothesi da 1 treat b k constant appli induct hypothesi prove distinguish expand structur b k requir hypothesi second case similar assum h 1 iter partial isomorph h map far away first show h distinguish h b distinguish third case h 1 entir tupl h close restrict automorph substructur map b modifi substructur way tupl b encod singl element appli lemma 9 describ proof detail note prove lemma induct k follow lemma 9 recal remark 10 see r function r suppos statement lemma prove let vocabulari r 0 let binari relat symbol contain let let structur 2 db shall prove let isomorph hb ai hb bi 1 k j k without loss gener assum k properti use hypothesi note formula orderinvari structur sinc assum greater equal induct hypothesi next note fd 1 gstructur use hypothesi similar argument show 4 5 impli 2 case 2 case 1 hold z 2 z k choos z properti jzj least possibl assum without loss gener j k suffic prove case 1 similar argument show yield 2 case 3 z 2 z k j k z note z 2 z domain contain b 2 z 1 domain b 6a z j automorph substructur hbi binari relat symbol contain expand 1 note remain automorph hbi e thu z 2 z furthermor orderinvari e henc choic 6 thu 2theorem 12 everi firstord formula orderinvari class c structur local c proof first give sketch proof proof induct number k free variabl formula alreadi prove formula one free variabl local invari c 2 c b 2 k hb ai suffici larg either j b far apart appli lemma 11 close togeth latter case defin new structur encod pair element close togeth new element spoil distanc much encod ktupl smaller tupl still isomorph neighborhood appli induct hypothesi formal prove follow statement induct k let vocabulari r 0 k 1 firstord formula vocabulari quantifi depth r structur orderinvari local localityrank follow lemma 9 cf remark 10 suppos prove firstord formula vocabulari quantifi rank r order invari structur choos accord lemma 11 let r 1 binari relat symbol contain g let let b 0 structur obtain ad new vertex 2 r 1 edg ba 1 2 1 r 2 edg ba 1 2 2 note b 2 furthermor ij orderinvari b thu induct hypothesi local b local rank 0 k lemma 11 without loss gener assum da 1 2 2 sinc 2 also b consid structur ba 7 2 henc 9 definit b thu impli 8 2 5 research obviou question follow result els ad firstord logic remain local hella 7 prove invari firstord formula use order also addit multipl local hand conjectur ad order addit destroy local howev fact invari formula builtin addit multipl local relev complex theori sinc firstord logic builtin addit multipl captur uniform ac 0 one way appli local techniqu complex theoret question spite hella nonloc result weaken notion local exampl conceiv invari ac 0 even queri local sens two point structur size n isomorph neighborhood radiu olog n indistinguish would still suffici separ logspac class r foundat databas extend ordergener queri local properti queri languag finit model theori local nonloc properti privat commun privat commun notion local logic character finit model form local finit model count local properti graph connect monad np tr logic count local properti foundat databas local properti queri languag decid firstord properti local treedecomposalb graph form local finit model logic aggreg oper logic count auxiliari relat lower bound invari queri ctr david grossamblard querypreserv watermark relat databas xml document proceed twentysecond acm sigmodsigactsigart symposium principl databas system p191201 june 0911 2003 san diego california leonid libkin express power sql theoret comput scienc v296 n3 p379404 14 march leonid libkin logic captur local properti acm transact comput logic tocl v2 n1 p135153 jan 2001 guozhu dong leonid libkin limsoon wong increment recomput local languag inform comput v181 n2 p8898 march 15 nicol schweikardt express power monad least fix point logic theoret comput scienc v350 n2 p325344 7 februari 2006 lane hemaspaandra sigact news complex theori column 49 acm sigact news v36 n4 decemb 2005