inner class inner class objectori languag play role similar nest function definit function languag allow object export object direct access method instanc variabl howev similar decept close look inner class reveal signific subtleti aris interact inherit goal work precis understand essenti featur inner class object studi fragment java inner class inherit almost noth els begin give direct reduct semant languag give altern semant translat yet smaller languag toplevel class close follow java inner class specif prove two semant coincid sens translat commut reduct typesaf b introduct often observ gap objectori function program style larg might first appear essenc object record function closur howev differ well similar one hand object class incorpor import mechan present function static member inherit object ident access protect etc hand function languag usual allow nest definit function give inner function direct access local variabl enclos definit objectori languag support sort nest exampl smalltalk 3 special syntax block object similar anonym function beta 8 provid pattern unifi class function nest arbitrarili recent inner class popular inclus java 11 6 inner class use object need send anoth object chunk code manipul first object method andor instanc variabl situat typic userinterfac program exampl java abstract window toolkit allow listen object regist userinterfac compon button button press actionperform method listen invok exampl suppos want increment counter button press begin defin class counter inner class listen class counter int x class listen implement actionlistn public void actionperformedactionev e x void listentobutton b baddactionlistenernew listen definit method actionperform field x enclos counter object chang method listento creat new listen object send given button write counter new counter new buttonincr creat display button increment counter everi time press inner class power abstract mechan allow program like one express much conveni transpar would possibl use toplevel class howev power come signific cost complex inner class interact featur objectori programmingespeci inheritancein quit subtl way exampl closur function languag simpl lexic environ includ bind whose scope appear inner class hand access via method inherit superclass chain environ includ lexic environ appear also lexic environ superclass convers presenc inner class complic intuit inherit mean exampl inner class inherit enclos class happen toplevel class inherit inner class defin differ toplevel class javasoft inner class specif 6 provid one answer question show translat program inner class one use toplevel class ad inner class extra field point instanc enclos class specif give clear basic intuit behavior inner class fall short complet satisfi account first style indirect forc programm reason code first pass rather heavi transform second document somewhat imprecis consist exampl english prose differ compil even differ version sun jdk interpret specif differ signific detail goal work precis understand essenti featur inner class main contribut threefold ffl first give direct oper semant type rule small languag inner class inherit type rule shown sound oper semant standard sens keep model simpl possibl focu basic form inner class java omit relat mechan anonym class local class within block static nest class also deal import interact access annot publicprivateetc inner class cf 6 1 ffl next give translat languag inner class even smaller languag toplevel class formal translat semant java inner class specif show translat preserv type ffl final prove two semant defin behavior inner class sens translat commut highlevel reduct relat direct semant basi work core calculu call featherweight java fj calculu origin propos context formal studi 4 gj 2 extens java parameter class design omit mani featur java possibl even assign maintain essenti flavor languag type system definit fit comfort page basic properti prove difficulti say simpli type lambdacalculu subtyp extrem simplic make ideal vehicl rigor studi new languag featur parameter class inner class remaind paper organ follow section 2 briefli review featherweight java section 3 defin fji extens fj inner class give syntax type rule reduct rule state standard type sound result section 4 defin compil fji fj model translat semant inner class specif prove correct respect direct semant previou section section 5 offer conclud remark breviti proof theorem omit appear forthcom technic report 5 begin review basic definit featherweight java 4 fj tini fragment java includ toplevel class definit object instanti field access method invoc origin version fj also includ typecast requir model compil gj java omit sinc interact inner class signific way sinc fj sublanguag extens defin section 3 show syntax exampl program execut rest definit found figur 4 abstract syntax fj class declar constructor declar method declar express given follow class c extend c c f k e x new ce metavari b c e rang class name f g rang field name rang method name x rang paramet name c e rang express l rang class declar k rang constructor declar rang method declar write f shorthand f 1 fn similarli c x e etc write shorthand 1 mn comma write empti sequenc ffl denot concaten sequenc use comma length sequenc x written x abbrevi oper pair sequenc obviou way write c f shorthand c 1 f 1 cn fn c f shorthand c 1 f 1 cn fn thisff shorthand thisf 1 f 1 thisf n fn sequenc field declar paramet name method declar assum contain duplic name key simplif fj omiss assign make fj pure function 1 object field initi constructor never chang afterward moreov constructor styliz syntax one paramet field name field super constructor invok field supertyp remain field initi correspond paramet constraint enforc type rule styliz syntax make oper semant simpl field access express new cef reduc correspond constructor argument e also sinc fj assign statement method bodi alway consist singl return statement comput languag goe express follow return method invoc express new cemd reduc look express e 0 follow return method class c class tabl reduc instanc e 0 receiv object new ce substitut formal argument special variabl respect figur 4 state reduct rule precis program fj pair class tabl set class definit express correspond main method java program reduct relat form e gamma e reduc express e 0 one step exampl given class definit 1 cours use exampl program inner class involv sideeffect featur java howev core mechan inner class interact assign interest way omit assign fj fji obtain much simpler model offer much insight inner class class pair extend object object fst object snd pairobject fst object snd pair setfstobject newfst return new pairnewfst thissnd class extend object class b extend object express new pairnew new bsetfstnew b reduc new pairnew b new b follow new pairnew new bsetfstnew b gamma new pairnew b new pairnew new bsnd gamma new pairnew b new b underlin subexpress one reduc step 3 fj inner class defin languag fji extend fj inner class like fj fji impos syntact restrict simplifi oper semant 1 receiv field access method invoc inner class constructor invoc must explicitli specifi implicit 2 type name alway absolut path class denot short abbrevi 3 inner class instanti express enew ce annot static type e written enewt ce condit 2 3 fji quit subset java wherea fj instead view fji intermedi languag user program translat process elabor describ elabor process inform sinc rather complex especi deep consist mainli larg number rule abbrevi long qualifi name detail treatment given companion technic report 5 begin brief discuss key idea enclos instanc section 31 discuss interact inner class subclass section 32 final arriv formal definit syntax 33 fji import auxiliari definit 34 oper semant 35 type relat 36 statement subject reduct progress properti 37 finish section 31 enclos instanc consid follow fji class declar class outer extend object pair outerpair p super class inner extend object object sndp return outerthispsnd outerinn makeinn return thisnewout inner conceptu instanc class outer contain special version inner class instanti yield instanc outerinn refer os instanc variabl p object call enclos instanc outerinn object enclos instanc name explicitli qualifi express found java fji consist simpl name enclos class follow gener class refer enclos instanc c 1 cngamma1 well usual also written cn fji object inner class instanti express form enewt ce e enclos instanc static type e result enewt ce alway instanc tc regardless runtim type e rigid reflect static natur java translat semant inner class explicit annot use fji rememb static type e contrast inner class beta virtual 7 ie differ constructor may invok depend runtim type enclos instanc exampl subclass outer 0 class outer also inner class inner onew inner might build instanc either outerinn outer 0 inner depend dynam type elabor process allow type name abbrevi java program exampl fji program written class outer extend object pair outerpair p super class inner extend object object sndp return psnd inner makeinn return new inner java return type inner makeinn method denot nearest inner declara tion also java enclos instanc omit qualifi thu thisnewout inner origin exampl written new inner 32 subclass inner class almost form inherit involv inner class allow java toplevel class extend inner class anoth toplevel class inner class extend anoth inner class complet differ toplevel class inner class even extend enclos class one case disallow class extend inner class discuss restrict later liber howev introduc signific complex method inherit superclass must execut lexic environ differ subclasss figur 1 show situat three inner class a1a2a3 b1b2b3 c1c2c3 subclass hierarchi white oval repres enclos instanc three shade oval indic region program method c1c2c3 object may defin method inherit a1a2a3 execut environ consist enclos instanc a1thi a2thi may access member enclos class via a1thi a2thi similarli b1b2b3 c1c2c3 gener class n superclass inner n differ environ may access method moreov environ may consist one enclos instanc six enclos instanc requir method c1c2c3 work exampl forego see provid way six enclos instanc instanti c1c2c3 object recal object inner class instanti enclos object provid prefix e new express exampl c1c2c3 object instanti write enewc1c2 c3e e enclos instanc correspond c2thi enclos instanc come first enclos instanc enclos class immedi enclos class c1thi suppli new express explicitli reach via extend extend figur 1 chain environ direct enclos instancefor exampl enclos instanc e enewc1c2 c3e form new c1cnewc1 c2d includ enclos instanc new c1c correspond c1thi second enclos instanc superclass determin constructor subclass take simpl exampl suppos extend inner class outerinn enclos instanc correspond outerthi requir make instanc subclass exampl subclass outerinn class refinedinn extend outerinn object c refinedinnerout thisouterinn object c declar refinedinn constructor ordinari argument thisouterinn becom enclos instanc prefix super constructor invoc provid valu outerthi refer inherit method sndp similarli c1c2c3 exampl subclass b1b2b3 written follow class b1 extend class b2 extend class b3 extend a1a2a3 object b3 b3object a3 a1a2 thisa1a2a3 object b3 note sinc enclos instanc correspond a1thi includ enclos instanc correspond a2thi b3 constructor take one extra argument enclos instanc class class c1 extend class c2 extend class c3 extend b1b2b3 object c3 c3object a3 a1a2 thisa1a2a3 object b3 b1b2 thisb1b2b3 object c3 sinc constructor superclass b1b2b3 initi a2thi constructor c3 initi b2thi qualifi super invoc argument thisa1a2a3 pass super ordinari argument fji restrict qualif super constructor argument wherea java allow express qualif permit clean definit oper semant saw fj sinc state inform includ field enclos instanc object appear new express moreov technic reason connect name mangl involv translat semant requir constructor argument use qualif super name thisc 1 direct superclass exampl lastli explain allow class extend one direct indirect inner class sensibl way make instanc class suppos could defin class class foo extend foobar class bar sinc foo extend foobar constructor foo need instanc foo argument make imposs make instanc foo perhap one could use null enclos instanc case would use sinc inner class usual suppos make use enclos instanc 33 syntax proceed formal definit fji abstract syntax languag shown top left figur 2 use notat convent previou section metavari u rang type qualifi class name sequenc simpl name c 1 c n concaten period compact definit introduc notat null qualif identifi c c metavari p rang type write class declar l includ declar simpl name c superclass field f constructor k inner class l method two kind constructor declar depend whether superclass inner toplevel superclass inner subclass constructor must call super constructor qualif f provid enclos instanc visibl superclasss method see type rule constructor argument arrang follow order 1 superclasss field initi superf fsuperf 2 enclos instanc superclass need 3 field class defin initi thisff like fj bodi method return express variabl field access method invoc object instanti assum set variabl includ special variabl cthi everi c variabl never use name argument method program pair class tabl ct map type class declar l express e object treat special everi fji program definit object class appear class tabl auxiliari function look field method declar class tabl equip special case object return empti sequenc field empti set method lighten notat follow assum fix class tabl ct class tabl read subtyp relat class write subtyp tthe reflex transit closur immedi subclass relat given extend claus ct relat defin formal bottom left figur 2 impos follow saniti condit class tabl 1 ct class c everi inner class declar l name ct object 62 domct 4 everi type except object appear anywher ct 2 domct 5 everi e 0 newt ce new ce resp appear anywher ct tc 2 domct c 2 domct resp 6 cycl subtyp relat 7 6 tu two type tu condit 1 2 class tabl fji identifi set toplevel class condit 7 prohibit class extend one inner class syntax class c extend f k l e x new ce comput new cef gamma e cn new ce new cemd gamma ae x 7 7 cn i21n oe cn gamma ae x 7 7 cn i21n oe subtyp class c extend express type itfield method type i21n class cn extend mtypem itmethod class type ok pc l ok pc class c extend f k l ok p ok pc l ok pc class c extend td f k l ok p figur 2 fji main definit field lookup class c extend f k l class c extend ud f k l class c extend f k l class c extend f k l defin method bodi lookup class c extend f k l class c extend f k l defin enclos instanc lookup encl tc class c extend f encl new cd new class c extend ud f encl new cd 0 e class c extend f encl new class c extend ud f encl figur 3 fji auxiliari definit 34 auxiliari function type reduct rule need auxiliari definit given figur 3 field class written fieldst sequenc f pair class field name field declar class superclass addit fieldst collect type direct enclos instanc superclass exampl fieldsc1c2c3 return follow sequenc object a3 field a1a2a3 enclos instanc bound a2thi object b3 field b1b2b3 enclos instanc bound b2thi object c3 field c1c2c3 third rule definit insert enclos instanc inform field g superclass ud field f current class welltyp program fieldst alway agre constructor argument list type method class written mtypem pair written ss sequenc argument type result type similarli bodi method class written mbodym tripl written x e sequenc paramet x express e class method defin function encl play crucial role semant fji intuit e toplevel inner class instanti encl return direct enclos instanc e visibl class ie enclos instanc provid correct lexic environ method inherit first rule simplest case sinc type express e 0 newt ce agre subscript tc return direct enclos instanc e 0 rule follow common pattern explain fifth rule repres sinc subscript type differ type argument enclos instanc e 0 correct answer therefor make recurs call object 0 newu dd superclass obtain drop e 0 mani argument e field f class sc keep go like final argument becom instanc match first rule exampl encl a1a2a3 enewc1c2 c3a new a1newa1 a2 b new b1newb1 b2 c new b1newb1 b2newb1b2 b3a new a1newa1 a2 b new a1newa1 a2newa1a2 a3a new a1newa1 a2 note encl function output direct enclos instanc obtain outer enclos instanc a1thi encl use repeatedli encl a1a2 encl a1a2a3 e comput fj reduct relat fji form e gamma e 0 write gamma reflex transit closur gamma reduct rule given middl left column figur 2 four reduct rule two field access two method invoc field access express new cef look field name f c use fieldsc yield constructor argument e posit correspond f field list enewt cef behav similarli method invoc express new cemd first call mbodym c obtain tripl sequenc formal argument x method bodi e class c 1 delta delta delta cn defin yield substitut instanc method bodi x replac actual argument special variabl cnthi receiv object new ce c n correspond enclos instanc c obtain encl sinc method invok defin c 1 delta delta delta cn direct enclos instanc obtain encl c 1 deltadeltadeltac n e e receiv object similarli cngamma2 obtain encl c1 deltadeltadeltac encl c1 deltadeltadeltac n e reduct rule may appli point express also need obviou congruenc rule e gamma e f like omit exampl class tabl includ outer refinedinn pair b new refinedinnernew outernew pairnew new b new objectsndp reduc new b follow new refinedinnernew outernew pairnew new b new objectsndp gamma new outernew pairnew new bpsnd gamma new pairnew new bsnd gamma new b underlin subexpress redic reduct step 36 type rule type rule express method declar class declar given righthand column figur 2 environ gamma finit map variabl type written xt type judgment express form gamma e 2 read environ gamma express e type type rule syntax direct one rule form express type rule object instanti method invoc check actual paramet type subtyp correspond formal paramet type obtain field mtype enclos object must type subtyp annot type new type judgment method declar form ok c 1 delta delta delta cn read method declar ok declar class c 1 delta delta delta cn bodi method type context formal paramet method declar type c type c 1 delta delta delta c method name declar superclass must type subclass type judgment class declar form l ok p read class declar l ok declar p p type class declar l inner class otherwis l toplevel class type rule check constructor appli super field superclass initi field declar class method declar inner class declar class ok condit c 62 p ensur simpl class name defin also simpl name one enclos class avoid ambigu mean cthi 37 properti easi show fji program enjoy standard subject reduct progress properti togeth guarante welltyp program never caus nosuchfielderror nosuchmethoderror 371 theorem subject reduct gamma e 2 e gamma e 0 proof sketch main properti requir proof follow termsubstitut lemma prove induct deriv gamma plu follow lemma similarli e 0 theorem prove induct deriv e gamma e 0 case analysi last rule use case irinvkt irinvki easi use lemma base case also straightforward induct step xi 372 theorem progress suppos e welltyp express 1 e includ new c 0 ef subexpress fieldsc 0 similarli e includ 2 e includ new c 0 emd subexpress mbodym c similarli e includ e 0 translat semant section consid style semant translat fji fj everi inner class compil toplevel class one addit field hold refer direct enclos stanc occurr qualifi translat access field exampl outer refinedinn class previou section compil follow three fj class class outer extend object pair outerinn makeinn return new outerinnerthi class outerinn extend object outer outerinnerout thisouterinn object sndp return thisthisouterinnerpsnd class refinedinn extend outerinn object c refinedinnerout thisouterinn object c inner class outerinn compil toplevel class outerinn field thisouterinn hold outer object correspond direct enclos instanc outerthi origin fji program thu outerthi compil field access express thisthisouterinn give compil function j delta j syntact categori except type compil function take second argument fji class name entiti translat defin written 41 type express method everi qualifi class name translat simpl name obtain syntact replac compil express written jej given write jej shorthand je similarli jnew dej new jej new jtdj jej saw compil inner class one addit field call jtj origin class name c class c 1 delta delta delta cn becom express follow refer direct enclos instanc sequenc reach correct one enclos instanc e 0 e 0 newt ce becom last argument compil constructor invoc compil method written jmj straightforward stand jt 1 42 constructor class compil constructor written jkj given four case depend whether current class toplevel class inner class whether superclass toplevel class inner class current class inner class one argument correspond enclos instanc ad argument list name constructor becom jtcj translat qualifi name class superclass inner argument use qualif fsuperf becom last argument super invoc final compil class written jlj p follow class c extend f k l class c extend jsj class c extend f k l class jtcj extend jsj constructor inner class method class c defin p compil auxiliari argument pc inner class l becom toplevel class constructor compil compil class inner name chang jtcj field jtcj hold enclos instanc ad compil class tabl written jct j achiev compil toplevel class l ct ie 43 properti translat semant easi show translat semant preserv type sens welltyp fji program compil welltyp fj program 431 theorem compil preserv type ct ok respect ct respect jct j jct j ok final come main result section correspond direct semant present previou section translat semant defin show behavior compil program exactli reflect behavior origin program fji everi step reduct welltyp fji program compil program take one step reach correspond state 432 theorem compil commut reduct gamma fji e 2 egamma fji e gamma fj proof straightforward induct deriv e gamma fji e 0 case analysi last rule use main lemma case irinvkt irinvki suppos 2 jnew cej new cej similarli lemma show calcul encl e correctli mimick field access mangl field translat sinc method invoc direct semant may involv calcul encl delta delta delta sever time lowlevel reduct may requir one step mimic one step fji level xi 5 conclus futur work formal two style semant inner class direct style translat style semant given compil lowlevel languag without inner class follow java inner class specif prove two style correspond sens translat commut highlevel reduct relat direct semant besid deepen understand inner class work uncov sever bug variou java compil futur work interact inner class access restrict java clearli worth investig also hope abl model java form inner class anonym class local class declar method bodi slightli complic sinc method argument field occur free variabl expect captur variant fji acknowledg work support univers pennsylvania nation scienc foundat grant ccr9701826 principl foundat program object igarashi research fellow japan societi promot scienc would like thank bug parad java develop connect httpdeveloperjavasuncomdeveloperbugparadeindexhtml provid use inform r secur implement java inner class make futur safe past ad gener java program languag featherweight java minim core calculu java gj inner class birger mllerpedersen tr smalltalk80 languag implement virtual class power mechan objectori program javaisublightsubi typesafemyampersandmdashdefinit class mixin make futur safe past java type system sound semant analysi virtual class test class featherwieght java c program languag third edit java languag specif static safe altern virtual type protect programminglanguag translat ctr nathaniel nystrom stephen chong andrew c myer scalabl extens via nest inherit acm sigplan notic v39 n10 octob 2004 ancona c anderson f damiani drossopoul p giannini e zucca provenli correct translat fickl java acm transact program languag system topla v29 n2 p13e april 2007 christoph leagu zhong shao valeri trifonov typepreserv compil featherweight java acm transact program languag system topla v24 n2 p112152 march 2002 radha jagadeesan alan jeffrey jame rieli type parametr polymorph aspect scienc comput program v63 n3 p267296 15 decemb 2006