recurs formul choleski factor matrix pack storag new compact way store symmetr triangular matrix call rpf recurs pack format fulli describ novel way transform rpf standard pack format includ new algorithm call rpc recurs pack choleski oper rpg format present algorithm rpc basd level3 bla requir variant algorithm trsm syrk work rpf call rptrsm rpsyrk find work call gemm follow execut time rpc lie gemm advantag storag scheme compar tradit pack full storag demonstr first rpc storag format use minim amount storag symmetr triangular matrix second rpc give level3 implement choleski factor wherea standard pack implement level 2 henc perform rpc implement decidedli superior third unlik fix block size algorithm rpc requir block size tune paramet present perform measur sever current architectur demonstr improv tradit pack routin also msp parallel comput ibm smp comput made graph attach section 7 show rpc algorithm superior factor 16 74 order around 1000 19 103 order around 3000 tradit pack algorithm architectur rpc perform result almost even better tradit fullstorag algorithm result b introduct import class linear algebra problem coefcient matrix symmetr posit denit 5 11 23 symmetri necessari store either upper lower triangular part matrix lower triangular caseb 7 14 21 28 upper triangular caseb 43 9 figur 1 map 7 7 matrix lapack choleski algorithm use full storag lda 7 fortran77 lower triangular caseb 3 9 14 upper triangular caseb figur 2 map 7 7 matrix lapack choleski algorithm use pack storag 11 lapack potrf pptrf subroutin lapack library3 oer two dierent kind subroutin solv problem instanc potrf 1 pptrf factor symmetr posit four name spotrf dpotrf cpotrf zpotrf use lapack real symmetr complex hermitian matrices3 rst charact indic precis arithmet version singl precis doubl precis c complex z doubl complex lapack95 use one name la potrf versions7 potrf andor pptrf express paper precis arithmet languag version po andor pp matrix factor algorithm denit matric mean choleski algorithm dierenc way triangular matrix store see gure 1 2 potrf case matrix store one lower left upper right triangl full squar matrix16 page 64 2 triangl wast see gure 1 uniform storag scheme block level 3 blas8 subroutin employ result high speed solut pptrf case matrix kept pack storag 1 16 page 74 75 mean column lower upper triangl store consecut one dimension array see gure 2 triangular matrix occupi strictli necessari storag space nonuniform storag scheme mean use full storag bla imposs level 2 blas20 9 pack subroutin employ result low speed solut summar choic high speed wast memori versu low speed wast memori 12 new way store real symmetr complex hermitian either case posit denit matric togeth new recurs formul linear algebra subroutin propos new way store lower upper triangular matrix solv dilemma14 24 word obtain speed potrf amount memori use pptrf new storag scheme name rpf recurs pack formatse gure 4 explain benet recurs formul choleski factor lu decomposit describ work gustavson 14 toledo 22 symmetr posit denit matrix choleski case kept full matrix storag emphasi work better data local thu better util comput memori hierarchi recurs formul oer howev recurs pack formul also properti provid short introduct comput memori hierarchi basic linear algebra subprogram bla describ recurs pack choleski rpc recurs pack format rpf 13 rational behind introduc new recurs algorithm rpc new recurs data format rpf comput sever level memori ow data memori comput unit import factor govern perform engin scientic comput object keep function unit run peak capac use memori hierarchi fortran column major c row major system see gure 3 high perform achiev use local refer within program present context call block regist cach level 1 cach level 2 cach level 3 share memori distribut memori secondari storag 1 secondari storag 2 faster smaller expens slower larger cheaper figur 3 comput memori hierarchi top hierarchi central process unit cpu commun directli regist number regist usual small level 1 cach directli connect regist comput run almost peak perform abl deliv data level 1 cach way cpu perman busi sever book describ problem associ comput memori hier archi literatur 10 5 11 adequ numer linear algebra specialist memori near cpu regist cach faster access cpu memori away fast memori expens one reason small regist set tini cach memori much larger set regist howev l1 cach still larg enough solv scientic problem even subproblem like matrix factor cach order matrix larg special set basic linear algebra subprogram bla develop address comput memori hierarchi problem area numer linear algebra bla document 20 9 8 6 bla well summar explain numer linear algebra specialist 10 5 three level bla level 1 bla show vector vector opera tion level 2 bla show vector matrix andor matrix vector oper level 3 bla show matrix matrix oper choleski factor one make follow three observ respect bla 1 level 3 implement use full storag format run fast 2 level 3 implement use pack storag format rare exist level 3 implement previous use 16 howev great program cost convent level 2 implement use pack storag format run larg problem size consider slower full storag implement 3 transform convent pack storag rpf use rpc algorithm produc level 3 implement use amount storag pack storag 14 overview paper section 2 describ new pack storag data format data transform convent pack storag section 21 describ convent lower upper triangular pack storag section 22 discuss transform place either lower upper trapezoid pack data format recurs pack data format vice versa section 23 describ possibl transpos matrix reorder pack recurs pack format vice versa final section 24 recurs aspect data transform describ four subsect describ place transform pictori via sever gure section 31 32 recurs trsm syrk work rpf describ routin almost requir oat point oper call level 3 bla gemm final section 33 rpc algorithm describ term use recurs algorithm section 31 32 section 2 three algorithm describ pictori via sever gure note rpc algorithm use one level 3 bla subroutin name gemm usual gemm routin special highli tune done comput manufactur atlas25 gemm use section 4 explain rpc algorithm numer stabl section 5 describ perform graph pack storag lapack3 algorithm recurs pack algorithm sever comput typic comput like compacq hp ibm sp ibm smp intel pen tium sgi sun consid gure result show recurs pack choleski factor rp pptrf solut rp pptr 4 9 time faster tradit pack sub routin three graph one demonstr success use openmp17 18 parallel direct gure 18 second graph show recurs data format also eectiv complex arithmet g ure 19 third one show perform three algorithm factor potrf pptrf rp pptrf solut potr pptr rp pptr gure 20 section 6 discuss import develop paper 2 recurs pack storag new way store triangular matric pack storag call recurs pack present storag scheme right way explain describ convers pack recurs pack storag vice versa see gure 2 4 lower triangular caseb 22 upper triangular caseb 9 12 15 19 2022 24 26 271 figur 4 map 7 7 matrix choleski algorithm use recurs pack storag recurs block divis illustr 21 lower upper triangular pack storag symmetr complex hermitian triangular matric may store pack storag form see lapack user guid 3 ibm essl librari manual16 page 6667 gure 2 column triangl store sequenti one dimension array start rst column map posit full storag pack storag triangular matrix size ij ap ij 12m j2 lthe advantag storag save almost half 4 memori compar full storag 3 upper triangular lower triangular store 4 least 12 formula function lda lead dimens fortran77 save fortran77 22 reorder lower upper trapezoid pack storag pack storag memori map buer pp 12 word recurs pack storag memori map figur 5 reorder lower pack matrix first last p 1 column lead triangl copi buer place column accentu rectangl assembl bottom space trapezoid last buer copi back top trapezoid assum matric store column major order concept paper fulli applic also matric store row major order intermedi step transform pack triangular matrix recurs pack matrix matrix divid two part along column thu divid matrix trapezoid triangular part shown g 5 6 triangular part remain pack form trapezoid part reorder consist triangl pack form rectangl full storag form reorder demand buer size triangl minu longest column reorder lower case g 5 take follow step first column triangular part trapezoid move buer note rst column correct place column rectangular part trapezoid move consecut locat nalli buer copi back correct locat reorder array p gure 5 chosen bm2c rectangular submatrix squar deviat squar singl column buer size pp 12 address lead 8pack storag pack storag memori map buer pm p 12 word recurs pack storag memori map figur reorder upper pack matrix first rst column trail triangl copi buer place column accentu rectangl assembl top space trapezoid last buer copi back bottom trapezoid ing triangl rectangular submatrix trail triangl given reorder lead trail triangl lower upper pack storag scheme origin triangular matrix reorder implement subroutin subroutin tpz trm p ap subroutin tr tpz p ap tpz tr mean reorder trapezoid part pack format triangularrectangular format describ tr tpz opposit reorder 23 transposit rectangular part rectangular part reorder matrix kept full matrix storag desir oer excel opportun transpos matrix transform recurs pack format rectangular submatrix squar transposit done complet inplac deviat squar column buer size column necessari transposit purpos reus buer use reorder 24 recurs applic reorder method reorder appli recurs lead trail triangl still pack storag nalli origin triangular pack matrix divid rectangular submatric decreas size full storag implement complet transform pack recurs pack format p rp compar gure 2 4 recurs subroutin p rpmap 1 call tpz trm p ap call p rpp ap call p rpm invers transform recurs pack pack rp p recurs subroutin rp pmap 1 call rp pp ap call tr tpz p ap call rp pm exampl shown concern lower triangular matrix upper triangular transform transform transposit follow pattern gure 7 illustr recurs divis small lower upper triangular matric figur 7 lower upper triangular matric recurs pack storag data format 20 rectangular submatric shown gure kept full storag column major order array contain whole matric recurs formul choleski algorithm necessari bla two blas6 oper triangular solver multipl right hand side trsm 5 rank k updat symmetr matrix syrk need recurs choleski factor solut rp pptrf 6 rp pptrs2 section rp trsm rp syrk rp pptrf rp pptr formul recurs use recurs pack operand explain trsm syrk pptrf pptr oper variou case depend operand order operand follow consid singl specic case deduct case follow guidelin comput work recurs bla routin rp trsm rp syrk also rp trmm done non recurs matrixmatrix multipli routin gemm19 25 attract properti sinc gemm usual highli optim current comput architectur gemm oper well document explain 12 13 6 speed comput depend much speed good gemm good gemm implement usual develop comput manufactur model implement gemm obtain 5 name trsm syrk herk gemm see footnot potrf page 1 6 prex rp indic subroutin belong recurs pack librari exampl rp pptrf recurs pack choleski factor routin netlib 6 work correctli slowli innov comput laboratori univers tennesse knoxvil develop automat system call usual produc fast gemm subroutin anoth automat code gener scheme gemm develop berkeley4 essl see 1 gemm bla produc via block high perform kernel routin exampl essl produc singl kernel routin datb function atla chip gemm kernel principl underli product kernel similar major dierenc essl gemm code written hand wherea atla gemm code parametr run paramet set best paramet set found particular machin 31 recurs trsm base nonrecurs gemm fig 8 show split trsm operand oper consist three suboper base split algorithm program follow recurs subroutin rp trsm n n 1 els call rp trsm call gemm 0 n call rp trsm n 32 recurs syrk base nonrecurs gemm fig 9 show split syrk operand oper consist three suboper 21 11 22 figur 8 recurs split matric rp trsm oper case sideright uplolow transatranspos base split algorithm program follow recurs subroutin rp syrk n 1 els call rp syrk p n call gemm 0 n call rp syrk 33 recurs pptrf pptr base recurs trsm recurs syrk fig 10 show split pptrf operand oper consist four suboper mp c 22 mp bc 22 mp 11 21 mp figur 9 recurs split matric rp syrk oper case uplolow transno transpos 22 rp pptrf base split algorithm program follow recurs subroutin rp pptrf ap 1 els call rp pptrf p ap call rp trsm call rp syrk call rp pptrf solut subroutin rp pptr perform consecut triangular solut transpos nontranspos choleski factor routin explicitli recurs call recurs rp trsm twice 4 stabil recurs algorithm paper 24 show recurs choleski factor algorithm equival tradit algorithm books5 11 23 whole theap 21 mp 22 mp mp mp figur 10 recurs split matrix rp pptrf oper case uplolow ori tradit choleski factor bla trsm syrk algorithm carri recurs choleski factor bla trsm syrk algorithm describ section 3 error analysi stabil algorithm well describ book nichola j higham15 dierenc lapack algorithm po pp rp 7 inner product accumul case dierent order use mathemat equival stabil analysi show summat order stabl 5 perform result sun ultrasparc ii 400 mhz sgi r10000 195 mhz compaq alpha ev6 500 mhz hp pa8500 440 mhz intel pentium iii 500 mhz tabl 1 comput name new recurs pack bla rp trsm rp syrk new recurs pack choleski factor solut rp pptrf rp pptr routin compar tradit lapack subroutin concern result perform comparison made seven 7 full pack recurs pack dierent architectur list tabl 1 result graph attach appendix paper doubl precis arithmet fortran9021 use case ibmppc essl 3100 lesslsmp ibmpw2 essl 2220 lesslp2 sun sun perform librari 20 lsunperf sgi standard execut environ 73 lbla compaq dxml v35 ldxmp ev6 hp hpux pa20 bla librari 1030 lbla intel atla 30 tabl 2 comput librari version follow procedur use carri perform test machin recurs tradit routin compil compil compil ag call vendor optim otherwis optim bla librari bla librari version seen tabl 2 compar recurs tradit routin receiv input produc output time measur time spent reorder matrix 8 recurs pack format includ run time rp pptrf rp pptr tradit routin data transform cost cpu time measur time function etim except powerpc machin 4 way smp machin run time measur wall clock time mean special ibm util function call rtc except oper system program run test run machin time made sequenc matrix size rang step case hp intel machin matrix size start start resolut etim util coars number right hand side taken nrh n10 due memori limit actual hp machin test seri could rang oper count choleski factor solut 8 howev necessari perform transform rp pptrf transform rp pptr get correct result n number equat nrh number right hand side count use convert run time flop rate ten gure gure show perform graph comparison new rpc algorithm tradit lapack algorithm rpc algorithm use rpf data format comparison mention cost transform pack format rpf rpf pack format includ recurs pack factor solv routin subroutin dpptrf zpptrf dpptr zpptr use pack data format dpotrf dpotr use full data format figur 20 compar three algorithm rpc lapack full storag lapack pack storag everi gure two subgur one caption upper subgur show comparison curv choleski factor lower subgur show comparison curv forward backward substitut caption describ detail perform gure rst seven gure describ comparison perform sever dierent comput 51 ibm smp powerpc figur 11 show perform ibm 4way powerpc 604e 332 mhz comput lapack routin dpptrf upper subgur perform 100 mflop perform u graph littl better l graph perform remain constant order matrix increas perform rpc factor routin increas n increas u graph increas 50 mflop almost 600 mflop l graph 200 mflop 650 mflop u graph perform better l graph perform rel u l rpc algorithm perform 49 72 time better dpptrf algorithm larg matrix size perform rpc solut routin lower subgur l u graph almost equal dpptr routin perform 100 mflop matrix size rpc algorithm curv increas 250 mflop almost 800 mflop rel u l perform rpc algorithm 57 55 time faster dpptr algorithm larg matrix size matrix size vari 300 3000 subgur 52 ibm power2 figur 12 show perform ibm power2 160 mhz comput lapack routin dpptrf upper subgur u graph perform 200 mflop l graph perform 150 mflop increas graph size matrix grow perform graph rpc factor routin increas u graph 300 littl 400 mflop l graph 200 mflop 450 mflop l graph better u graph matrix size 750 3000 u graph better l graph matrix size 300 750 graph grow rapidli matrix size 300 500 rel u l rpc algorithm perform 19 31 time faster dpptrf algorithm larg matrix size perform rpc solut routin lower subgur l u graph almost equal perform dpptr algorithm stay constant 250 mflop decreas slightli n rang 300 3000 perform rpc algorithm increas 350 500 mflop rel u l rpc algorithm perform 23 23 time faster dpptr algorithm larg matrix size matrix size vari 300 3000 subgur 53 compaq alpha ev6 figur 13 show perform compaq alpha ev6 500 mhz comput lapack routin dpptrf upper subgur u graph perform better l graph dierenc 50 mflop perform start 300 mflop increas 400 mflop drop 200 mflop perform rpc factor routin increas n increas graph u l graph almost equal u graph littl higher matrix size 300 450 rel u l rpc algorithm perform 34 50 time faster dpptrf algorithm larg matrix size routin dpptr shape solut perform curv lower subgur l u graph almost equal perform dpptr routin decreas 450 250 mflop n increas 300 3000 rpc perform curv increas 450 mflop 750 mflop perform u l rpc algorithm 33 33 time faster dpptr algorithm larg matrix size matrix size vari 300 3000 subgur 54 sgi r10000 figur 14 show perform sgi r10000 195 mhz comput one processor lapack routin dpptrf upper subgur u graph perform better l graph matrix size 300 2000 u l graph dpptrf perform slowli decreas perform rpc factor routin u l graph increas 220 300 mflop n increas 300 1000 stay constant n increas 3000 rel u l rpc algorithm perform 49 49 time faster dpptrf algorithm larg matrix size routin dpptr shape solut perform curv lower subgur l u graph almost equal perform dpptr routin decreas 130 mflop 60 mflop n increas 300 3000 perform rpc solut routin increas begin run constantli 300 mflop perform u l rpc algorithm 51 52 time faster dpptr algorithm larg matrix size matrix size vari 300 3000 subgur 55 sun ultrasparc ii figur 15 show perform sun ultrasparc ii 400 mhz comput lapack routin dpptrf upper subgur u l graph show almost equal perform n 1500 function start 200 225 mflop decreas 50 mflop rpc factor routin perform u l graph also almost equal whole interv function valu start quickli rise 350 mflop slowli increas 450 mflop rpc factor u l algorithm 97 102 time faster dpptrf algorithm larg matrix size perform rpc solut routin lower subgur l u graph almost equal dpptr perform graph decreas 225 50 mflop perform rpc solut graph increas 330 almost 450 mflop rpc solut u l algorithm 100 time faster dpptr algorithm larg matrix size matrix size vari 300 3000 subgur 56 hp pa8500 figur show perform hp pa8500 440 mhz comput lapack routin dpptrf upper subgur u l graph decreas function u graph function valu go 370 100 mflop l graph function goe 280 180 mflop perform rpc factor graph increas function matrix size increas 1000 3000 perform vari matrix size 500 1500 u graph function valu rang 700 mflop almost 800 mflop l graph function valu rang 600 mflop littl 700 mflop rpc algorithm u l 47 time faster dpptrf algorithm larg matrix size perform rpc solut routin lower subgur l u graph almost equal dpptr routin perform decreas 300 mflop 200 mflop rpc algorithm curv increas 550 mflop almost 810 mflop rpc algorithm u l 52 50 time faster dpptr algorithm larg matric solut case matrix size vari 500 2500 subgur 57 intel pentium iii figur 17 show perform intel pentium iii 500 mhz comput lapack routin dpptrf upper subgur u l graph decreas function u graph function rang 100 80 mflop l graph function rang less 50 25 mflop rpc factor routin u l graph almost equal graph increas function 200 310 mflop rpc factor algorithm u l 42 92 time faster dpptrf algorithm larg matric perform rpc solut routin lower subgur l u graph almost equal dpptr perform graph decreas 80 50 mflop rpc algorithm curv increas 240 330 mflop rpc algorithm u l 59 60 time faster dpptr algorithm larg matric matrix size vari 500 3000 subgur 58 ibm smp powerpc openmp direct figur show perform ibm 4way powerpc 604e 332 mhz comput graph demonstr success use openmp17 18 parallel direct curv lapackl lapacku recursivel recur ident correspond curv gure 11 compar curv recursivel recursiveu recparl recparu recparl recparu curv result doubl parallel rpc algorithm call parallel dgemm parallel openmp direct recparl curv much faster recursivel sometim slower recparu fastest special larg size matric doubli parallel rpc algorithm recparu 100 mflop faster ordinari rpc algorithm recursiveu rel u l rpc factor algorithm perform 56 76 time faster dpptrf algorithm larg matric rpc doubl parallel algorithm solut lower subgur exce 800 mflop rel u l rpc solut algorithm perform 65 66 time faster dpptrf algorithm larg matric matrix size vari 300 3000 subgur 59 intel pentium iii run complex arithmet figur 19 show perform intel pentium iii 500 mhz comput gure demonstr success use rpc algorithm hermitian posit denit matric perform measur complex mflop compar usual real arithmet mflop complex mflop multipli 4 lapack routin zpptrf upper subgur u graph perform littl better l graph routin perform 80 mflop rpc hermitian factor routin u graph perform better l graph rpc perform graph increas function go 240 320 mflop rpc hermitian factor algorithm u l 38 43 time faster zpptrf algorithm larg size matric perform rpc solut routin lower subgur l u graph almost equal zpptr perform decreas 108 80 mflop rpc solut algorithm increas 240 320 mflop rpc algorithm u l 39 37 time faster zpptr algorithm larg hermitian matric matrix size vari 500 3000 subgur 510 intel pentium iii three choleski algorithm figur 20 show perform intel pentium iii 500 mhz comput graph gure depict three choleski algorithm lapack full storag dpotrf dpotr algorithm lapack pack storag dpptrf dpptr algorithm rpc factor solut algorithm lapack pack storag algorithm dpptrf dpptr previous explain gure 17 dpotrf routin upper subgur u l case perform better rpc factor routin smaller matric larger matric rpc factor algorithm perform equal well slightli better dpotrf algorithm perform dpotr algorithm u l graph better rpc perform comput howev potrf potr storag requir almost twice storag requir rpc algorithm matrix size vari 500 3000 subgur 6 conclus summar emphas import develop describ paper recurs pack choleski factor algorithm base bla level 3 oper develop rpc factor algorithm work almost speed tradit full storag algorithm occupi data storag tradit pack storag algorithm also see bullet 4 user interfac new pack recurs subroutin rp pptrf rp pptr exactli tradit lapack subroutin pptrf pptr user see ident data format howev new routin run much faster two separ routin describ rp pptrf rp pptr data format alway convert lapack pack data format recurs pack data format routin start oper convert back lapack data format afterward rp ppsv subroutin exist packag equival lapack ppsv routin rp ppsv subroutin data convert factor solut new recurs pack level 3 bla rp trsm rp syrk written fortran9021 develop call gemm routin gemm subroutin develop either comput manufactur gener atla system25 atla gener gemm subroutin usual compat manufactur develop routin acknowledg research partial support lawra project unic collabor ibm tj watson research center yorktown height last two author also support danish natur scienc research council grant epo project ecient parallel algorithm optim simul r exploit function parallel power2 design highperform numer algorithm appli numer linear algebra bla basic linear algebra subprogram extend set fortran basic linear algebra subroutin matrix comput recurs lead automat variabl block dens linearalgebra algorithm accuraci stabil numer algorithm basic linear algebra subprogram fortran usag fortran 9095 explain local refer lu decomposit partial pivot numer linear algebra automat tune linear algebra softwar atla tr extend set fortran basic linear algebra subprogram set level 3 basic linear algebra subprogram exploit function parallel power2 design highperform numer algorithm matrix comput 3rd ed optim matrix multipli use phipac appli numer linear algebra local refer lu decomposit partial pivot recurs lead automat variabl block dens linearalgebra algorithm gemmbas level 3 bla fortran 9095 explain 2nd ed basic linear algebra subprogram fortran usag accuraci stabil numer algorithm numer linear algebra high perform comput recurs formul choleski algorithm fortran 90 superscalar gemmbas level 3 bla ongo evolut portabl highperform librari recurs block data format blass dens linear algebra algorithm ctr chan enriqu quintanaorti gregorio quintanaorti robert van de geijn supermatrix outoford schedul matrix oper smp multicor architectur proceed nineteenth annual acm symposium parallel algorithm architectur june 0911 2007 san diego california usa steven gabriel david wise opi compil rowmajor sourc mortonord matric proceed 3rd workshop memori perform issu conjunct 31st intern symposium comput architectur p136144 june 2020 2004 munich germani dror ironi gil shklarski sivan toledo parallel fulli recurs multifront spars choleski futur gener comput system v20 n3 p425440 april 2004 bjarn andersen john gunnel fred g gustavson john k reid jerzi waniewski fulli portabl high perform minim storag hybrid format choleski algorithm acm transact mathemat softwar tom v31 n2 p201227 june 2005 f g gustavson highperform linear algebra algorithm use new gener data structur matric ibm journal research develop v47 n1 p3155 januari