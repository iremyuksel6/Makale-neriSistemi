safe metaclass program system class treat first class object class defin instanc class call metaclass import benefit use metaclass abil assign properti class eg abstract final trace particular messag support multipl inherit independ baselevel code howev inherit instanti explicitli simultan involv commun class instanc rais metaclass compat issu languag smalltalk address issu easili allow assign specif properti class contrast languag clo allow assign specif properti class tackl compat issu wellin paper describ new model metalevel organ call compat model overcom difficulti allow safe metaclass program sinc make possibl assign specif properti class ensur metaclass compat therefor take advantag express power metaclass build reliabl softwar extend compat model order enabl safe reus composit class specif properti extens implement neoclasstalk fulli reflect smalltalk b introduct shown program metaclass great benefit kaj interest use metaclass assign specif properti class exampl class abstract uniqu instanc trace messag receiv instanc defin prepost condit method forbid redefinit particular method properti implement use metaclass allow therebi custom class behavior lc96 architectur point view use metaclass organ applic abstract level level describ control level immedi causal connect mae87 reifi class commun object includ instanc thu class send messag instanc instanc send messag class messag send name interlevel commun mmc95 howev careless inherit one level may break interlevel commun result issu call compat issu bslr96 identifi two symmetr kind compat issu first one upward compat issu name metaclass compat nicola graub gra89 second one downward compat issu kind compat issu import impedi metaclass program one alway awar current none exist languag deal metaclass allow assign specif properti class ensur compat clo kdrb91 allow one assign properti class ensur compat hand som som93 smalltalk gr83 address compat issu introduc class properti propag problem inde properti assign class automat propag subclass therefor som small talk class specif properti exampl assign abstract properti given smalltalk class subclass becom abstract bc89 follow user face dilemma use languag allow assign specif class properti without ensur compat use languag ensur compat suffer class properti propag problem paper present model compat model allow safe metaclass program ming ie make possibl assign specif properti class without compromis compat addit ensur compat compat model avoid class properti propag class assign specif properti without sideeffect subclass implement compat model neoclasstalk smalltalk extens introduc mani featur includ explicit metaclass riv96 experi led98riv97 show compat model allow programm fulli take advantag express power metaclass effort result tool permit programm unfamiliar metaclass transpar deal class specif properti ii approach allow reus composit class properti paper organ follow section 2 present compat issu give exampl show signific section 3 show exist program languag address compat issu deal properti propag problem section 4 describ solut illustr exampl section 5 deal reus composit class specif properti within compat model sketch use compat model baselevel metalevel programm last section contain conclud summari interlevel commun compat defin interlevel commun messag send class instanc see figur 1 inde class object interact object send receiv messag particular instanc send messag class class send messag instanc use smalltalk exampl illustr issu 1 messag send class level instanc level figur 1 interlevel commun two method allow interlevel commun smalltalk new class one use involv object belong differ level abstract ffl object receiv class messag return class class method make possibl go one level follow two instanc method excerpt visual work smalltalk includ messag send receiv class messag name sent class objectaeprinton astream titl self class name messag daysinyear sent class dateaedaysinyear answer number day year repres receiv self class daysinyear self year ffl class receiv new messag return new instanc therefor new method make possibl go one level follow two class method includ messag send newli creat instanc messag atput sent new instanc arrayedcollect anobject newcollect j newcollect self new 1 newcollect 1 put anobject newcollect messag sent new instanc browser classaeopenon anorgan self openon self new anorgan textstat nil thu interlevel commun smalltalk materi send messag new class languag class reifi clo som also allow similar messag send sinc interlevel commun messag embed method inherit whenev method inherit ensur compat mean make sure method induc failur subclass ie sent messag alway understood identifi two kind compat upward compat 3 downward compat use smalltalk syntax terminolog throughout paper measur made visual work smalltalk imag show interlevel commun frequent 25 class includ instanc method referenc class 24 metaclass defin method referenc instanc 3 nicola graub name issu metaclass compat gra89 ifoo cbar inherit instanti self class cbar figur 2 compat need ensur higher level 21 upward compat suppos implement method ifoo send cbar messag class receiv see figur 2 b subclass ifoo sent instanc b b class receiv cbar messag order avoid failur b understand cbar messag ie metab implement inherit method cbar definit upward compat let b subclass class metab metaclass b metaa metaclass upward compat ensur metab metaa iff everi possibl messag lead error instanc lead error instanc b 22 downward compat suppos implement method cfoo send ibar messag newli creat instanc see figur 3 metab creat subclass metaa cfoo sent b instanc metab b creat instanc receiv ibar messag order avoid failur instanc b understand ibar messag ie b implement inherit ibar method ibar cfoo inherit instanti self new ibar figur 3 compat need ensur lower level definit downward compat let metab subclass metaclass metaa downward compat ensur two class b instanc metab instanc everi possibl messag lead error lead error b 3 exist model show none known model allow assign specif properti class ensur compat 31 redefin class clo validatesuperclass gener function call direct store kdrb91 default validatesuperclass return true metaclass new class metaclass superclass 4 ie class subclass must metaclass therefor incompat avoid metaclass program constrain inherit instanti b figur 4 default clo subclass must share metaclass superclass figur 4 show hierarchi two class illustr clo default compat manag polici sinc class b inherit b must metaclass order allow definit class differ behavior programm usual redefin validatesuperclass method make alway return true thu clo programm total freedom use specif metaclass class assign specif properti class tradeoff need alway awar compat issu 32 som som ibm corba compliant product base metaclass architectur df94b som kernel follow objvlisp model coi87 som metaclass explicit mani instanc therefor user complet freedom organ metaclass hierarchi 321 compat issu som som encourag definit use explicit metaclass introduc uniqu concept name deriv metaclass deal upward compat issu df94a compiletim som automat determin appropri metaclass ensur upward compat need som automat creat new metaclass name deriv metaclass ensur upward compat instanti inherit self class cbar aifoo class parent metaclass metab deriv cbar ifoo figur 5 som ensur upward compat use deriv metaclass fact also return true superclass class name metaclass one argument standardclass metaclass funcallablestandardclass suppos want creat class b instanc metab subclass som detect upward compat problem sinc metab inherit metaclass metaa therefor automat creat deriv metaclass deriv use multipl inherit order support necessari class method variabl 5 figur 5 show result construct instanc b receiv ifoo goe one level higher send cbar b class b understand cbar messag sinc metaclass ie deriv deriv metaclass inherit metab metaa inherit instanti self new ibar somobject ibar cfoo somclass figur exampl som provid polici mechan handl downward compat suppos metab creat subclass metaa see figur 6 cfoo method inherit metab send ibar messag new instanc b class receiv cfoo messag runtim error occur instanc understand ibar messag 322 class properti propag som som allow assign properti given class without make subclass assign properti name defect class properti propag problem follow exampl illustr deriv metaclass implicitli caus undesir propag class properti inherit instanti class parent metaclass soleinst deriv soleinst releas figur 7 class properti propag som suppos class figur 7 releas class ie modifi properti use multiprogramm develop environ version purpos order avoid chang instanc releas metaclass let b class uniqu instanc b instanc soleinst metaclass b subclass som creat b instanc automat creat deriv metaclass inherit soleinst releas thu soon b creat automat lock act like releas class defin new method 5 semant deriv metaclass guarante declar metaclass take preced resolut multipl inherit ambigu ie metab metaa besid ensur instanc variabl class correctli initi use complex mechan 33 smalltalk80 smalltalk metaclass partial hidden automat creat system metaclass nonshar strongli coupl sole instanc metaclass hierarchi parallel class hierarchi implicitli gener class creat 331 compat issu smalltalk80 use parallel inherit hierarchi smalltalk model ensur upward downward com patibl inde code deal new class method inherit work properli instanti inherit class cbar cfoo ifoo classcfoo self new ibar self class cbar aifoo class ibar figur 8 smalltalk ensur upward downward compat one creat b class subclass see figur 8 smalltalk automat gener metaclass b b class 6 subclass class metaclass suppos implement method ifoo send cbar class receiv ifoo sent instanc b b class receiv cbar messag thank parallel hierarchi b class understand cbar messag upward compat ensur similar manner downward compat ensur thank parallel hierarchi 332 class properti propag smalltalk80 sinc metaclass automat implicitli manag system smalltalk drastic reduc opportun chang class behavior make metaclass program anecdot som smalltalk allow assign properti class without propag subclass inherit class class classnew self error abstract instanti figur 9 class properti propag smalltalk figur 9 class abstract sinc subclass must implement method complet instanc behavior b concret class implement whole set method suppos want enforc properti abstract order forbid instanti defin class method classaenew rais error unfortun b class inherit method new class result attempt creat instanc b rais error 7 6 name smalltalk metaclass name uniqu instanc postfix word class 7 exampl deliber simpl one could avoid problem redefin new b class solut 4 compat model among previou model smalltalk one parallel hierarchi ensur full compati biliti howev allow assign specif properti class hand clo model allow assign specif properti class unfortun ensur compat believ two goal achiev new model make clear separ compat class specif properti inherit instanti abstract classnew self error abstract class class abstract class figur 10 avoid propag abstract illustr idea separ concern refactor exampl figur 9 creat new metaclass name abstract class subclass class see figur 10 class redefin instanc new metaclass abstract class redefin new method rais error instanc howev sinc b class subclass abstract b class remain concret gener scheme solut name compat model remaind paper name metaclass defin class properti denot concaten properti name symbol superclass name exampl abstract class subclass class defin properti abstract name abstract 41 descript compat model compat model extend smalltalk model separ two concern compat specif class properti metaclass hierarchi parallel class hierarchi ensur upward downward compat like smalltalk extra metaclass layer introduc order local assign properti class class instanc metaclass belong layer compat model base two layer metaclass one address uniqu concern compat concern issu address metaclass organ hierarchi parallel class hierarchi name metaclass compat metaclass defin behavior must propag subclass class method send messag instanc defin metaclass besid messag sent class instanc defin metaclass specif class properti concern issu address metaclass defin class specif properti name metaclass properti metaclass class specif properti instanc properti metaclass inherit correspond compat metaclass properti metaclass join properti metaclass sinc defin properti specif class kind inherit anomali my93 increas mainten cost aclass bclass metaclass compat metaclass properti ifoo ibar aifoo self new ibar aclasscfoo self class cbar inherit instanti cfoo bproperti cbar aproperti bclass figur 11 compat model figur show 8 compat model appli hierarchi consist two class b respect instanc aproperti metaclass aproperti properti specif class bproperti properti specif class b aproperti aclass bproperti bclass join link class properti propag occur thu b distinct properti subclass aclass bclass meta class upward downward compat guarante suppos defin two instanc method ifoo ibar ifoo method send cbar messag class receiv ibar method sent new instanc cfoo method aclass bclass metaclass hierarchi parallel b class hierarchi interlevel commun failur avoid 42 exampl refactor smalltalk80 boolean hierarchi boolean hierarchi smalltalk 9 depict figur 12 boolean abstract class defin protocol share true fals true fals concret class one instanc properti ie abstract sole instanc implicit smalltalk use compat model refactor boolean hierarchi emphas instanti inherit boolean class fals class boolean true class true fals figur 12 boolean hierarchi smalltalk first creat boolean class compat metaclass second step consist creat properti metaclass abstract boolean class enforc boolean class abstract final build boolean class instanti abstract metaclass refactor fals class first creat fals class metaclass subclass boolean class ensur compat second step consist creat properti metaclass soleinst compat metaclass surround dash line properti metaclass drawn insid grey shape 9 prefer academ exampl emphas idea rather complex exampl requir detail present fals class enforc fals class one instanc last creat fals class instanti soleinst fals class metaclass true class refactor way result rebuild whole hierarchi boolean shown figur 13 abstract boolean class soleinst fals class instanti inherit fals class boolean boolean class fals true class soleinst class true figur 13 boolean hierarchi refactor 5 reus composit within compat model experi compat model neoclasstalk 10 riv97 fulli reflect smalltalk quickli face need class properti reus composit inde unrel class belong differ hierarchi properti given class mani properti previou section true class fals class properti uniqu instanc besid assign one properti class boolean hierarchi class need assign mani properti exampl fals class must uniqu instanc also subclass class final java terminolog reus compos class properti respect compat model section propos extens compat model deal reus composit class properti languag class treat regular object may integr extend compat model neoclasstalk use first experiment platform 51 reus class properti smalltalk sinc metaclass behav differ way class defin instanc particular class metametaclass call metaclass metaclass defin behavior metaclass smalltalk exampl name metaclass name sole instanc postfix word class metaclassaenam thisclass name class take advantag concept metametaclass reus class properti sinc metaclass implement differ properti differ behavior need one metametaclass class properti properti metaclass defin class properti instanc metametaclass properti metaclass creat metametaclass initi definit correspond class properti thu code instanc variabl method correspond definit neoclasstalk relat paper download httpwwwemnfrcsobjecttoolsneoclasstalkneoclasstalkhtml class properti automat gener reus achiev creat properti metaclass defin class properti instanc metametaclass ie initi class properti definit exampl initi given section 542 root metametaclass hierarchi name propertymetaclass describ default structur behavior properti metaclass exampl name properti metaclass built properti name superclass name propertymetaclassaenam self class name self superclass name refactor boolean hierarchi section 42 soleinst fals class soleinst true class defin properti uniqu instanc reus achiev defin soleinst fals class soleinst true class instanc soleinst subclass propertymetaclass see figur 14 soleinst fals class abstract boolean class metaclass level class level metametaclass level fals class boolean instanti inherit boolean class fals true class soleinst class abstract soleinst true propertymetaclass figur 14 reus properti boolean hierarchi 52 composit class properti sinc given class mani properti model must support composit class proper tie chose use mani properti metaclass organ singl inherit hierarchi metaclass implement one specif class properti illustr idea modifi instanti link fals class see figur 15 defin two properti metaclass one properti first properti metaclass soleinst inherit compat metaclass fals class second one final fals class class fals defin subclass soleinst fals class result scheme respect compat model allow assign two specif properti fals class still ensur compat 521 conflict manag solut properti metaclass composit issu trivial inde necessari deal conflict aris compos differ properti metaclass use inherit compos properti metaclass two kind conflict aris name conflict valu conflict dhh soleinst fals class boolean class abstract boolean class fals class soleinst fals class final fals boolean instanti inherit figur 15 assign two properti fals name conflict happen orthogon properti metaclass defin instanc variabl method name two properti metaclass orthogon defin unrel class properti name conflict instanc variabl method avoid adapt definit new properti metaclass accord superclass exampl although two properti metaclass soleinst fals class soleinst true class defin properti respect instanc class fals true may use differ instanc variabl name method name valu conflict happen nonorthogon properti metaclass defin method name conflict avoid make properti metaclass hierarchi act cooper chain ie properti metaclass explicitli refer overridden method defin superclass 11 therefor properti metaclass act like mixin bc90 522 exampl cooper properti metaclass suppos want assign two specif properti fals class figur 16 trace messag trace ii breakpoint particular method breakpoint two properti deal messag handl base neoclasstalk techniqu method wrapper describ duc98 bfjr98 executemethodreceiverargu method entri point handl messag neoclasstalk ie custom executemethodreceiverargu allow special messag send 12 thu object fals receiv messag class fals receiv messag executemethodreceiverargu accord inherit hierarchi 1 trace first done 2 use super breakpoint perform 3 regular method applic final execut call use super ffl 3 standardclassaeexecutemethod method receiv rec argument arg ffl 2 breakpointfals classaeexecutemethod method receiv rec argument arg method selector stopselector iftru self halt breakpoint stopselector super executemethod method receiv rec argument arg ffl 1 tracebreakpointfals classaeexecutemethod neoclasstalk smalltalk achiev use pseudovari super executemethodreceiverargu method provid standardclass root metaclass neo appli method receiv argument fals class instanti inherit fals trace breakpoint breakpoint fals class trace breakpoint fals class propertymetaclass metaclass level class level metametaclass level figur composit nonorthogon properti method receiv rec argument arg self transcript show method selector cr super executemethod method receiv rec argument arg 53 extend compat model gener previou exampl allow us defin extend compat model see figur 17 enabl reus compos class properti properti metaclass defin instanc variabl method involv uniqu properti properti metaclass specif given class organ singl hierarchi root hierarchi subclass compat metaclass 13 properti metaclass instanc metametaclass describ specif class properti allow reus metaclass properti bclass aclass metaclass compat bclass aclass bclass bclass aclass aclass propertymetaclass figur 17 extend compat model 13 singl hierarchi may compar explicit linear properti metaclass compos use multipl inherit dhhm94 metaclass creation composit delet manag automat respect extend compat model time new class creat new compat metaclass automat creat done way smalltalk build parallel metaclass hierarchi assign properti class result insert new metaclass properti metaclass hierarchi insert made two step 1 first new properti metaclass becom subclass last metaclass properti metaclass 2 class becom instanc new properti metaclass neoclasstalk provid protocol dynam chang class object changeclass superclass class superclass riv97 thu implement two step immedi neoclasstalk provid composewithpropertiesof method aclass self superclass aclass class aclass changeclass self 54 program within extend compat model distinguish two kind programm base level programm implement applic use languag develop tool ii meta level programm languag applic 541 base level program make model easi use baselevel programm neoclasstalk program environ includ tool allow one assign differ properti given class use smalltalklik browser see figur 18 properti ad remov runtim metaclass level automat built accord select baselevel programm 542 meta level program order introduc new class properti metalevel programm must creat subclass prop ertymetaclass metametaclass new metametaclass store instanc variabl method defin instanc properti metaclass new metametaclass instan tiat previou instanc variabl ad result properti metaclass method compil 15 initi time exampl evalu follow express creat properti metaclass instanc metametaclass trace assign trace properti true class trace new composewithpropertiesof true 14 remov properti metaclass done symmetr way solut consist compil result protomethod riv97 thu properti metaclass get initi protomethod copi method dictionari properti metaclass allow fast instanti metametaclass assum initi part creation process true almost everi languag tradit nalli achiev smalltalk redefinit new super new initi skt96 figur properti assign class use browser order achiev trace messag must captur log text collector therefor properti metaclass instanc trace must defin instanc variabl name transcript correspond text collector method handl messag messag handl achiev use executemethodreceiverargu method sourc code alreadi present 522 definit gener properti metaclass initi ie use initi method trace metametaclass traceaeiniti super initi self instancevariablenam transcript self generateexecutemethodreceiverargu 6 conclus consid class first class object organ applic differ abstract level inevit rais upward downward compat issu exist solut address compat issu smalltalk allow assign specif properti given class without propag subclass compat model propos paper address compat issu allow assign specif properti class without propag subclass achiev thank separ two involv concern compat class properti upward downward compat ensur use compat metaclass hierarchi parallel class hierar chi properti metaclass allow assign specif properti class subclass compat metaclass therefor take advantag express power metaclass defin reus compos class properti environ support safe metaclass program class properti improv readabl reusabl qualiti code increas separ concern allow better organ class librari framework design reliabl softwar strongli convinc compat model enabl separ concern base metaclass paradigm therefor promot build reliabl softwar easi reus maintain acknowledg author grate mathia braux pierr coint stephan ducass nick edgar philipp mulet jacqu noy nicola revault mario sudholt valuabl comment suggest special thank anonym refere provid detail thoughtprovok comment r program explicit metaclass smalltalk wrapper rescu concurr distribut object orient program nouri bouraqadisaadani first class objvlisp model deriv metaclass som reflect metaclass program som le point sur lheritag multipl propos monoton multipl inherit linear evalu messag pass control techniqu smalltalk metaclass compat separ concern objectori program clo perspect art metaobject protocol explicit metaclass tool improv design class librari reflect distribut system adapt objectori softwar demet method propag pattern concept experi comput reflect toward methodolog explicit composit metaobject research direct concurr objectori program new smalltalk kernel allow explicit implicit metalclass pro gram object behavior evolut within class base reflect languag smalltalk style advanc objectori metalevel architectur reflec tion tr smalltalk80 languag implement concept experi comput reflect first class objvlisp model metaclass compat program explicit metaclass smalltalk80 mixinbas inherit art metaobject protocol metaobject protocol analysi inherit anomali objectori concurr program languag propos monoton multipl inherit linear reflect metaclass program som smalltalk style toward methodolog explicit composit metaobject concurr distribut objectori program advanc objectori metalevel architectur reflect adapt objectori softwar wrapper rescu explicit metaclass tool improv design class librari ctr stphane ducass oscar nierstrasz nathanael schrli roel wuyt andrew p black trait mechan finegrain reus acm transact program languag system topla v28 n2 p331388 march 2006