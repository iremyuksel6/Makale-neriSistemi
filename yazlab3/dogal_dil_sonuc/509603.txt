compil parallel code spars matrix applic develop framework base relat algebra compil effici spars matrix code dens doani loop specif represent spars matrix paper show framework use gener parallel code present experiment data demonstr code gener bernoulli compil achiev perform competit handwritten code import comput kernel b introduct spars matrix comput ubiquit comput scienc howev develop highperform softwar spars matrix comput tediou errorpron task two reason first standard way store spars matri ce sinc varieti format use avoid store zero best choic format depend problem architectur second algorithm take lot code reorgan produc effici spars program tune particular format illustr point describ two format classic format call compress column storag cc 10 modern one use blocksolv librari 11 serv run exampl abstract cc format illustr fig 1 matrix compress along column store use three array colp val rowind valu nonzero element column j store array section 1 row indic nonzero element column j store 1 illustr fig 1b matrix mani zero column zero column store result call compress compress column storag format ccc case anoth level indirect ad colind array compress column dimens well fig 1c colp val rowind colp val rowind 3 6 8a exampl matrix b cc format c ccc format figur 1 illustr compress column storag format gener simpl format howev exploit applic specif structur matrix format use blocksolv librari exploit structur present spars matric aris solut pde multipl degre freedom figur 2a adapt 11 illustr grid would aris 2d linear multicompon finiteel model three degre freedom discret point degre freedom illustr three dot discret point stiff matrix model would group row ident column structur call inod ident node nonzero valu inod gather dens matrix shown fig 2c matric also rich cliqu partit cliqu shown fig 2a use dash rectangl librari color contract graph induc cliqu reorder matrix shown fig 2b symmetr matric lower half store togeth diagon black triangl along diagon correspond dens matric induc cliqu gray offdiagon block correspond spars block matrix store use inod notic matrix store collect smaller dens matric fact help reduc spars storag overhead improv perform matrixvector product parallel execut color divid among processor therefor processor receiv sever block contigu row processor offdiagon block actual store column column inod perform matrixvector product storag organ make process messag contain nonloc valu vector effici addit allow overlap comput commun separ matrixvector product portion access local data one deal nonloc data incom messag main algorithm consid paper matrixvector product core comput iter solver linear system consid perform mflop spars matrixvector product singl processor ibm sp2 varieti matric storag format shown tabl 1 descript matric format found appendix box number indic highest perform given matrix clear set experi singl format appropri kind problem demonstr difficulti develop spars bla spars matrix comput even limit format tabl 1 one still provid least 6 version spars matrixmatrix product color 1 color 0 color 2 subgraph gener 2d linear finit element model b colorcliqu reorder block solv librari b f e c e f c inod storag figur 2 illustr blocksolv format assum result store singl format lack extens spars bla approach address objectori solver librari like petsc librari argonn 4 librari provid templat certain class solver exampl krylov space iter solver allow user add new format provid hook implement algebra oper matrixvector product howev mani case implement matrixvector product quit tediou case blocksolv librari also librari use develop new algorithm radic differ solut gener spars matrix program use restructur compil technolog compil given dens matrix program declar matric actual spars respons choos appropri storag format gener spars matrix program idea explor bik 6 7 approach limit simpl spars matrix format repres use highperform code intuit trade abil handl varieti format abil compil arbitrari loop nest taken differ approach previous shown effici spars sequenti code gener varieti storag format doall loop loop reduct 13 14 approach base view array relat execut loop nest evalu relat queri demonstr method describ storag format access method gener enough specifi name diagon coordin cr itpack jdiag bs95 small 21972 8595 16000 7446 21818 2921 685 bu 1133 5379 20421 4869 31406 2475 gr memplu 0268 4648 15299 0250 12111 4138 sherman1 tabl 1 perform spars matrixvector product varieti format yet specif enough allow import optim sinc class doani loop cover matrixvector matrixmatrix product also import kernel within highperform implement direct solver incomplet precondition allow us address need number import applic one think spars code gener provid extens set spars bla code use implement varieti applic like dens bla routin parallel execut one need specifi data comput partit inform call distribut relat come varieti format case spars matrix format distribut relat format also applic depend case regular blockcycl distribut distribut relat specifi closedform formula allow ownership inform comput compiletim howev regular distribut might provid adequ loadbal mani irregularli structur applic hpf2 standard 9 provid two kind irregular distribut gener block indirect gener block distribut processor receiv singl block continu row suggest standard processor hold block size processor distribut relat replic permit ownership determin without commun indirect distribut gener user provid array map element mapi give processor ith row assign map array distribut varieti way howev requir commun determin ownership nonloc data chao librari 15 allow user specifi partit inform provid list row indic assign processor list indic transfer distribut translat tabl equival map array partit block wise scheme gener indirect scheme use hpf2 also requir commun determin ownership build translat tabl alreadi discuss partit scheme use blocksolv librari somewhat differ gener gener block distribut provid hpf2 yet structur indirect distribut furthermor distribut relat blocksolv librari replic sinc processor usual receiv small number contigu row goal provid parallel code gener strategi follow properti ffl strategi depend fix set spars matrix format ffl depend fix set distribut ffl system extens possibl add new format without chang overal code gener mechan ffl time gener come expens perform compil must exploit structur avail spars matrix partit format solv problem extend relat approach gener parallel spars code start dens code specif spars matrix format data partit inform view array distribut relat parallel loop execut distribut queri evalu addit differ way repres partit inform regular irregular unifi view distribut map relat outlin rest paper section 2 outlin relat approach sequenti spars code gener section 3 describ spars parallel code gener algorithm section 4 present experiment evid advantag approach section 5 present comparison previou work section 6 present conclus ongo work relat model spars code gener consid matrixvector product suppos matrix vector x spars vector dens execut code effici necessari perform iter ij xj zero set iter describ follow set constraint 1 first row repres loop bound constraint second row associ valu array indic exampl predic ai j constraint valu j final constraint third row specifi iter updat nonzero valu problem comput effici enumer set iter specifi constraint 1 iter need effici access correspond entri matric vector sinc constraint linear set comput convex use method base polyhedr algebra fouriermotzkin elimin 2 enumer set approach base relat algebra model x relat tabl hold tupl array indic valu conceptu relat correspond spars matrix contain zero nonzero valu view iter space loop relat hi ji tupl write first two row constraint 1 follow relat queri relat algebra notat summar appendix test element spars array x nonzero use predic nzai j nzxj notic dens nzi evalu true array therefor constraint third row 1 rewritten predic p call sparsiti predic use algorithm bik wijshoff 6 7 comput sparsiti predic gener use definit sparsiti predic final write queri defin indic valu spars comput oe relat algebra select oper reduc problem effici enumer iter point satisfi system constraint 1 problem effici comput relat queri involv select join problem turn solv determin effici order join 4 perform determin join implement decis depend storag format use spars array 21 describ storag format follow idea relat databas literatur 16 20 spars storag format describ term access method properti unlik databas relat usual store flat collect tupl spars storag format hierarch structur must exploit effici exampl cc format provid way enumer row indic without first access particular column use follow notat describ hierarch structur array indic mean given column index j access set hi vi tupl row indic valu matrix oper use denot hierarchi array indic term hierarchi j v exampl programm must provid method search enumer indic level must specifi properti method cost search whether enumer produc sort output method properti use determin good join order join implement relat queri extract program describ 14 way describ storag format compil access method properti solv extens problem varieti storag format describ compil compil strategi depend fix set format detail format specifi compil see 13 indic permut kind index translat easili incorpor framework suppos permut p store use two integ array perm iperm repres permut invers view p relat tupl hi 0 origin index 0 permut index suppos row matrix exampl permut use p view relat hi tupl queri spars matrixvector product sparsiti predic 23 summari highlight ffl array spars dens relat ffl access method defin relat view data structur implement particular format ffl view loop execut relat queri evalu ffl queri optim algorithm need know highlevel structur relat provid access method actual implement eg role colp rowind array cc storag ffl permut also handl compil ffl compil algorithm independ particular set storag format new storag format ad compil gener parallel code ancourt et al 1 describ problem gener spmd code dens hpf program reduc comput express polyhedr algebra describ problem gener spars spmd code loop nest reduc problem evalu relat algebra queri distribut relat section 31 describ distribut array repres section 32 describ distribut queri translat sequenc local queri commun statement section 33 discuss code gener algorithm use context blocksolv data structur 31 repres distribut array uniprocessor case relat highlevel view underli data structur parallel case relat view partit fragment store processor format fragment defin use access method outlin sec 21 problem must address describ distribut relat fragment let start follow simpl exampl ffl matrix partit row processor p get fragment matrix p ffl let j row column indic array element origin matrix let 0 j 0 correspond indic fragment p partit row column indic j global row index wherea 0 thought local row offset translat 0 processor keep integ array ind p ind p 0 processor keep list global row indic assign repres partit notic processor p array ind p view relat ind p 0 local fragment matrix also view relat p defin global matrix follow project oper defin appendix b case processor p carri inform translat fragment p contribut global relat situat processor p might translat inform fragment store p good exampl distribut translat tabl use chao librari 15 suppos global indic fall rang number processor let e given global index index owner processor p local offset 0 store processor processor q hold array hp index need gener way repres index translat scheme key view index translat relat distribut relat first case global relat defin exampl chao librari relat defin ind q h view mention array hp 0 tupl relat blocki q h shorthand constraint 8 9 defin index translat relat indi ind defin exampl 10 11 similarli defin global relat x vector matrixvector product assum distribut way row gener distribut relat describ inda r distribut relat r p fragment processor p ind globaltoloc index translat relat index translat relat differ differ array assum alway specifi 11 map global index pair hp 0 notic exampl partit ind relat 10 11 satisfi definit 15 call 15 fragment equat specifi distribut comput recal iter set loop also repres relat ii j matrixvector product exampl p access method fragment colp global relat val lowlevel data structur rowind p bernoulli compil hpf distribut array alignmentdistribut compil figur 3 flow inform hpf bernoulli compil could requir user suppli full fragment equat would burdensom user would provid local iter set p set realli determin compil use polici ownercomput rule addit relat store need allow multipl storag format mechan independ polici use determin distribut relat iter given distribut relat ind defin local iter set p simpl definit allow us treat iter set relat uniformli togeth relat question notic fragment equat 15 explicit alignmentdistri bution scheme use hpf bernoulli compil global relat describ hierarchi view first local fragment defin access method view lowlevel data structur global relat defin view local fragment fragment equat hpf align distribut provid map global indic proce sor full globaltoloc index translat local storag layout full index translat deriv compil remov user respons flexibl defin local storag format differ flow inform hpf bernoulli compil illustr fig 3 mistak user may specifi inconsist distribut relat ind incon sistenc gener detect runtim exampl verifi runtim user specifi distribut relat ind fact provid 11 onto map problem uniqu framework hpf valuebas distribut 21 similar problem basic function specifi valu runtim properti check runtim possibl gener debug version code check consist distribut beyond scope paper 32 translat distribut queri let us return queri spars matrixvector product relat x defin 12 13 14 translat distribut queri 17 sequenc local queri commun statement expand definit distribut relat algebra simplif follow 321 gener strategi distribut queri literatur optim problem find site evalu part queri 17 context say bank databas spread across branch bank partit relat fix may optim queri submit system choic site might nontrivi ap plicat see 20 detail discuss gener distribut queri optim problem case expect placement relat correl queri given us user particular placement iter space relat tell us queri process queri evalu processor p p p set iter assign processor p resolv refer global relat x first exploit fact join case requir commun directli translat join local fragment resolv remain refer comput commun set perform actual commun relat x exampl outlin major step 322 exploit colloc order expos fact join done without communi cation expand join use definit relat assum index translat relat ind provid 11 map global index processor number deduc q noth statement fact align 3 5 join translat p notic join global index translat join local offset sparsiti predic p origin refer distribut relat translat queri replac refer global relat refer local relat 323 gener commun queri use p p comput set global indic j x referenc processor join set index translat relat tell us get element recvind p use p tell us element x must commun processor p processor q ind relat distribut case chao librari evalu queri 22 might requir commun commun also express comput framework appli parallel code gener algorithm recurs 324 summari summari repres distribut array distribut relat repres globaltoloc index translat relat distribut relat repres parallel doani loop execut distribut queri evalu ffl compil dens hpf program ancourt et al 1 describ comput set commun set etc describ express polyhedr algebra deriv similar result spars program use relat algebra 33 compil blocksolv format discuss introduct blocksolv librari split matrix two disjoint data structur collect dens matric along diagon shown use black triangl figur 2b offdiagon spars portion matrix store use inod format figur 2c comput matrixvector product x dens matric along diagon refer local portion vector x also offdiagon spars block store way make easi enumer separ element matrix refer local element x requir commun altogeth view matrix store blocksolv librari format sum ad sl snl ffl ad repres dens block along diagon ffl sl repres portion spars block refer local element x ffl snl repres portion spars block refer nonloc element x ad sl snl partit row distribut librari assign small number continu row processor distribut relat also replic thu reduc cost comput ownership inform handwritten librari code comput commun set index translat product involv ad sl portion matrix access directli local element x use code gener technolog produc code competit handwritten code straightforward approach start sequenti dens matrix dataparallel program matrixvector product sinc matrix repres three fragment ad sl snl approach essenti comput three matrix vector product perform code discuss next section care comparison code handwritten code reveal perform code suffer fact even though product involv ad sl requir commun still requir globaltoloc index translat element x use comput view ad sl global relat store global row column indic hide fact local indic x determin directli data structur ad sl redund index translat introduc extra level indirect access x degrad node program perform point automat approach handl problem howev circumv problem cost increas complex input program specifi code product ad sl node program level code product snl still specifi global dataparallel level local local p etc local portion array snl x global view compil gener necessari commun index translat product snl mix specif dataparallel node level program uniqu approach exampl hpf allow programm escap node program level use extrins 9 gener sophist composit spars format one use blocksolv librari might requir algorithm specif differ level dens loop current explor way specifi storag format get good sequenti perform without drop node level program part applic 4 experi section present preliminari perform measur ibm sp2 algorithm studi parallel conjug gradient 18 solver diagon precondit cg solv larg spars system linear equat iter follow terminolog chao project parallel implement algorithm divid inspector phase executor phase 15 inspector determin set valu commun perform preprocess executor perform actual comput commun iter applic cost inspector usual amort sever iter executor order verifi qualiti compilergener code demonstr benefit use mix localglob specif 24 algorithm applic measur perform inspector executor follow implement cg algorithm ffl blocksolv handwritten code blocksolv librari ffl bernoullimix code gener compil start mix lo calglob specif 24 ffl bernoulli naiv code gener compil start fulli dataparallel specif 23 ran differ implement solver set synthet threedimension grid problem connect result spars matrix correspond 7point stencil 5 degre freedom discret point ran solver 2 4 8 16 32 64 processor ibm sp2 cornel theori center run kept problem size per processor constant theta 30 place 135 theta 10 3 row 45 theta 10 6 nonzero total processor limit number solver iter 10 tab 2 show time second numer solut phase executor tab 3 show overhead inspector phase ratio time taken inspector time taken singl iter executor compar perform bernoullimix blocksolv version verifi qualiti compil gener code 24 differ due aggress blocksolv bernoullimix bernoulli sec sec diff sec diff tabl 2 numer comput time 10 iter blocksolv bernoullimix bernoulli indirectmix indirect tabl 3 inspector overhead overlap commun comput done handwritten code current bernoulli compil gener simpler code first exchang nonloc valu x comput inspector bernoullimix code twice expens blocksolv code cost still quit neglig 27 executor 10 iter comparison bernoulli bernoullimix code illustr import use mix localglob specif 24 bernoulli code perform redund work order discov refer x fact local requir commun amount work proport problem size number unknown much larger number element x actual commun result inspector bernoulli code order magnitud expens one blocksolv bernoullimix implement perform executor also suffer redund globaltoloc translat introduc extra level indirect final code even local refer x result executor bernoulli code 10 slower bernoullimix code demonstr benefit expos structur distribut relat measur inspector overhead use indirect distribut format hpf2 standard 9 implement two version inspector use support indirect distribut chao librari 15 ffl indirectmix inspector mix localglob specif 24 ffl indirect inspector fulli data parallel specif tab 3 show ratio time taken indirect inspector time taken singl iter bernoulli executor executor code exactli case measur executor bernoulli implement order magnitud differ perform indirectmix bernoullimix inspector due fact indirectmix inspector perform asymptot work requir expens commun set distribut translat tabl indirectmix inspector necessari resolv nonloc refer requir round alltoal commun volum proport problem size ie number unknown addit queri translat tabl order determin ownership inform requir alltoal commun global index j processor queri ownership inform even though commun pattern problem limit nearestneighbor connect differ indirect bernoulli inspector pronounc number refer translat proport problem size still indirect inspector perform alltoal commun determin ownership nonloc data rel effect inspector perform overal solver perform de pend cours number iter taken solver turn depend condit number input matrix get better idea rel perform bernoullimix indirectmix implement rang problem plot fig 4 ratio time indirectmix implement would take time bernoullimix implement would take 8 64 processor rang iter count 5 k 100 line fig 4 plot valu ratio inspector overhead bernoullimix version r inspector overhead indirectmix version k iter count simpl calcul show would take 77 iter indirectmix solver 64 processor get within 10 perform bernoullimix 8 processor number 43 iter get within 20 would take 21 39 iter 8 64 processor respect data demonstr inspector cost somewhat amort iter solver still import exploit structur distribut relat lead order magnitud save inspector cost improv overal perform solver also note indirectmix version slower two bernoulli version also requir program effort compil start specif level dens loop 23 24 wherea hpf compil need sequenti spars code input target class problem spars doani loop approach result better qualiti parallel code reduc program effort indirectmix bernoullimix number iter figur 4 effect problem condit rel perform 5 previou work closest altern work combin bik spars compil 6 7 work specifi compil spars code hpf fortran 19 21 22 one could use spars compil translat dens sequenti loop spars loop fortran vienna fortran compil use compil spars loop howev bik work work done ujaldon et al reduc inspector overhead spars code limit user fix set spars matrix storag distribut format reduc possibl exploit problemspecif structur 6 conclus present approach compil parallel spars code userdefin data struc ture start doani loop approach base view parallel doani loop execut relat queri evalu spars matric distribut inform distribut relat relat approach gener enough repres varieti storag format howev gener come expens perform abl exploit properti distribut relat order produc inexpens inspector well produc qualiti numer code executor experiment evid show import achiev perform competit handwritten librari code far focus effort version iter solver conjug gradient algorithm use incomplet factor precondition core oper solver spars matrixvector product product spars matrix skinni dens matrix current investig techniqu use automat gener highperform code oper matrix factor full incomplet triangular linear system solut r linear algebra framework static hpf code distribut scan polyhedra loop global optim parallel local scalabl parallel machin solv align use elementari linear algebra advanc compil optim spars comput automat data structur select transform spars matrix comput qualiti numer softwar assess enhanc high perform fortran forum comput solut larg spars posit definit system user manual scalabl librari softwar parallel solut spars linear system algorithm 586 itpack 2c fortran packag solv larg spars linear system adapt acceler iter method compil parallel spars code userdefin data structur relat approach spars matrix compil databas manag system solv ellipt problem use ellpack kyrlov subspac method supercomput new dataparallel languag featur spars matrix comput principl databas knowledgebas system distribut memori compil design spars problem tr solv ellipt problem use ellpack principl databas knowledgebas system vol krylov subspac method supercomput scan polyhedra loop global optim parallel local scalabl parallel machin runtim compil techniqu data partit commun schedul reus advanc compil optim spars comput automat data structur select transform spars matrix comput databas manag system matrix market algorithm 586 itpack 2c fortran packag solv larg spars linear system adapt acceler iter method comput solut larg spars posit definit distribut memori compil design spars problem solv align use elementari linear algebra ctr chunyuan lin yehch chung jenshiuh liu effici data compress method multidimension spars array oper base ekmr scheme ieee transact comput v52 n12 p16401646 decemb yuan lin david padua automat parallel spars irregular fortran programs1thi work support part armi contract dabt6395c0097 armi contract n6600197c8532 nsf contract mip9619351 partnership award ibm work necessarili repres posit polici armi govern scientif program v7 n34 p231246 august 1999 roxan adl marc aiguier franck delaplac toward automat parallel spars matrix comput journal parallel distribut comput v65 n3 p313330 march 2005 chunyuan lin yehch chung data distribut scheme spars array distribut memori multicomput journal supercomput v41 n1 p6387 juli 2007 eunjin im katherin yelick richard vuduc sparsiti optim framework spars matrix kernel intern journal high perform comput applic v18 n1 p135158 februari 2004 chunyuan lin jenshiuh liu yehch chung effici represent scheme multidimension array oper ieee transact comput v51 n3 p327345 march 2002 chunyuan lin yehch chung jenshiuh liu effici data parallel algorithm multidimension array oper base ekmr scheme distribut memori multicomput ieee transact parallel distribut system v14 n7 p625639 juli