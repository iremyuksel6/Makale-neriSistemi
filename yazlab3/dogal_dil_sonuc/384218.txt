compil design industri network processor one import problem code gener embed processor design effici compil asip applic specif architectur paper outlin design c compil industri asip telecom applic target asip network processor special instruct bitlevel access data regist requir packetori commun protocol process practic viewpoint describ main challeng exploit applic specif featur c compil show compil backend design accomod featur mean compil intrins dedic regist alloc compil fulli oper first experiment result indic clevel program asip lead good code qualiti without need timeconsum assembl program b introduct use applic specic instruct set processor asip embed system design becom quit com mon asip locat standard otheshelf programm processor custom asic henc asip repres frequent need compromis high ecienc asic low develop eort associ standard processor core tailor toward certain applic area asip still oer programm henc high exibl debug upgrad industri exampl asip tensilica congur xtensa risc processor 1 congur gepard dsp core austria micro system 2 like case standard processor compil support asip desir compil urgent requir avoid timeconsum errorpron assembl program embed softwar fast timetomarket depend requir embed system met howev due special architectur asip classic compil technolog often insuci fulli exploit processor capabl demand dedic code gener optim techniqu number code gener techniqu intend meet high code qualiti demand embed system alreadi develop includ code gener irregular data path 3 4 5 6 7 address code optim dsp 8 9 10 11 exploit multimedia instruct set 12 13 14 shown experiment highli machinespec techniqu promis approach gener highqual machin code whose qualiti often come close handwritten assembl code natur paid increas compil time mani case partial impress result achiev code optim asip dsp area less emphasi far new import class asip bitseri protocol process call network processor np design np motiv grow need new high bandwidth commun equip network eg internet router ethernet adapt well telecommun eg isdn xdsl correspond commun protocol mostli employ bitstreamori data format bitstream consist packet dierent length ie variabl length header packet typic longer payload pack et typic packet process requir includ decod ing compress encrypt rout major system design problem area requir high bandwidth leav short time frame low nanosecond process bit packet arriv network node 15 even contemporari highend programm processor hardli keep pace requir realtim perform mention issu comput ecienc eg respect power consumpt sever approach asic design deal ecient bitlevel process 16 shown narrow bitwidth oper detect hardwar runtim processor use knowledg bitwidth oper either reduc power consumpt increas perform furthermor possibl identifi signific number unus bit compil time accord 17 38 comput signic bit specint95 benchmark discard therefor ecient use hardwar oper reduc bitwidth applic specic processor might achiev reason save hardwar resourc approach 18 19 20 use inform bitwidth operand reduc size datapath function unit recongur processor solut requir highli applic specic hard ware hand design hardwir asic frequent desir due high design eort low exibl special class asip np repres promis solut problem sinc instruct set tailor toward ecient commun protocol process advantag exempli follow sinc memori transmitt receiv normal show xed wordlength eg 8 16 bit rel expens process may requir side use standard processor g 1 begin commun packet transmit typic align word boundari transmitt store word send buer pack bitstream format requir network protocol transmiss commun channel packet extract receiv side align receiv wordlength may even dierent transmitt wordlength obvious data convers overhead reduc benet bitstreamori protocol contrast np may design capabl directli process bit packet variabl length ie form store receiv buer featur larg reduc data transport overhead np rel new semiconductor market standard chip eg intel ibm sever inhous design see overview 15 also describ np develop eort stmicroelectron paper focu specic machin inneon technolog network processor 21 ansi c compil develop within industri project design c compil inneon np import goal order avoid timeconsum assembl program ensur rel compilerfriendli architectur mean processorcompil codesign also observ 15 approach turn essenti order avoid expens compilerarchitectur mi network stream memori receiv buffer transmitt memori send buffer receiv figur 1 commun via bitstreamori protocol match right begin howev ecient compil design np least challeng dsp sinc dedic bitpacket orient instruct easili gener highlevel languag like c contrast approach taken 15 base retarget flexwar tool suit 22 decid develop nearli full custom compil backend essenti motiv need incorpor c languag extens dedic regist alloc becom clear later anoth approach relat work valenc compil 23 retarget compil allow specic arbitrari bitwidth c vari abl howev direct support np applic purpos paper show complet c compil advanc np architectur impl ment describ requir new code gener techniqu believ similar techniqu also use np architectur grow compil demand may expect futur remaind paper structur follow section 2 inneon np architectur instruct set describ detail section 3 outlin problem associ model bitlevel process c lan guag next two section describ actual compil design coars subdivid frontend section backend section 5 compon experiment result present section 6 final give conclus mention direct futur work 2 target architectur fig 2 show overal architectur target machin inneon np 21 np core show 16bit risclik basic architectur special extens bitlevel data access principl illustr g 3 np instruct set permit perform alu comput bit packet align proce code np core buffer io figur 2 inneon np architectur alu packet machin wordlength packet packet figur 3 process variabl length bit packet wordlength 2 packet may store bit index subrang regist packet may even span two dierent regist way protocol process align requir variabl packet length instead xed machin wordlength howev packetlevel address possibl within regist within mem ori therefor partial bitstream load memori regist process alu take place g 4 regist file memori alu figur 4 data layout memori regist bit packet align memori regist wordlength order enabl packetlevel address unalign data np instruct set permit specic oset operand length within regist shown gs 5 bit packet address mean correspond regist number oset within regist packet bit width oset plu width larger regist wordlength 16 bit packet span two regist without increas access latenc though especi featur challeng also standard processor intel i960 processor famili support bitori data access howev without correspond arithmet capabl compil design viewpoint width argument result packet must ident one two argument regist also result locat alu oper ation therefor two oset one width paramet per instruct sucient regist number offset within regist cmd reg1off reg2off width command assembl width operand figur 5 np assembl instruct format regist n1 regist n offset within registern n machin word size packet width figur packetlevel address within regist 3 bit packet process c although possibl descript bit packetlevel address c languag inconveni sinc express mean rather complex shift mask scheme exampl given g 7 show fragment gsm speech compress algorithm impl mentat commun oper system research group tu berlin pointer c use travers array unalign bit packet shown g 4 gsmbyte c word xmc8 figur 7 bit packet process exampl gsm speech compress obvious conveni program style situat becom even wors case multiregist packet code readabl thu maintain poor furthermor mask constant gener make code highli machinedepend 31 use compilerknown function outlin section 2 np instruct set allow avoid costli shift mask oper mean special instruct packetlevel address c compil bit packet manipul made visibl programm mean compilerknown function ckf compil intrins compil map call ckf regular function call xed instruct instruct sequenc thu ckf consid clevel macro without call overhead ckf approach also use sever c compil dsp eg texa instrument c62xx use ckf programm still detail knowledg underli target processor readabl code improv signicantli addit provid suitabl set simul function ckf c code written np longer machinedepend also compil host machin debug purpos illustr use ckf simpl exampl consid case would like add constant 2 7bit wide packet store bit 2 8 regist denot c variabl standard c express mean complex assign follow standard processor would translat rel larg instruct sequenc contrast np implement entir assign within singl instruct purpos introduc packet access pa ckf shown g 8 ckf directli ect packetlevel instruct illustr gs 5 6 oper paramet select oper eg add sub shift perform argument v arname1 arname2 addit requir intraregist oset packet bitwidth pass function pa ckf name oper name offset paint oper int varname1 int off1 int varname2 int off2 int packet width name result first operand name second operand offset packet second packet within first operand figur 8 format compilerknown function pa use function pa exampl express simpli c follow int b papaadd 3 b 0 w7 pa add select add instruct w7 specifi bitwidth 7 dene constant c header le scalar variabl b map regist assembl code regist alloc 32 bit packet access loop exempli ckf provid eleg way reduc descript eort bit packet process c urgent ckf requir case bit packet ar ray indirectli access within loop avoid unaccept qualiti compilergener code2 figur 9 array bit packet consid exampl g 9 process array 8 packet 10 bit length bit packet array turn store array 5 16bit regist r0 r4 consequ bit packet align regist wordlength packet even cross regist boundari suppos want comput sum bit packet within loop standard c would requir code shown g 10 due unalign bit packet regist le pointer elem must increment everi loop iter bit packet cross regist boundari therefor control code requir within loop obvious highli undesir respect code qualiti int a5 int sum aelem offset 0x03ff els sum aelemoffset aelem116offset 0x03ff offset 10 offset15 elem offset 16 figur 10 bit packet array access loop order avoid overhead np instruct set architectur provid mean indirect access unalign bit packet array via bit packet pointer regist compil exploit featur ckf mod i c code ckf sum comput exampl given g 11 array declar attribut regist attribut instruct compil backend assign whole array regist le contrast regular c compil would store array like complex data structur memori concept regist array requir sinc np machin oper use packetlevel address work regist memori variabl pr1 pr2 pointer operand ckf init introduc backend pointer bit packet backend use knowledg pointer belong elementarray life time analysi regist alloc exampl pr2 use travers dierent bit packet array constantli point sum variabl number physic regist lower number simultan requir regist variabl spill code insert regist alloc use name pointer regist case identifi regist array load regist le given indirect bit packet oper init ckf translat assembl code load constant regist constant name regist oset width bit packet pointer point en code exampl g 11 pointer pr2 point rst element bit packet array name regist bit packet locat known regist alloc therefor backend work symbol address regist alloc symbol automat replac regist alloc phase paiadd ckf singl indirect addit like c express p q backend creat singl machin oper ckf order keep number ckf low specifi arithmet oper rst paramet ckf instead dedic ckf oper ckf inc denot increment bit packet pointer like increment pointer ansi c pointer point next array element call inc np support bit packet pointer arithmet hard ware requir singl machin instruct independ whether advanc pointer requir cross regist boundari obvious sourc code exampl speci low level program style howev programm still get signic benet use compil first permit use high level languag construct eg control code loop addit address gener regist alloc perform compil keep code reusabl save lot develop time 4 frontend design like compil np c compil subdivid frontend backend part frontend respons sourc code analysi gener intermedi represent ir machineindepend optimiza regist int a5 int pr1 pr2 int initpr1 sum 10 paiadd pr1 pr2 figur 11 bit packet array access ckf tion backend map machineindepend ir machinespec assembl code see section 5 frontend use lanc compil system develop univers dortmund 28 give brief descript sake complet lanc machineindepend optim c frontend system includ backend interfac retarget dierent pro cessor howev support automat target current version lanc v20 compris follow main compon ansi c frontend c frontend analyz c sourc code gener lowlevel three address code ir case syntax semant error c code error messag similar gnu gcc emit ted ir almost machineindepend bit width c data type memori align speci form congur le librari lanc compris c class librari ir access analysi manipul includ le io control data ow analysi symbol tabl main tenanc modic ir statement addi tion auxiliari class frequent requir compil tool list set stack graph optim tool base ir librari lanc contain set common dragon book 29 machineindepend code optim constant fold ing dead code elimin well jump loop optim depend requir optim level optim tool call separ iter via shell script sinc optim tool oper ir format new optim plug time backend interfac backend interfac transform three address code ir data ow tree dft maximum size dft repres piec comput c code compris argument oper ation storag locat well data depend gener dft format compat code gener gener tool like iburg oliv featur strongli facilit retarget new processor mainli distinguish lanc c frontend provid gcc 30 lcc 32 execut ir basic ir structur three address code consist assign jump branch label return statement togeth correspond symbol tabl inform identi three address code mainli serv facilit implement ir optim tool sinc ir structur much simpler origin c sourc languag execut achiev dene ir low level assemblylik subset c languag gener c frontend highlevel construct eg loop switch ifthenels statement replac equival branch statement construct addit implicit load store address arithmet array structur access well type cast made explicit ir suif compil system 31 similar c export facil ir gener pure three address code int main static int a16 b16 c16 d16 regist int regist int regist int figur 12 exampl c sourc code exampl c sourc code taken dspstone 33 fraction correspond ir given gs 12 13 ir contain auxiliari variabl label insert frontend local identi assign uniqu numer sux seen ir still valid lowlevel c code compil link execut compil host machin signic advantag execut cbase particular context industri compil project correct import optim valid methodolog sketch g 14 appli check correct frontend part com piler key idea origin c program ir compil nativ c compil host machin equival two execut check mean comparison output test input data dierenc output indic implement error regress test valid process easili autom although approach natur provid correct proof ensur good fault coverag practic use repres suit c program test input case use larg heterogen set c applic includ complex program packag like mp3 jpeg gsm bdd packag gnu ex bison gzip static int statica316 staticb416 static int staticc516 staticd616 int main char t1t3 int t2t4 regist int regist int l3 return 0 figur 13 partial ir code c code g 12 vhdl parser 6502 c compil valid c frontend ir optim well backend interfac lanc latter achiev export gener dft c syntax help practic point view sinc nonexecut ir format valid without processorspec backend instructionset simula tor frequent slow crosssimul run nat ural valid machinespec backend still requir instructionset simul howev frontend part typic contribut largest part total compil sourc code compil bug may expect xed alreadi phase 5 backend design c compil backend subdivid code select regist alloc modul instruct schedul origin c sourc ir gener ir c sourc execut 1 execut 2 test input data output 1 output 2 comparison figur 14 frontend valid methodolog implement far code selector map data ow tree gener lanc frontend assembl instruct mani compil risc phase innit number virtual regist assum later fold avail amount physic regist regist alloc 51 code select code selector use widespread techniqu tree pattern match dynam program 24 map data ow tree dft assembl code basic idea approach repres target machin instruct set form costattribut tree grammar pars given dft respect grammar result optimum deriv given cost metric henc optim code select obtain runtim complex linear dft size tree pars process visual cover dft minimum set instruct pattern instanc g 15 c b e c b e add mac b c mac add figur 15 visual dftbase code select data ow tree b instruct pattern c optim tree cover implement use oliv tool extens iburg 25 contain spam compil 26 gener code selector c sourc code given instruct set tree grammar respect specifi instruct set oliv conveni sinc tool permit attach action function instruct pattern facilit bookkeep assembl code emiss lanc frontend split c function set basic block contain order list dft dft directli gener format requir oliv pass gener code selector translat assembl code sequenc one anoth phase also call compilerknown function ckf detect directli transform correspond np assembl instruct step rather straightforward sinc ckf simpli identi name howev code selector cooper regist alloc still respons correct regist map sinc ckf call symbol c variabl instead regist name result code select phase symbol assembl code refer virtual regist code pass regist alloc describ follow 52 regist alloc although np show risclik basic architectur classic graph color approach global regist alloc 27 directli use reason need handl regist array explain section 3 see also gs 9 11 regist array aris indirect address c program unalign bit packet travers within loop consequ virtual regist contain fragment bit packet array assign contigu window physic regist le order achiev regist alloc maintain two set virtual regist one scalar valu one regist array virtual regist index uniqu number regist array get dedic uniqu contigu index rang usual regist alloc start lifetim analysi virtual regist potenti con ict form overlap life rang repres interfer graph node repres virtual regist edg denot lifetim overlap lifetim analysi base defus analysi virtual regist lifetim analysi special attent paid bit packet indirectli address via regist pointer whose valu might known compil time order ensur program correct regist array element potenti point regist pointer p assum live p use live p determin inspect pointer initi call compil known function init see g 11 due alloc constraint impos regist ar ray map virtual regist physic regist base special multilevel graph color algorithm physic regist assign virtual regist rst belong regist array necessari sinc regist array present higher pressur regist alloc scalar regist first node set origin interfer graph belong certain regist array merg super node interfer graph transform superinterfer graph sig delet edg intern supernod scalar virtual regist node incid edg g 16 next weight assign supernod n equal number intern virtual regist n plu maximum number intern virtual regist ns neighbor sig supernod map physic regist accord descend weight heurist motiv fact supernod lower weight gener easier alloc caus less lifetim con ict furthermor case con ict cheaper spillreload smaller array instead larger one r1 r3 r4 figur construct sig exampl virtual regist set fr1 r2g fr3 r4 r5g suppos repres two regist array r6 refer scalar variabl supernod n r intern virtual regist contigu rang regist le assign sinc may multipl window avail certain point time select rang base best strategi order ensur tight pack regist array regist le ie order avoid mani spill approach element regist array access two dierent way rst direct address eg a3 indirectli use bit packet pointer case insuci physic regist use indirect access spill code gener virtual regist within regist array otherwis particular virtual regist spill regist alloc symbol address bit packet recalcul specifi physic regist within regist le instead name virtual regist size array bit packet restrict size regist array therefor compil need reject code regist alloc done note code would imposs nd equival assembl code even manual case encount larg regist array control ow give multipl denit pointer variabl multipl regist array case possibl access regist array must assum live time therefor regist le larg enough hold simultan regist alloc supernod remain virtual regist origin interfer graph map physic regist tradit graph color insert spill code whenev requir 6 result c compil np describ previou section fulli oper perform gener code measur mean cycletru np instruct set simul set test program mainli includ arithmet oper checksum comput bitstream test program rel small due eort requir rewrit sourc code compil known function ckf may expect qualiti compilergener code larg depend clever use ckf underli regist array concept use ckf without specic knowledg applic perform overhead compil code may sever hundr percent clearli accept intend applic domain due massiv increas regist pre sure mani regist array simultan live natur impli huge amount spill code case even use standard c program without use ckf might well result ecient code hand care use ckf deriv detail applic knowledg gener lead small perform overhead order 10 observ overhead even reduc mean instruct schedul techniqu reduc regist lifetim therebi spill code well peephol optim far implement also interest consid improv oer ckf compar regular c code tabl 1 show perform six test routin speci c compil np machin code column 2 3 give perform clock cycl without ckf regist array enabl respect column 4 show perform gain percent without ckf ckf gain 43 29 33 prg4 853 639 25 prg5 103 81 21 prg6 156 106 tabl 1 experiment perform result use packetlevel address result averag perform gain 28 standard c refer im plement natur mainli attribut np hardwar howev systemlevel perspect import prove perform gain also achiev mean compil c program instead handwritten assembl code result evalu believ introduct ckf regist array repres reason compromis program eort code qualiti ckf give programm direct access dedic instruct import optim hot spot c applic program compil still perform otherwis timeconsum task regist alloc noncrit program part high perform bitlevel oper hardli issu product gain oer compil versu assembl program clearli compens potenti loss code qualiti 7 conclus futur work modern embed system frequent design basi programm asip allow high exibil iti ip reus compil support asip softwar develop urgent requir order avoid timeintens assembl program howev special compil backend techniqu develop order make optim use dedic architectur featur asip contribut outlin compil challeng encount network processor new class asip allow ecient protocol process mean packetlevel address describ implement c compil repres industri np main concept compil order make packetlevel address access c languag level use compilerknown function special regist alloc techniqu experiment result indic techniqu work practic processor featur well exploit although detail implement rather machinespec believ main techniqu easili port similar forthcom np improv version np c compil alreadi plan ongo work deal gradual replac pragmat approach compilerknown function sophist code select techniqu capabl directli map complex bit mask oper singl machin instruc tion enabl use special tree grammar model instruct set code selector addit plan includ techniqu similar regist pipelin 34 order reduc registermemori trac multiregist bit packet sever peephol optim develop order close qualiti gap compil code handwritten assembl code acknowledg c compil describ paper develop informatik centrum dortmund icd inneon technolog ag munich whose project fund grate acknowledg requir assembl simul tool provid frank engel tu dresden author would also like thank yue zhang contribut test compil backend 8 r tensilica inc austria mikro system intern asic automat instruct code gener base trelli diagram optim code gener embed memori nonhomogen regist architectur code optim techniqu embed dsp microprocessor con ict model instruct schedul code gener inhous dsp core constraint driven code select fixedpoint dsp optim stack frame access processor restrict address mode storag assign decreas code size uniform optim techniqu minim cost local variabl access dsp processor compil simd within regist code select media processor simd instruct exploit superword level parallel multimedia instruct set perspect market requir dynam exploit narrow width operand improv processor power perform hpca5 bitvalu infer detect exploit narrow bitwidth comput bitwidth analysi applic silicon compil coprocessor stream multimedia acceler new network processor architectur highspe commun retarget compil embed core processor languag compil optim datapath width embed system engin simpl code optim librari retarget compil embed digit signal processor regist alloc via graph color code optim techniqu embed processor stanford compil group suif retarget c compil design implement improv regist alloc subscript variabl tr compil principl techniqu tool code gener use tree match dynam program improv regist alloc subscript variabl optim stack frame access processor restrict address mode engin simpl effici codegener gener regist alloc via graph color storag assign decreas code size conflict model instruct schedul code gener inhous dsp core code optim techniqu embed dsp microprocessor optim code gener embed memori nonhomogen regist architectur uniform optim techniqu offset assign problem piperench constraint driven code select fixedpoint dsp minim cost local variabl access dspprocessor code select media processor simd instruct bidwidth analysi applic silicon compil exploit superword level parallel multimedia instruct set network processor code optim techniqu embed processor retarget compil embed core processor retarget c compil piperench compil simd within regist bitvalu infer dynam exploit narrow width operand improv processor power perform code optim librari retarget compil embed digit signal processor ctr xiaotong zhuang santosh pand effect thread manag network processor compil analysi acm sigplan notic v41 n7 juli 2006 xiaotong zhuang santosh pand balanc regist alloc across thread multithread network processor acm sigplan notic v39 n6 may 2004 jinhwan kim yunheung paek gangryung uh code optim vliwstyl network process unit softwarepractic experi v34 n9 p847874 25 juli 2004 jinhwan kim sungjoon jung yunheung paek gangryung uh experi retarget compil commerci network processor proceed 2002 intern confer compil architectur synthesi embed system octob 0811 2002 grenobl franc sriraman tallam rajiv gupta bitwidth awar global regist alloc acm sigplan notic v38 n1 p8596 januari section instruct set extens arm embed applic proceed 2002 intern confer compil architectur synthesi embed system octob 0811 2002 grenobl franc bengu li rajiv gupta simpl offset assign presenc subword data proceed intern confer compil architectur synthesi embed system octob 30novemb 01 2003 san jose california usa v krishna nandivada jen palsberg effici spill code sdram proceed intern confer compil architectur synthesi embed system octob 30novemb 01 2003 san jose california usa chidamb kulkarni matthia gri christian sauer kurt keutzer program challeng network processor deploy proceed intern confer compil architectur synthesi embed system octob 30novemb 01 2003 san jose california usa